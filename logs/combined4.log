{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 23%","timestamp":"2025-04-17T05:47:05.391Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cbf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:05.391Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:05.392Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:05.392Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:05.414Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:05.414Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:05.416Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:05.416Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:05.419Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:05.420Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:05.422Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:05.422Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbf.","timestamp":"2025-04-17T05:47:05.423Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbf status to TRANSLATING.","timestamp":"2025-04-17T05:47:05.423Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbf.","timestamp":"2025-04-17T05:47:05.425Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbf status to TRANSLATING.","timestamp":"2025-04-17T05:47:05.426Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbf.","timestamp":"2025-04-17T05:47:05.427Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbf status to TRANSLATING.","timestamp":"2025-04-17T05:47:05.427Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbf.","timestamp":"2025-04-17T05:47:05.429Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbf status to TRANSLATING.","timestamp":"2025-04-17T05:47:05.430Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:05.434Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:05.450Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:05.454Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:05.456Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:05.457Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:05.458Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:05.458Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:05.458Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 110","timestamp":"2025-04-17T05:47:05.458Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:05.458Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:05.460Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:05.460Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:05.461Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:05.461Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 110","timestamp":"2025-04-17T05:47:05.461Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:05.461Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:05.463Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:05.463Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:05.463Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:05.463Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 110","timestamp":"2025-04-17T05:47:05.463Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:05.464Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:05.465Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:05.471Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:05.472Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:05.472Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 110","timestamp":"2025-04-17T05:47:05.472Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:05.472Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:05.473Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:05.474Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:05.474Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:05.475Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:05.475Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:05.476Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:05.476Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:05.476Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:05.476Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:05.477Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":110,"timestamp":"2025-04-17T05:47:05.477Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:05.477Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:05.478Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:05.478Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:05.479Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:05.480Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:05.480Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:05.480Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:05.480Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:05.480Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:05.480Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:05.480Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:05.480Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:05.480Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":110,"timestamp":"2025-04-17T05:47:05.481Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:05.489Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:05.489Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:05.489Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:05.492Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:05.492Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:05.492Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:05.492Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:05.492Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:05.492Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:05.493Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:05.493Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:05.493Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:05.493Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":110,"timestamp":"2025-04-17T05:47:05.493Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:05.493Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:05.494Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:05.494Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:05.496Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:05.496Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:05.496Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:05.496Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:05.496Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:05.497Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:05.497Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:05.497Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:05.497Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:05.497Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":110,"timestamp":"2025-04-17T05:47:05.498Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:05.498Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:05.498Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:05.498Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:06.886Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10531ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:06.889Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbc: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:06.898Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:06.899Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:06.904Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:06.905Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:06.905Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 16% (7/43)","timestamp":"2025-04-17T05:47:06.905Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 16%","timestamp":"2025-04-17T05:47:06.907Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:06.907Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:47:06.907Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:06.907Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:47:06.916Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:06.916Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbd.","timestamp":"2025-04-17T05:47:06.920Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbd status to TRANSLATING.","timestamp":"2025-04-17T05:47:06.925Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:06.930Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:06.932Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:06.932Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:06.933Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:06.943Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 314","timestamp":"2025-04-17T05:47:06.943Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:06.944Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:06.946Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:06.947Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:06.947Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:06.947Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:06.947Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:06.947Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:06.948Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:06.948Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:06.948Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:47:06.948Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":314,"timestamp":"2025-04-17T05:47:06.948Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:06.948Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:06.949Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:06.949Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:15.926Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10428ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:15.927Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbf: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.933Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:15.934Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:15.938Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10460ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:15.939Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbf: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.941Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:15.948Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:15.950Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10456ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:15.950Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbf: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.950Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:15.951Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:15.953Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10472ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:15.954Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbf: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.954Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:15.954Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.956Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.962Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cbf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:15.963Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 26% (11/43)","timestamp":"2025-04-17T05:47:15.963Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.965Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.965Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cbf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:15.966Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 26% (11/43)","timestamp":"2025-04-17T05:47:15.966Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.967Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.967Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cbf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:15.967Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 26% (11/43)","timestamp":"2025-04-17T05:47:15.967Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 26%","timestamp":"2025-04-17T05:47:15.968Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 26%","timestamp":"2025-04-17T05:47:15.968Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cc0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:15.968Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:15.968Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:15.968Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cc0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:15.969Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:15.969Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:15.969Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 26%","timestamp":"2025-04-17T05:47:15.971Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:15.971Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:15.979Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:15.979Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.983Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:15.983Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cbf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:15.983Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 26% (11/43)","timestamp":"2025-04-17T05:47:15.983Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 26%","timestamp":"2025-04-17T05:47:15.986Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cc0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:15.987Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:15.993Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:15.993Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:16.003Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:16.006Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:16.007Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:16.008Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:16.011Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:16.011Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc0.","timestamp":"2025-04-17T05:47:16.013Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc0 status to TRANSLATING.","timestamp":"2025-04-17T05:47:16.013Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc0.","timestamp":"2025-04-17T05:47:16.014Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc0 status to TRANSLATING.","timestamp":"2025-04-17T05:47:16.015Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc0.","timestamp":"2025-04-17T05:47:16.017Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc0 status to TRANSLATING.","timestamp":"2025-04-17T05:47:16.017Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:16.019Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:16.036Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:16.038Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:16.040Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:16.040Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc0.","timestamp":"2025-04-17T05:47:16.041Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc0 status to TRANSLATING.","timestamp":"2025-04-17T05:47:16.041Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:16.042Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:16.042Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:16.042Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:16.043Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 163","timestamp":"2025-04-17T05:47:16.043Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:16.043Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:16.044Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:16.045Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:16.045Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:16.045Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 163","timestamp":"2025-04-17T05:47:16.045Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:16.045Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:16.047Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:16.047Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:16.047Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:16.047Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 163","timestamp":"2025-04-17T05:47:16.047Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:16.048Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:16.048Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:16.049Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:16.055Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:16.055Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:16.056Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:16.056Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:16.056Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:16.056Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:16.056Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:16.056Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:16.056Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":163,"timestamp":"2025-04-17T05:47:16.056Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:16.056Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:16.056Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:16.056Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:16.058Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:16.058Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:16.058Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:16.058Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:16.058Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:16.059Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:16.059Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:16.059Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:16.059Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:16.059Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":163,"timestamp":"2025-04-17T05:47:16.059Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:16.060Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:16.060Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:16.061Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:16.063Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:16.063Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:16.063Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:16.063Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:16.063Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:16.063Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:16.063Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:16.063Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:16.064Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:16.064Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":163,"timestamp":"2025-04-17T05:47:16.064Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:16.064Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:16.064Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:16.065Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:16.066Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:16.074Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:16.074Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:16.074Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 163","timestamp":"2025-04-17T05:47:16.075Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:16.075Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:16.077Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:16.077Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:16.078Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:16.078Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:16.078Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:16.078Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:16.078Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:16.078Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:16.078Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:16.078Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":163,"timestamp":"2025-04-17T05:47:16.078Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:16.078Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:16.078Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:16.078Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:17.455Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10507ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:17.456Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbd: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:17.460Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:17.460Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:17.475Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:17.476Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:17.476Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 19% (8/43)","timestamp":"2025-04-17T05:47:17.476Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 19%","timestamp":"2025-04-17T05:47:17.476Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbe in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:17.477Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:47:17.477Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbe, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:17.477Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:47:17.490Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:17.491Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbe.","timestamp":"2025-04-17T05:47:17.493Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbe status to TRANSLATING.","timestamp":"2025-04-17T05:47:17.494Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:17.506Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:17.509Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:17.509Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:17.510Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:17.510Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 71","timestamp":"2025-04-17T05:47:17.510Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:17.510Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:17.513Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:17.514Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:17.514Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:17.514Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:17.514Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:17.514Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:17.514Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:17.514Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:17.514Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:47:17.515Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":71,"timestamp":"2025-04-17T05:47:17.515Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:17.515Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:17.515Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:17.515Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:26.575Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10496ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:26.575Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc0: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.579Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:26.579Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:26.580Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10524ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:26.581Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc0: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.581Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:26.581Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:26.582Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10518ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:26.583Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc0: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.583Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:26.584Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:26.586Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10527ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:26.586Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc0: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.587Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:26.587Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.592Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.598Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cc0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:26.599Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 28% (12/43)","timestamp":"2025-04-17T05:47:26.599Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.600Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.601Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cc0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:26.601Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 28% (12/43)","timestamp":"2025-04-17T05:47:26.601Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.602Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.603Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:26.603Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 28% (12/43)","timestamp":"2025-04-17T05:47:26.604Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.605Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:26.606Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cc0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:26.606Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 28% (12/43)","timestamp":"2025-04-17T05:47:26.606Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 28%","timestamp":"2025-04-17T05:47:26.607Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 28%","timestamp":"2025-04-17T05:47:26.607Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 28%","timestamp":"2025-04-17T05:47:26.607Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cc3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:26.607Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.608Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:26.608Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cc3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:26.608Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.608Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:26.608Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:26.609Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.609Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:26.609Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 28%","timestamp":"2025-04-17T05:47:26.611Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cc3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:26.611Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.611Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:26.612Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.629Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:26.630Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.631Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:26.631Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.632Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:26.633Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.634Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:26.634Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc3.","timestamp":"2025-04-17T05:47:26.635Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc3 status to TRANSLATING.","timestamp":"2025-04-17T05:47:26.635Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc3.","timestamp":"2025-04-17T05:47:26.638Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc3 status to TRANSLATING.","timestamp":"2025-04-17T05:47:26.641Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc3.","timestamp":"2025-04-17T05:47:26.643Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc3 status to TRANSLATING.","timestamp":"2025-04-17T05:47:26.643Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc3.","timestamp":"2025-04-17T05:47:26.644Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc3 status to TRANSLATING.","timestamp":"2025-04-17T05:47:26.645Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:26.656Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:26.659Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:26.660Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:26.663Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:26.665Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:26.665Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:26.665Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:26.665Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 177","timestamp":"2025-04-17T05:47:26.666Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:26.666Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:26.667Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:26.667Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:26.667Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:26.667Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 177","timestamp":"2025-04-17T05:47:26.667Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:26.667Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:26.669Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:26.680Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:26.681Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:26.681Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 177","timestamp":"2025-04-17T05:47:26.681Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:26.681Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:26.682Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:26.683Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:26.683Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:26.683Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 177","timestamp":"2025-04-17T05:47:26.683Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:26.683Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:26.685Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:26.686Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:26.686Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:26.687Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:26.687Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:26.687Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:26.687Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:26.687Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:26.687Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.688Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":177,"timestamp":"2025-04-17T05:47:26.688Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:26.688Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:26.688Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:26.688Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:26.690Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:26.690Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:26.690Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:26.690Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:26.690Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:26.690Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:26.690Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:26.690Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:26.690Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.690Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":177,"timestamp":"2025-04-17T05:47:26.691Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:26.691Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:26.691Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:26.691Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:26.693Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:26.693Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:26.693Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:26.693Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:26.693Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:26.693Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:26.694Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:26.694Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:26.694Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.694Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":177,"timestamp":"2025-04-17T05:47:26.694Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:26.694Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:26.695Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:26.695Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:26.696Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:26.697Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:26.697Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:26.697Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:26.697Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:26.697Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:26.697Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:26.697Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:26.698Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:26.698Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":177,"timestamp":"2025-04-17T05:47:26.698Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:26.698Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:26.698Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:26.698Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:28.090Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10575ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:28.090Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbe: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:28.093Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbe as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:28.094Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:28.115Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:28.116Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbe not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:28.116Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 21% (9/43)","timestamp":"2025-04-17T05:47:28.117Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 21%","timestamp":"2025-04-17T05:47:28.117Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:28.118Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:28.118Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:28.118Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:28.128Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:28.129Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbf.","timestamp":"2025-04-17T05:47:28.132Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbf status to TRANSLATING.","timestamp":"2025-04-17T05:47:28.132Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:28.139Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:28.144Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:28.145Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:28.145Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:28.145Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 110","timestamp":"2025-04-17T05:47:28.145Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:28.146Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:28.148Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:28.149Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:28.149Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:28.149Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:28.149Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:28.149Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:28.149Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:28.149Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:28.149Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:47:28.149Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":110,"timestamp":"2025-04-17T05:47:28.150Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:28.150Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:28.150Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:28.150Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:37.193Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10494ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:37.194Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc3: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.197Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:37.197Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:37.200Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10511ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:37.200Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc3: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.200Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:37.200Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:37.202Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10508ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:37.202Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc3: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.202Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:37.203Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:37.204Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10513ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:37.205Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc3: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.205Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:37.205Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.211Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.218Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cc3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:37.219Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 30% (13/43)","timestamp":"2025-04-17T05:47:37.219Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.220Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.220Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cc3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:37.220Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 30% (13/43)","timestamp":"2025-04-17T05:47:37.220Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.221Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.221Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cc3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:37.221Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 30% (13/43)","timestamp":"2025-04-17T05:47:37.221Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.222Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:37.222Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:37.223Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 30% (13/43)","timestamp":"2025-04-17T05:47:37.223Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 30%","timestamp":"2025-04-17T05:47:37.223Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 30%","timestamp":"2025-04-17T05:47:37.223Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 30%","timestamp":"2025-04-17T05:47:37.223Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cc5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:37.223Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.224Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:37.224Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cc5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:37.225Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.225Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:37.225Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cc5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:37.225Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.225Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:37.225Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 30%","timestamp":"2025-04-17T05:47:37.230Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:37.231Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.231Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:37.231Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.246Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:37.246Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.249Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:37.249Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.250Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:37.250Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.252Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:37.253Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc5.","timestamp":"2025-04-17T05:47:37.254Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc5 status to TRANSLATING.","timestamp":"2025-04-17T05:47:37.254Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc5.","timestamp":"2025-04-17T05:47:37.255Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc5 status to TRANSLATING.","timestamp":"2025-04-17T05:47:37.255Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc5.","timestamp":"2025-04-17T05:47:37.258Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc5 status to TRANSLATING.","timestamp":"2025-04-17T05:47:37.263Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc5.","timestamp":"2025-04-17T05:47:37.265Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc5 status to TRANSLATING.","timestamp":"2025-04-17T05:47:37.265Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:37.275Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:37.278Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:37.281Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:37.282Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:37.283Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:37.284Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:37.284Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:37.284Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 193","timestamp":"2025-04-17T05:47:37.285Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:37.285Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:37.289Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:37.292Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:37.292Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:37.292Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 193","timestamp":"2025-04-17T05:47:37.293Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:37.293Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:37.295Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:37.296Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:37.297Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:37.297Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 193","timestamp":"2025-04-17T05:47:37.297Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:37.298Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:37.300Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:37.300Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:37.301Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:37.302Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 193","timestamp":"2025-04-17T05:47:37.303Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:37.303Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:37.312Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:37.313Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:37.313Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:37.313Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:37.313Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:37.313Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:37.313Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:37.313Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:37.313Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.313Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":193,"timestamp":"2025-04-17T05:47:37.313Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:37.313Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:37.313Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:37.314Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:37.316Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:37.316Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:37.316Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:37.316Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:37.316Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:37.316Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:37.317Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:37.317Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:37.317Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.317Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":193,"timestamp":"2025-04-17T05:47:37.317Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:37.317Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:37.318Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:37.318Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:37.320Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:37.328Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:37.328Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:37.328Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:37.328Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:37.328Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:37.329Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:37.329Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:37.329Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.329Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":193,"timestamp":"2025-04-17T05:47:37.329Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:37.329Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:37.329Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:37.329Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:37.330Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:37.331Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:37.331Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:37.331Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:37.331Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:37.331Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:37.331Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:37.331Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:37.331Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:47:37.332Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":193,"timestamp":"2025-04-17T05:47:37.332Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:37.332Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:37.332Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:37.332Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:38.722Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10572ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:38.723Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbf: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:38.730Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:38.731Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:38.762Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:38.763Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:38.763Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 23% (10/43)","timestamp":"2025-04-17T05:47:38.763Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 23%","timestamp":"2025-04-17T05:47:38.765Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:38.765Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:38.765Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:38.766Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:38.785Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:38.786Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc0.","timestamp":"2025-04-17T05:47:38.792Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc0 status to TRANSLATING.","timestamp":"2025-04-17T05:47:38.793Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:38.799Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:38.802Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:38.805Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:38.806Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:38.806Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 163","timestamp":"2025-04-17T05:47:38.806Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:38.806Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:38.808Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:38.808Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:38.808Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:38.808Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:38.808Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:38.808Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:38.808Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:38.808Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:38.808Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:47:38.808Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":163,"timestamp":"2025-04-17T05:47:38.809Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:38.809Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:38.809Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:38.809Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:47.850Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10518ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:47.851Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc5: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.853Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:47.853Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:47.855Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10542ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:47.855Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc5: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.856Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:47.856Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:47.857Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10528ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:47.857Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc5: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.857Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:47.857Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:47.859Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10542ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:47.860Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc5: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.860Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:47.860Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.895Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.895Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cc5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:47.899Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 33% (14/43)","timestamp":"2025-04-17T05:47:47.899Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.901Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.902Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:47.902Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 33% (14/43)","timestamp":"2025-04-17T05:47:47.903Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.905Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.905Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cc5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:47.905Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 33% (14/43)","timestamp":"2025-04-17T05:47:47.905Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.906Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:47.906Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cc5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:47.906Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 33% (14/43)","timestamp":"2025-04-17T05:47:47.907Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 33%","timestamp":"2025-04-17T05:47:47.907Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 33%","timestamp":"2025-04-17T05:47:47.907Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 33%","timestamp":"2025-04-17T05:47:47.907Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cc6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:47.907Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:47.908Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:47.908Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:47.908Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:47.908Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:47.908Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cc6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:47.909Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:47.909Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:47.909Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 33%","timestamp":"2025-04-17T05:47:47.911Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cc6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:47.911Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:47.911Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:47.911Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:47.926Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:47.926Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:47.928Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:47.953Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:47.954Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:47.955Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:47.956Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:47.957Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc6.","timestamp":"2025-04-17T05:47:47.957Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc6 status to TRANSLATING.","timestamp":"2025-04-17T05:47:47.957Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc6.","timestamp":"2025-04-17T05:47:47.959Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc6 status to TRANSLATING.","timestamp":"2025-04-17T05:47:47.959Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc6.","timestamp":"2025-04-17T05:47:47.961Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc6 status to TRANSLATING.","timestamp":"2025-04-17T05:47:47.962Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc6.","timestamp":"2025-04-17T05:47:47.963Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc6 status to TRANSLATING.","timestamp":"2025-04-17T05:47:47.963Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:47.981Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:47.982Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:47.983Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:47.985Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:47.986Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:47.986Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:47.987Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:47.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 116","timestamp":"2025-04-17T05:47:47.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:47.987Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:47.988Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:47.988Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:47.988Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:47.988Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 116","timestamp":"2025-04-17T05:47:47.988Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:47.988Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:47.989Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:47.989Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:47.989Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:47.989Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 116","timestamp":"2025-04-17T05:47:47.990Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:47.990Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:47.991Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:47.991Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:47.991Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:47.991Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 116","timestamp":"2025-04-17T05:47:47.991Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:47.991Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:47.993Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:47.997Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:47.997Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:47.997Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:47.997Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:47.997Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:47.997Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:47.997Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:47.997Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:47.997Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":116,"timestamp":"2025-04-17T05:47:47.997Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:47.997Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:47.998Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:47.998Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:47.999Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:47.999Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:47.999Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:47.999Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:47.999Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:48.000Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:48.000Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:48.000Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:48.000Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:48.000Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":116,"timestamp":"2025-04-17T05:47:48.000Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:48.000Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:48.000Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:48.000Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:48.002Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:48.002Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:48.003Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:48.003Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:48.003Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:48.003Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:48.003Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:48.003Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:48.003Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:48.003Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":116,"timestamp":"2025-04-17T05:47:48.003Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:48.003Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:48.003Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:48.004Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:48.005Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:48.005Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:48.005Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:48.005Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:48.005Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:48.005Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:48.005Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:48.005Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:48.005Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:47:48.006Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":116,"timestamp":"2025-04-17T05:47:48.006Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:48.006Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:48.006Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:48.006Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:49.356Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10547ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:49.357Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc0: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:49.364Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:49.365Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:49.379Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:49.380Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:49.380Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 26% (11/43)","timestamp":"2025-04-17T05:47:49.381Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 26%","timestamp":"2025-04-17T05:47:49.382Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:49.382Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:49.382Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:49.383Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:49.393Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:49.394Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc3.","timestamp":"2025-04-17T05:47:49.397Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc3 status to TRANSLATING.","timestamp":"2025-04-17T05:47:49.397Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:49.420Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:49.424Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:49.424Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:49.424Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:49.425Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 177","timestamp":"2025-04-17T05:47:49.425Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:49.425Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:49.427Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:49.427Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:49.427Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:49.427Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:49.427Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:49.428Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:49.428Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:49.428Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:49.428Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:47:49.428Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":177,"timestamp":"2025-04-17T05:47:49.428Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:49.428Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:49.428Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:49.429Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:58.503Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10496ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:58.504Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc6: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.510Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:58.510Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:58.513Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10515ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:58.513Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc6: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.514Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:58.514Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:58.515Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10512ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:58.515Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc6: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.516Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:58.516Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:58.517Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10517ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:47:58.517Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc6: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.518Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:47:58.525Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.528Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.529Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cc6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:58.529Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 35% (15/43)","timestamp":"2025-04-17T05:47:58.529Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.530Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.530Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cc6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:58.530Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 35% (15/43)","timestamp":"2025-04-17T05:47:58.530Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.531Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.531Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cc6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:58.531Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 35% (15/43)","timestamp":"2025-04-17T05:47:58.531Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.532Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:47:58.532Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:47:58.532Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 35% (15/43)","timestamp":"2025-04-17T05:47:58.532Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 35%","timestamp":"2025-04-17T05:47:58.533Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 35%","timestamp":"2025-04-17T05:47:58.533Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 35%","timestamp":"2025-04-17T05:47:58.533Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cc7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:58.533Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.533Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:58.533Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cc7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:58.533Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.534Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:58.540Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cc7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:58.541Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.541Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:58.541Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 35%","timestamp":"2025-04-17T05:47:58.543Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:47:58.544Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.544Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:47:58.544Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.558Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:58.558Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.561Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:58.561Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.563Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:58.563Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.564Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:47:58.564Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc7.","timestamp":"2025-04-17T05:47:58.565Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc7 status to TRANSLATING.","timestamp":"2025-04-17T05:47:58.565Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc7.","timestamp":"2025-04-17T05:47:58.566Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc7 status to TRANSLATING.","timestamp":"2025-04-17T05:47:58.584Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc7.","timestamp":"2025-04-17T05:47:58.586Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc7 status to TRANSLATING.","timestamp":"2025-04-17T05:47:58.586Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc7.","timestamp":"2025-04-17T05:47:58.588Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc7 status to TRANSLATING.","timestamp":"2025-04-17T05:47:58.588Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:58.589Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:58.590Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:58.590Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:58.590Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:58.590Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 164","timestamp":"2025-04-17T05:47:58.590Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:58.590Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:58.592Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:58.592Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:58.592Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:58.592Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:58.593Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:58.593Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:58.593Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:58.593Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:58.593Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.593Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":164,"timestamp":"2025-04-17T05:47:58.593Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:58.593Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:58.593Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:58.594Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:58.600Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:58.605Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:47:58.606Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:58.607Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:58.607Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:58.607Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:58.608Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 164","timestamp":"2025-04-17T05:47:58.608Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:58.608Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:58.609Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:58.609Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:58.609Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:58.609Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 164","timestamp":"2025-04-17T05:47:58.609Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:58.609Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:47:58.610Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:47:58.611Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:47:58.611Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:47:58.611Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 164","timestamp":"2025-04-17T05:47:58.611Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:47:58.611Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:58.613Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:58.613Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:58.613Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:58.620Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:58.620Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:58.620Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:58.620Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:58.620Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:58.620Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.621Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":164,"timestamp":"2025-04-17T05:47:58.621Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:58.621Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:58.621Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:58.621Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:58.622Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:58.623Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:58.623Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:58.623Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:58.623Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:58.623Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:58.623Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:58.623Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:58.624Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.624Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":164,"timestamp":"2025-04-17T05:47:58.624Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:58.624Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:58.624Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:58.625Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:47:58.626Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:47:58.627Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:47:58.627Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:47:58.627Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:47:58.627Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:47:58.627Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:47:58.627Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:47:58.627Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:47:58.627Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:47:58.627Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":164,"timestamp":"2025-04-17T05:47:58.628Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:47:58.628Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:47:58.628Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:47:58.628Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:00.004Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10576ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:00.006Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc3: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:00.015Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:00.015Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:00.042Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:00.043Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:00.045Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 28% (12/43)","timestamp":"2025-04-17T05:48:00.045Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 28%","timestamp":"2025-04-17T05:48:00.047Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:00.047Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:48:00.047Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:00.047Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:48:00.059Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:00.059Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc5.","timestamp":"2025-04-17T05:48:00.063Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc5 status to TRANSLATING.","timestamp":"2025-04-17T05:48:00.064Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:00.083Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:00.087Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:00.088Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:00.089Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:00.089Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 193","timestamp":"2025-04-17T05:48:00.089Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:00.089Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:00.093Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:00.093Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:00.094Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:00.094Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:00.094Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:00.095Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:00.095Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:00.096Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:00.096Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:48:00.096Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":193,"timestamp":"2025-04-17T05:48:00.096Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:00.105Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:00.106Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:00.106Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:09.143Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10515ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:09.144Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc7: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.151Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:09.151Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:09.155Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10561ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:09.155Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc7: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.156Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:09.157Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:09.160Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10536ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:09.161Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc7: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.161Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:09.162Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:09.164Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10543ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:09.165Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc7: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.165Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:09.165Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.167Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.168Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cc7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:09.168Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 37% (16/43)","timestamp":"2025-04-17T05:48:09.168Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.170Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.170Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cc7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:09.170Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 37% (16/43)","timestamp":"2025-04-17T05:48:09.171Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 37%","timestamp":"2025-04-17T05:48:09.171Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cc8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:09.171Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.171Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:09.172Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 37%","timestamp":"2025-04-17T05:48:09.173Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cc8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:09.179Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.180Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:09.180Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.182Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.182Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:09.182Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 37% (16/43)","timestamp":"2025-04-17T05:48:09.182Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.183Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:09.183Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cc7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:09.183Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 37% (16/43)","timestamp":"2025-04-17T05:48:09.184Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 37%","timestamp":"2025-04-17T05:48:09.186Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 37%","timestamp":"2025-04-17T05:48:09.187Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:09.187Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.187Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:09.187Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cc8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:09.189Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.189Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:09.189Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.197Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:09.197Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.198Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:09.198Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc8.","timestamp":"2025-04-17T05:48:09.202Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc8 status to TRANSLATING.","timestamp":"2025-04-17T05:48:09.202Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc8.","timestamp":"2025-04-17T05:48:09.204Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc8 status to TRANSLATING.","timestamp":"2025-04-17T05:48:09.208Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.211Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:09.211Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.213Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:09.213Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:09.214Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc8.","timestamp":"2025-04-17T05:48:09.215Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc8 status to TRANSLATING.","timestamp":"2025-04-17T05:48:09.215Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:09.215Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc8.","timestamp":"2025-04-17T05:48:09.216Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc8 status to TRANSLATING.","timestamp":"2025-04-17T05:48:09.216Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:09.218Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:09.221Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:09.221Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:09.222Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:48:09.222Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:09.222Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:09.223Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:09.223Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:09.223Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:09.223Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:48:09.223Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:09.223Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:09.224Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:09.225Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:09.226Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:09.226Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:09.226Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:09.226Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:09.226Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:09.227Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:09.227Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:09.227Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:09.227Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.227Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:48:09.227Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:09.227Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:09.227Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:09.228Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:09.230Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:09.230Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:09.230Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:09.230Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:48:09.230Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:09.231Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:09.232Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:09.232Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:09.232Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:09.232Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:48:09.232Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:09.233Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:09.234Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:09.240Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:09.240Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:09.240Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:09.240Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:09.240Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:09.241Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:09.241Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:09.241Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.241Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:48:09.241Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:09.241Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:09.241Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:09.241Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:09.243Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:09.243Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:09.243Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:09.243Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:09.243Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:09.243Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:09.243Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:09.243Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:09.243Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.244Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:48:09.244Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:09.244Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:09.244Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:09.244Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:09.245Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:09.246Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:09.247Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:09.247Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:09.247Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:09.247Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:09.247Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:09.247Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:09.247Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:09.247Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:48:09.247Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:09.247Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:09.247Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:09.248Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:10.666Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10570ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:10.668Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc5: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:10.673Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:10.673Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:10.683Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:10.688Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:10.689Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 30% (13/43)","timestamp":"2025-04-17T05:48:10.689Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 30%","timestamp":"2025-04-17T05:48:10.690Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:10.690Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:48:10.690Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:10.690Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:48:10.698Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:10.700Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc6.","timestamp":"2025-04-17T05:48:10.702Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc6 status to TRANSLATING.","timestamp":"2025-04-17T05:48:10.703Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:10.714Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:10.718Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:10.718Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:10.718Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:10.718Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 116","timestamp":"2025-04-17T05:48:10.719Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:10.719Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:10.722Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:10.722Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:10.722Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:10.722Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:10.723Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:10.723Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:10.723Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:10.723Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:10.723Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:48:10.724Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":116,"timestamp":"2025-04-17T05:48:10.724Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:10.724Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:10.724Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:10.725Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:19.775Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10527ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:19.776Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc8: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.782Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:19.782Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:19.787Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10559ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:19.787Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc8: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.787Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:19.788Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:19.790Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10546ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:19.796Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc8: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.797Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:19.797Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:19.799Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10557ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:19.799Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc8: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.799Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:19.799Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.803Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.803Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cc8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:19.803Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 40% (17/43)","timestamp":"2025-04-17T05:48:19.803Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.804Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.804Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cc8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:19.804Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 40% (17/43)","timestamp":"2025-04-17T05:48:19.812Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 40%","timestamp":"2025-04-17T05:48:19.813Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 40%","timestamp":"2025-04-17T05:48:19.813Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cc9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:19.813Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.813Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:19.813Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cc9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:19.813Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.813Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:19.813Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.815Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.815Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cc8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:19.815Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 40% (17/43)","timestamp":"2025-04-17T05:48:19.815Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.816Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:19.816Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:19.816Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 40% (17/43)","timestamp":"2025-04-17T05:48:19.817Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 40%","timestamp":"2025-04-17T05:48:19.820Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 40%","timestamp":"2025-04-17T05:48:19.821Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cc9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:19.822Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.822Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:19.822Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:19.823Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.823Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:19.824Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.839Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:19.844Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.846Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:19.847Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc9.","timestamp":"2025-04-17T05:48:19.851Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc9 status to TRANSLATING.","timestamp":"2025-04-17T05:48:19.852Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc9.","timestamp":"2025-04-17T05:48:19.854Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc9 status to TRANSLATING.","timestamp":"2025-04-17T05:48:19.854Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.856Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:19.856Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.857Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:19.857Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc9.","timestamp":"2025-04-17T05:48:19.858Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc9 status to TRANSLATING.","timestamp":"2025-04-17T05:48:19.858Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc9.","timestamp":"2025-04-17T05:48:19.861Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc9 status to TRANSLATING.","timestamp":"2025-04-17T05:48:19.861Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:19.871Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:19.880Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:19.881Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:19.881Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:19.882Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:19.883Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:19.883Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:19.884Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:48:19.884Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:19.884Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:19.887Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:19.887Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:19.887Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:19.887Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:48:19.887Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:19.887Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:19.888Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:19.888Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:19.889Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:19.889Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:48:19.889Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:19.889Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:19.890Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:19.890Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:19.890Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:19.890Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:48:19.890Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:19.890Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:19.891Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:19.891Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:19.891Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:19.891Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:19.891Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:19.891Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:19.891Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:19.891Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:19.892Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.892Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:48:19.892Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:19.892Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:19.893Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:19.893Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:19.895Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:19.895Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:19.895Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:19.895Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:19.895Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:19.895Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:19.895Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:19.895Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:19.895Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.896Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:48:19.897Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:19.897Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:19.897Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:19.897Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:19.898Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:19.905Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:19.905Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:19.905Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:19.905Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:19.906Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:19.906Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:19.906Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:19.906Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.906Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:48:19.906Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:19.906Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:19.906Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:19.906Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:19.907Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:19.908Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:19.908Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:19.908Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:19.908Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:19.908Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:19.908Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:19.908Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:19.908Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:19.908Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:48:19.908Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:19.908Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:19.908Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:19.908Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:21.301Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10576ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:21.303Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc6: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:21.308Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:21.309Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:21.322Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:21.323Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:21.323Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 33% (14/43)","timestamp":"2025-04-17T05:48:21.324Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 33%","timestamp":"2025-04-17T05:48:21.324Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:21.325Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:48:21.325Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:21.325Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:48:21.333Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:21.337Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc7.","timestamp":"2025-04-17T05:48:21.339Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc7 status to TRANSLATING.","timestamp":"2025-04-17T05:48:21.340Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:21.345Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:21.348Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:21.356Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:21.356Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:21.357Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 164","timestamp":"2025-04-17T05:48:21.357Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:21.357Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:21.359Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:21.360Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:21.360Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:21.360Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:21.361Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:21.361Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:21.361Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:21.361Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:21.361Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:48:21.361Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":164,"timestamp":"2025-04-17T05:48:21.362Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:21.362Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:21.362Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:21.362Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:30.422Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10514ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:30.423Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc9: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.430Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:30.431Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:30.434Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10542ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:30.435Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc9: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.435Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:30.436Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:30.439Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10533ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:30.440Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc9: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.441Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:30.442Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:30.445Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10547ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:30.445Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc9: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.445Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:30.445Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.447Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.447Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cc9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:30.447Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 42% (18/43)","timestamp":"2025-04-17T05:48:30.447Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.448Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.448Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cc9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:30.448Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 42% (18/43)","timestamp":"2025-04-17T05:48:30.449Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 42%","timestamp":"2025-04-17T05:48:30.449Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cca in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:30.449Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.449Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cca, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:30.449Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 42%","timestamp":"2025-04-17T05:48:30.450Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cca in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:30.450Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.450Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cca, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:30.451Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.455Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.459Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:30.460Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 42% (18/43)","timestamp":"2025-04-17T05:48:30.460Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.461Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:30.461Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cc9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:30.462Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 42% (18/43)","timestamp":"2025-04-17T05:48:30.462Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 42%","timestamp":"2025-04-17T05:48:30.463Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 42%","timestamp":"2025-04-17T05:48:30.464Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cca in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:30.464Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.464Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cca, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:30.464Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cca in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:30.464Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.464Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cca, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:30.464Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.472Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:30.473Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.476Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:30.476Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cca.","timestamp":"2025-04-17T05:48:30.477Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cca status to TRANSLATING.","timestamp":"2025-04-17T05:48:30.478Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cca.","timestamp":"2025-04-17T05:48:30.482Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cca status to TRANSLATING.","timestamp":"2025-04-17T05:48:30.482Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.484Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:30.496Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.499Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:30.499Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:30.502Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:30.504Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cca.","timestamp":"2025-04-17T05:48:30.505Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cca status to TRANSLATING.","timestamp":"2025-04-17T05:48:30.505Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cca.","timestamp":"2025-04-17T05:48:30.505Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cca status to TRANSLATING.","timestamp":"2025-04-17T05:48:30.505Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:30.506Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:30.506Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:30.507Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:30.507Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 211","timestamp":"2025-04-17T05:48:30.507Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:30.507Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:30.508Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:30.508Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:30.509Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:30.509Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 211","timestamp":"2025-04-17T05:48:30.509Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:30.509Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:30.510Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:30.512Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:30.512Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:30.512Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:30.512Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:30.512Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:30.512Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:30.512Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:30.512Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:30.512Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.512Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":211,"timestamp":"2025-04-17T05:48:30.512Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:30.512Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:30.512Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:30.513Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:30.514Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:30.514Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:30.515Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:30.523Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:30.523Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:30.523Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:30.523Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:30.523Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:30.523Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:30.523Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.523Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":211,"timestamp":"2025-04-17T05:48:30.524Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:30.524Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:30.524Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:30.524Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:30.526Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:30.527Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:30.527Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:30.527Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 211","timestamp":"2025-04-17T05:48:30.527Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:30.527Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:30.528Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:30.529Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:30.529Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:30.529Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 211","timestamp":"2025-04-17T05:48:30.529Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:30.529Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:30.530Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:30.531Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:30.531Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:30.531Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:30.532Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:30.532Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:30.532Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:30.532Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:30.532Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.532Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":211,"timestamp":"2025-04-17T05:48:30.532Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:30.532Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:30.532Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:30.532Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:30.534Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:30.535Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:30.535Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:30.535Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:30.535Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:30.535Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:30.535Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:30.536Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:30.536Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:30.536Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":211,"timestamp":"2025-04-17T05:48:30.536Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:30.536Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:30.537Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:30.537Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:31.951Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10588ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:31.952Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc7: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:31.953Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:31.954Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:31.969Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:31.972Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:31.973Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 35% (15/43)","timestamp":"2025-04-17T05:48:31.973Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 35%","timestamp":"2025-04-17T05:48:31.975Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:31.976Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:31.976Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:31.976Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:31.986Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:31.986Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc8.","timestamp":"2025-04-17T05:48:31.988Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc8 status to TRANSLATING.","timestamp":"2025-04-17T05:48:31.988Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:31.997Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:32.001Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:32.001Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:32.001Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:32.002Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:48:32.002Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:32.002Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:32.004Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:32.004Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:32.004Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:32.004Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:32.004Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:32.004Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:32.004Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:32.004Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:32.004Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:48:32.004Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:48:32.004Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:32.004Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:32.005Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:32.005Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:41.079Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10542ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:41.081Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cca: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.086Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cca as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:41.087Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:41.090Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10577ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:41.090Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cca: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.090Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cca as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:41.090Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:41.092Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10560ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:41.092Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cca: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.093Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cca as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:41.093Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:41.096Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10572ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:41.101Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cca: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.102Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cca as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:41.102Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.105Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.106Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cca not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:41.106Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 44% (19/43)","timestamp":"2025-04-17T05:48:41.106Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.106Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.107Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cca not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:41.107Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 44% (19/43)","timestamp":"2025-04-17T05:48:41.107Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 44%","timestamp":"2025-04-17T05:48:41.107Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6ccb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:41.107Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.107Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:41.107Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 44%","timestamp":"2025-04-17T05:48:41.108Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6ccb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:41.108Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.108Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:41.108Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.114Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.117Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cca not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:41.117Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 44% (19/43)","timestamp":"2025-04-17T05:48:41.118Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.118Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:41.119Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cca not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:41.119Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 44% (19/43)","timestamp":"2025-04-17T05:48:41.119Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 44%","timestamp":"2025-04-17T05:48:41.122Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 44%","timestamp":"2025-04-17T05:48:41.122Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6ccb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:41.122Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.123Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:41.123Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:41.123Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.123Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:41.123Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.131Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:41.131Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.134Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:41.134Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccb.","timestamp":"2025-04-17T05:48:41.137Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccb status to TRANSLATING.","timestamp":"2025-04-17T05:48:41.137Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccb.","timestamp":"2025-04-17T05:48:41.138Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccb status to TRANSLATING.","timestamp":"2025-04-17T05:48:41.138Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.143Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:41.150Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:41.152Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:41.153Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.155Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:41.155Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccb.","timestamp":"2025-04-17T05:48:41.156Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccb status to TRANSLATING.","timestamp":"2025-04-17T05:48:41.156Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:41.157Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:41.157Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:41.158Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:41.158Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 173","timestamp":"2025-04-17T05:48:41.158Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:41.158Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:41.159Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:41.159Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:41.159Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:41.160Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 173","timestamp":"2025-04-17T05:48:41.160Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:41.160Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccb.","timestamp":"2025-04-17T05:48:41.161Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccb status to TRANSLATING.","timestamp":"2025-04-17T05:48:41.162Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:41.163Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:41.164Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:41.164Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:41.164Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:41.164Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:41.165Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:41.165Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:41.165Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:41.165Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:41.165Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.165Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":173,"timestamp":"2025-04-17T05:48:41.165Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:41.165Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:41.165Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:41.166Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:41.167Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:41.167Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:41.167Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:41.167Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:41.167Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:41.167Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:41.168Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:41.168Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:41.168Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.168Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":173,"timestamp":"2025-04-17T05:48:41.168Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:41.168Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:41.168Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:41.168Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:41.170Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:41.170Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:41.170Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:41.170Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 173","timestamp":"2025-04-17T05:48:41.170Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:41.170Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:41.173Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:41.180Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:41.180Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:41.180Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:41.180Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:41.180Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:41.180Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:41.180Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:41.180Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.180Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":173,"timestamp":"2025-04-17T05:48:41.181Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:41.181Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:41.181Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:41.181Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:41.182Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:41.184Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:41.184Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:41.184Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:41.184Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 173","timestamp":"2025-04-17T05:48:41.184Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:41.185Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:41.186Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:41.187Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:41.187Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:41.187Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:41.187Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:41.187Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:41.188Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:41.188Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:41.188Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:48:41.188Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":173,"timestamp":"2025-04-17T05:48:41.188Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:41.188Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:41.188Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:41.188Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:42.592Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10587ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:42.593Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc8: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:42.598Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:42.600Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:42.614Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:42.615Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:42.615Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 37% (16/43)","timestamp":"2025-04-17T05:48:42.615Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 37%","timestamp":"2025-04-17T05:48:42.617Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:42.617Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:42.617Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:42.618Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:42.631Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:42.631Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc9.","timestamp":"2025-04-17T05:48:42.634Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc9 status to TRANSLATING.","timestamp":"2025-04-17T05:48:42.635Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:42.640Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:42.646Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:42.646Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:42.646Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:42.646Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:48:42.647Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:42.647Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:42.649Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:42.649Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:42.649Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:42.649Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:42.649Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:42.649Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:42.650Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:42.650Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:42.650Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:48:42.650Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:48:42.650Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:42.650Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:42.650Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:42.650Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:51.680Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10492ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:51.681Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccb: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.688Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:51.688Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:51.692Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10526ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:51.692Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccb: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.693Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:51.695Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:51.699Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10519ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:51.699Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccb: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.700Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:51.700Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:51.702Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10534ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:51.703Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccb: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.703Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:51.704Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.706Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.706Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:51.706Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 47% (20/43)","timestamp":"2025-04-17T05:48:51.706Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.708Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.709Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6ccb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:51.709Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 47% (20/43)","timestamp":"2025-04-17T05:48:51.717Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 47%","timestamp":"2025-04-17T05:48:51.718Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:51.718Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.718Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:51.718Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.720Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.720Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6ccb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:51.720Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 47% (20/43)","timestamp":"2025-04-17T05:48:51.720Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.721Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:51.721Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6ccb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:51.721Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 47% (20/43)","timestamp":"2025-04-17T05:48:51.721Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 47%","timestamp":"2025-04-17T05:48:51.721Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 47%","timestamp":"2025-04-17T05:48:51.721Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6ccc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:51.721Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.721Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:51.721Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6ccc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:51.722Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.722Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:51.722Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 47%","timestamp":"2025-04-17T05:48:51.723Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6ccc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:51.723Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.723Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:51.723Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.737Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:51.737Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.738Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:51.738Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.741Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:51.746Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.747Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:51.748Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccc.","timestamp":"2025-04-17T05:48:51.749Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccc status to TRANSLATING.","timestamp":"2025-04-17T05:48:51.749Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccc.","timestamp":"2025-04-17T05:48:51.750Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccc status to TRANSLATING.","timestamp":"2025-04-17T05:48:51.750Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccc.","timestamp":"2025-04-17T05:48:51.751Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccc status to TRANSLATING.","timestamp":"2025-04-17T05:48:51.751Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccc.","timestamp":"2025-04-17T05:48:51.753Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccc status to TRANSLATING.","timestamp":"2025-04-17T05:48:51.753Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:51.755Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:51.764Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:51.765Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:51.766Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:51.767Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:51.767Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:51.767Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 124","timestamp":"2025-04-17T05:48:51.767Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:51.768Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:51.769Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:51.770Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:51.770Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:51.770Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 124","timestamp":"2025-04-17T05:48:51.770Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:51.770Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:51.771Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:51.774Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:51.775Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:51.775Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 124","timestamp":"2025-04-17T05:48:51.775Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:51.776Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:51.777Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:51.777Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:51.777Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:51.777Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:51.777Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:51.777Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:51.777Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:51.777Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:51.778Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.778Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":124,"timestamp":"2025-04-17T05:48:51.778Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:51.778Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:51.778Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:51.778Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:51.780Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:51.780Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:51.780Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:51.780Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:51.780Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:51.780Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:51.780Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:51.780Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:51.780Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.781Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":124,"timestamp":"2025-04-17T05:48:51.781Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:51.781Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:51.781Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:51.781Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:51.782Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:51.783Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:51.783Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:51.783Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:51.784Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:51.784Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:51.784Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:51.784Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:51.784Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:51.784Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.784Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":124,"timestamp":"2025-04-17T05:48:51.785Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:51.785Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:51.785Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:51.785Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:51.788Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:51.796Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:51.796Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:51.796Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 124","timestamp":"2025-04-17T05:48:51.796Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:51.796Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:51.797Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:51.798Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:51.798Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:51.798Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:51.798Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:51.798Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:51.798Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:51.798Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:51.798Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:48:51.798Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":124,"timestamp":"2025-04-17T05:48:51.798Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:51.798Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:51.798Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:51.798Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:53.204Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10554ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:48:53.205Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc9: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:53.211Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:48:53.211Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:53.229Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:48:53.229Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:48:53.229Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 40% (17/43)","timestamp":"2025-04-17T05:48:53.229Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 40%","timestamp":"2025-04-17T05:48:53.231Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cca in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:48:53.231Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:53.231Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cca, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:48:53.231Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:53.247Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:48:53.248Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cca.","timestamp":"2025-04-17T05:48:53.253Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cca status to TRANSLATING.","timestamp":"2025-04-17T05:48:53.255Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:48:53.268Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:48:53.275Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:48:53.275Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:48:53.276Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:48:53.276Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 211","timestamp":"2025-04-17T05:48:53.277Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:48:53.277Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:48:53.280Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:48:53.287Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:48:53.288Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:48:53.288Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:48:53.288Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:48:53.288Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:48:53.289Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:48:53.289Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:48:53.289Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:48:53.289Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":211,"timestamp":"2025-04-17T05:48:53.289Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:48:53.290Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:48:53.290Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:48:53.290Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:02.315Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10517ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:02.316Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccc: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.320Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:02.320Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:02.322Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10544ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:02.323Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccc: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.323Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:02.323Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:02.325Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10540ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:02.325Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccc: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.326Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:02.326Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:02.327Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10546ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:02.328Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccc: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.328Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:02.328Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.332Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.338Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6ccc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:02.338Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 49% (21/43)","timestamp":"2025-04-17T05:49:02.338Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.339Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.339Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:02.339Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 49% (21/43)","timestamp":"2025-04-17T05:49:02.339Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.340Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.340Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6ccc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:02.340Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 49% (21/43)","timestamp":"2025-04-17T05:49:02.341Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 49%","timestamp":"2025-04-17T05:49:02.341Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 49%","timestamp":"2025-04-17T05:49:02.341Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6ccd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:02.341Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.341Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:02.341Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:02.342Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.342Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:02.342Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 49%","timestamp":"2025-04-17T05:49:02.343Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6ccd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:02.344Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.344Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:02.345Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.348Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:02.348Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6ccc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:02.349Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 49% (21/43)","timestamp":"2025-04-17T05:49:02.349Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 49%","timestamp":"2025-04-17T05:49:02.353Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6ccd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:02.354Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.354Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:02.354Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.359Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:02.359Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.363Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:02.373Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.374Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:02.375Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccd.","timestamp":"2025-04-17T05:49:02.380Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccd status to TRANSLATING.","timestamp":"2025-04-17T05:49:02.380Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccd.","timestamp":"2025-04-17T05:49:02.381Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccd status to TRANSLATING.","timestamp":"2025-04-17T05:49:02.381Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccd.","timestamp":"2025-04-17T05:49:02.382Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccd status to TRANSLATING.","timestamp":"2025-04-17T05:49:02.382Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.387Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:02.387Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccd.","timestamp":"2025-04-17T05:49:02.389Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccd status to TRANSLATING.","timestamp":"2025-04-17T05:49:02.389Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:02.395Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:02.399Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:02.400Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:02.401Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:02.404Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:02.404Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:02.404Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:02.404Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 149","timestamp":"2025-04-17T05:49:02.404Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:02.404Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:02.406Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:02.406Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:02.406Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:02.406Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 149","timestamp":"2025-04-17T05:49:02.406Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:02.406Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:02.407Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:02.407Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:02.407Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:02.407Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 149","timestamp":"2025-04-17T05:49:02.407Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:02.408Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:02.408Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:02.413Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:02.413Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:02.414Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 149","timestamp":"2025-04-17T05:49:02.414Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:02.414Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:02.415Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:02.415Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:02.415Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:02.415Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:02.415Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:02.415Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:02.415Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:02.415Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:02.415Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.415Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":149,"timestamp":"2025-04-17T05:49:02.415Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:02.415Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:02.416Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:02.416Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:02.418Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:02.419Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:02.419Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:02.419Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:02.419Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:02.419Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:02.419Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:02.419Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:02.419Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.420Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":149,"timestamp":"2025-04-17T05:49:02.420Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:02.420Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:02.420Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:02.420Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:02.421Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:02.421Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:02.421Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:02.421Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:02.422Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:02.422Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:02.422Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:02.422Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:02.422Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.422Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":149,"timestamp":"2025-04-17T05:49:02.422Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:02.422Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:02.422Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:02.423Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:02.424Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:02.424Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:02.433Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:02.434Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:02.434Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:02.434Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:02.434Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:02.434Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:02.434Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:02.434Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":149,"timestamp":"2025-04-17T05:49:02.434Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:02.435Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:02.435Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:02.435Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:03.831Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10541ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:03.832Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cca: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:03.834Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cca as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:03.835Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:03.847Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:03.848Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cca not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:03.849Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 42% (18/43)","timestamp":"2025-04-17T05:49:03.849Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 42%","timestamp":"2025-04-17T05:49:03.849Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:03.849Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:49:03.849Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:03.849Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:49:03.859Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:03.859Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccb.","timestamp":"2025-04-17T05:49:03.862Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccb status to TRANSLATING.","timestamp":"2025-04-17T05:49:03.862Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:03.869Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:03.871Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:03.872Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:03.872Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:03.872Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 173","timestamp":"2025-04-17T05:49:03.872Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:03.872Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:03.874Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:03.874Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:03.874Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:03.874Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:03.874Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:03.874Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:03.874Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:03.874Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:03.874Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:49:03.875Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":173,"timestamp":"2025-04-17T05:49:03.875Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:03.875Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:03.875Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:03.875Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:12.991Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10557ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:15.931Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccd: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.945Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:15.951Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:15.952Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 13537ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:15.953Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccd: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.954Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:15.954Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:15.956Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 13534ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:15.956Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccd: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.957Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:15.957Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:15.958Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 13538ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:15.958Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccd: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.959Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:15.967Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.970Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.970Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6ccd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:15.971Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 51% (22/43)","timestamp":"2025-04-17T05:49:15.971Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.973Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.973Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:15.973Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 51% (22/43)","timestamp":"2025-04-17T05:49:15.973Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.974Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.974Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6ccd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:15.975Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 51% (22/43)","timestamp":"2025-04-17T05:49:15.975Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 51%","timestamp":"2025-04-17T05:49:15.975Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 51%","timestamp":"2025-04-17T05:49:15.975Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 51%","timestamp":"2025-04-17T05:49:15.975Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cce in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:15.975Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:15.976Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cce, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:15.976Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cce in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:15.976Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:15.977Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cce, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:15.977Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cce in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:15.977Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:15.977Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cce, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:15.978Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.979Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:15.980Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6ccd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:15.980Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 51% (22/43)","timestamp":"2025-04-17T05:49:15.980Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 51%","timestamp":"2025-04-17T05:49:15.983Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cce in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:15.983Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:15.983Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cce, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:15.983Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:15.996Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:15.998Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:15.999Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:15.999Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:16.002Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:16.002Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cce.","timestamp":"2025-04-17T05:49:16.006Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cce status to TRANSLATING.","timestamp":"2025-04-17T05:49:16.012Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cce.","timestamp":"2025-04-17T05:49:16.014Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cce status to TRANSLATING.","timestamp":"2025-04-17T05:49:16.014Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cce.","timestamp":"2025-04-17T05:49:16.015Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cce status to TRANSLATING.","timestamp":"2025-04-17T05:49:16.016Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:16.018Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:16.018Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cce.","timestamp":"2025-04-17T05:49:16.021Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cce status to TRANSLATING.","timestamp":"2025-04-17T05:49:16.021Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:16.023Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:16.031Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:16.032Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:16.033Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:16.034Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:16.034Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:16.034Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:49:16.034Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:16.034Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:16.036Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:16.037Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:16.037Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:16.037Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:49:16.037Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:16.037Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:16.038Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:16.038Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:16.038Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:16.039Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:49:16.039Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:16.039Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:16.041Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:16.042Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:16.042Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:16.042Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:16.043Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:16.043Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:16.043Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:16.044Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:16.044Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:16.044Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:49:16.045Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:16.045Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:16.046Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:16.046Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:16.048Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:16.049Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:16.049Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:16.050Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:16.050Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:16.050Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:16.050Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:16.051Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:16.052Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:16.052Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:49:16.053Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:16.053Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:16.064Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:16.064Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:16.066Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:16.068Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:16.068Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:16.068Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:16.069Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:16.069Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:16.069Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:16.069Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:16.069Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:16.070Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:16.070Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:49:16.070Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:16.071Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:16.071Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:16.072Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:16.076Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:16.077Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:16.077Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:16.077Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:49:16.078Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:16.078Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:16.080Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:16.081Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:16.081Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:16.082Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:16.083Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:16.083Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:16.084Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:16.084Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:16.084Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:16.085Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:49:16.085Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:16.096Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:16.097Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:16.097Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:16.985Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 13110ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:16.987Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccb: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:16.992Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:16.993Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:17.010Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:17.011Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:17.012Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 44% (19/43)","timestamp":"2025-04-17T05:49:17.012Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 44%","timestamp":"2025-04-17T05:49:17.014Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:17.014Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:49:17.014Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:17.015Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:49:17.030Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:17.030Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccc.","timestamp":"2025-04-17T05:49:17.033Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccc status to TRANSLATING.","timestamp":"2025-04-17T05:49:17.038Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:17.049Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:17.052Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:17.052Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:17.052Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:17.052Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 124","timestamp":"2025-04-17T05:49:17.053Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:17.053Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:17.056Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:17.056Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:17.056Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:17.056Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:17.056Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:17.056Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:17.057Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:17.057Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:17.057Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:49:17.057Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":124,"timestamp":"2025-04-17T05:49:17.057Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:17.057Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:17.058Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:17.058Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:26.593Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10508ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:26.594Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cce: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.597Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cce as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:26.597Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:26.599Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10554ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:26.599Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cce: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.600Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cce as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:26.600Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:26.605Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10534ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:26.605Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cce: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.606Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cce as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:26.606Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:26.608Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10555ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:26.609Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cce: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.616Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cce as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:26.617Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.621Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.622Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cce not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:26.622Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 53% (23/43)","timestamp":"2025-04-17T05:49:26.622Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.623Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.623Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cce not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:26.623Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 53% (23/43)","timestamp":"2025-04-17T05:49:26.623Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 53%","timestamp":"2025-04-17T05:49:26.624Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6ccf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:26.624Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.624Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:26.625Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 53%","timestamp":"2025-04-17T05:49:26.635Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6ccf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:26.635Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.635Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:26.636Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.638Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.639Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cce not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:26.639Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 53% (23/43)","timestamp":"2025-04-17T05:49:26.639Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.641Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:26.642Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cce not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:26.642Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 53% (23/43)","timestamp":"2025-04-17T05:49:26.642Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 53%","timestamp":"2025-04-17T05:49:26.645Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 53%","timestamp":"2025-04-17T05:49:26.646Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6ccf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:26.646Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.646Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:26.646Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:26.647Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.647Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:26.647Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.664Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:26.665Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.667Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:26.668Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccf.","timestamp":"2025-04-17T05:49:26.676Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccf status to TRANSLATING.","timestamp":"2025-04-17T05:49:26.677Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccf.","timestamp":"2025-04-17T05:49:26.679Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccf status to TRANSLATING.","timestamp":"2025-04-17T05:49:26.679Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.680Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:26.680Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.683Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:26.683Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccf.","timestamp":"2025-04-17T05:49:26.686Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccf status to TRANSLATING.","timestamp":"2025-04-17T05:49:26.686Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccf.","timestamp":"2025-04-17T05:49:26.689Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccf status to TRANSLATING.","timestamp":"2025-04-17T05:49:26.699Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:26.703Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:26.706Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:26.708Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:26.709Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:26.712Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:26.713Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:26.713Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:26.714Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 105","timestamp":"2025-04-17T05:49:26.714Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:26.715Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:26.717Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:26.718Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:26.718Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:26.719Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 105","timestamp":"2025-04-17T05:49:26.729Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:26.729Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:26.731Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:26.732Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:26.732Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:26.732Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 105","timestamp":"2025-04-17T05:49:26.732Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:26.732Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:26.734Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:26.734Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:26.735Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:26.735Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 105","timestamp":"2025-04-17T05:49:26.735Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:26.735Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:26.738Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:26.738Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:26.738Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:26.739Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:26.739Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:26.739Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:26.739Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:26.739Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:26.740Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.740Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":105,"timestamp":"2025-04-17T05:49:26.740Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:26.740Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:26.740Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:26.741Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:26.742Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:26.743Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:26.744Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:26.744Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:26.745Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:26.745Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:26.745Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:26.745Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:26.745Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.746Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":105,"timestamp":"2025-04-17T05:49:26.746Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:26.746Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:26.746Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:26.746Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:26.748Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:26.748Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:26.748Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:26.749Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:26.749Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:26.749Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:26.749Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:26.749Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:26.749Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.750Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":105,"timestamp":"2025-04-17T05:49:26.763Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:26.763Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:26.764Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:26.764Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:26.770Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:26.770Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:26.771Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:26.771Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:26.772Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:26.772Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:26.772Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:26.772Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:26.773Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:26.773Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":105,"timestamp":"2025-04-17T05:49:26.773Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:26.773Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:26.773Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:26.774Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:27.597Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10540ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:27.598Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccc: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:27.603Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:27.603Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:27.617Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:27.619Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:27.619Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 47% (20/43)","timestamp":"2025-04-17T05:49:27.620Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 47%","timestamp":"2025-04-17T05:49:27.621Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:27.622Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:27.622Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:27.622Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:27.634Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:27.634Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccd.","timestamp":"2025-04-17T05:49:27.639Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccd status to TRANSLATING.","timestamp":"2025-04-17T05:49:27.640Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:27.663Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:27.666Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:27.667Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:27.667Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:27.667Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 149","timestamp":"2025-04-17T05:49:27.668Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:27.668Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:27.672Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:27.672Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:27.673Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:27.673Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:27.673Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:27.673Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:27.674Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:27.674Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:27.674Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:49:27.674Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":149,"timestamp":"2025-04-17T05:49:27.674Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:27.674Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:27.675Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:27.683Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:37.262Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10488ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:37.263Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccf: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.276Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:37.278Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:37.283Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10542ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:37.283Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccf: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.284Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:37.285Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:37.290Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10526ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:37.291Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccf: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.310Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:37.311Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:37.317Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10571ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:37.319Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccf: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.320Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:37.321Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.329Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.341Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6ccf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:37.341Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 56% (24/43)","timestamp":"2025-04-17T05:49:37.342Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.345Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.346Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:37.347Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 56% (24/43)","timestamp":"2025-04-17T05:49:37.347Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.349Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.349Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6ccf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:37.350Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 56% (24/43)","timestamp":"2025-04-17T05:49:37.350Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.352Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:37.353Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6ccf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:37.353Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 56% (24/43)","timestamp":"2025-04-17T05:49:37.354Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 56%","timestamp":"2025-04-17T05:49:37.366Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 56%","timestamp":"2025-04-17T05:49:37.367Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 56%","timestamp":"2025-04-17T05:49:37.367Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cd0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:37.368Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:37.370Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:37.371Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:37.374Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:37.374Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:37.375Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cd0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:37.379Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:37.380Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:37.381Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 56%","timestamp":"2025-04-17T05:49:37.388Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cd0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:37.399Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:37.399Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:37.399Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:37.481Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:37.483Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:37.500Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:37.501Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:37.515Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:37.543Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:37.553Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:37.554Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd0.","timestamp":"2025-04-17T05:49:37.560Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd0 status to TRANSLATING.","timestamp":"2025-04-17T05:49:37.571Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd0.","timestamp":"2025-04-17T05:49:37.577Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd0 status to TRANSLATING.","timestamp":"2025-04-17T05:49:37.578Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd0.","timestamp":"2025-04-17T05:49:37.582Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd0 status to TRANSLATING.","timestamp":"2025-04-17T05:49:37.583Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd0.","timestamp":"2025-04-17T05:49:37.589Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd0 status to TRANSLATING.","timestamp":"2025-04-17T05:49:37.590Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:37.607Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:37.614Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:37.618Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:37.628Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:37.634Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:37.635Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:37.636Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 255","timestamp":"2025-04-17T05:49:37.639Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:37.640Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:37.649Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:37.650Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:37.651Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:37.664Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 255","timestamp":"2025-04-17T05:49:37.665Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:37.665Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:37.672Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:37.682Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:37.683Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:37.717Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:37.720Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 255","timestamp":"2025-04-17T05:49:37.721Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:37.721Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:37.738Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:37.763Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:37.765Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:37.767Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:37.772Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:37.774Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:37.779Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:37.797Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:37.798Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:37.805Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":255,"timestamp":"2025-04-17T05:49:37.810Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:37.827Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:37.830Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:37.832Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:37.846Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:37.854Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:37.855Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:37.858Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 255","timestamp":"2025-04-17T05:49:37.861Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:37.862Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:37.873Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:37.890Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:37.898Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:37.899Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:37.903Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:37.918Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:37.919Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:37.919Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:37.920Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:37.920Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":255,"timestamp":"2025-04-17T05:49:37.921Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:37.921Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:37.921Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:37.922Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:37.926Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:37.928Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:37.930Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:37.931Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:37.957Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:37.957Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:37.959Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:37.962Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:37.963Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:37.964Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":255,"timestamp":"2025-04-17T05:49:37.964Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:37.965Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:37.966Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:37.968Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:37.980Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:38.004Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:38.005Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:38.005Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:38.006Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:38.006Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:38.007Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:38.007Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:38.007Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:38.008Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":255,"timestamp":"2025-04-17T05:49:38.010Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:38.013Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:38.014Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:38.015Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:38.353Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10678ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:38.354Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccd: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:38.366Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:38.371Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:38.404Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:38.406Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:38.407Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 49% (21/43)","timestamp":"2025-04-17T05:49:38.407Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 49%","timestamp":"2025-04-17T05:49:38.413Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cce in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:38.425Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:38.426Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cce, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:38.428Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:38.462Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:38.463Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cce.","timestamp":"2025-04-17T05:49:38.471Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cce status to TRANSLATING.","timestamp":"2025-04-17T05:49:38.472Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:38.494Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:38.500Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:38.502Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:38.503Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:38.504Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:49:38.504Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:38.521Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:38.528Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:38.530Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:38.531Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:38.532Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:38.532Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:38.533Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:38.535Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:38.550Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:38.552Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:49:38.552Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:49:38.554Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:38.554Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:38.556Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:38.557Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:47.955Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10144ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:47.956Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd0: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:47.965Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:47.966Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:47.989Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:48.001Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cd0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:48.002Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 58% (25/43)","timestamp":"2025-04-17T05:49:48.003Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 58%","timestamp":"2025-04-17T05:49:48.006Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cd1 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:48.009Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd1...","timestamp":"2025-04-17T05:49:48.010Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd1, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:48.012Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd1...","timestamp":"2025-04-17T05:49:48.048Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"9\"><ph id=\"2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"0\" /&gt;</ph><ph id=\"3\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"1\" /&gt;</ph><ph id=\"4\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"2\" /&gt;</ph><ph id=\"5\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"3\" /&gt;</ph></rpr id=\"9\" transform=\"close\"><rpr id=\"8\">7.1.2</rpr id=\"8\" transform=\"close\">若有两个连续稀释度的平板菌落数在适宜计数范围内时，按式（1)计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.2。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:48.049Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd1.","timestamp":"2025-04-17T05:49:48.061Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd1 status to TRANSLATING.","timestamp":"2025-04-17T05:49:48.061Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:48.083Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:48.101Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:48.102Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:48.104Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:48.106Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 530","timestamp":"2025-04-17T05:49:48.107Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:48.108Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:48.138Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:48.139Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:48.151Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:48.153Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:48.159Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:48.160Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:48.161Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:48.163Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:48.165Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd1...","timestamp":"2025-04-17T05:49:48.165Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":530,"timestamp":"2025-04-17T05:49:48.167Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:48.168Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"9\"><ph id=\"2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"0\" /&gt;</ph><ph id=\"3\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"1\" /&gt;</ph><ph id=\"4\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"2\" /&gt;</ph><ph id=\"5\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"3\" /&gt;</ph></rpr id=\"9\" transform=\"close\"><rpr id=\"8\">7.1.2</rpr id=\"8\" transform=\"close\">若有两个连续稀释度的平板菌落数在适宜计数范围内时，按式（1)计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.2。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"9\"><ph id=\"2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"0\" /&gt;</ph><ph id=\"3\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"1\" /&gt;</ph><ph id=\"4\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"2\" /&gt;</ph><ph id=\"5\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"3\" /&gt;</ph></rpr id=\"9\" transform=\"close\"><rpr id=\"8\">7.1.2</rpr id=\"8\" transform=\"close\">若有两个连续稀释度的平板菌落数在适宜计数范围内时，按式（1)计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.2。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:48.169Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:48.171Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:48.466Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10455ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:48.468Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd0: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:48.475Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:48.476Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:48.480Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10559ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:48.481Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd0: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:48.483Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:48.485Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:48.491Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10526ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:48.492Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd0: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:48.493Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:48.494Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:48.506Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:48.511Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cd0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:48.511Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 58% (25/43)","timestamp":"2025-04-17T05:49:48.512Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:48.515Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:48.516Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cd0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:48.516Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 58% (25/43)","timestamp":"2025-04-17T05:49:48.516Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 58%","timestamp":"2025-04-17T05:49:48.517Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cd1 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:48.518Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd1...","timestamp":"2025-04-17T05:49:48.518Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd1, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:48.518Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:48.522Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:48.523Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:48.523Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 58% (25/43)","timestamp":"2025-04-17T05:49:48.524Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 58%","timestamp":"2025-04-17T05:49:48.524Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cd1 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:48.525Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd1...","timestamp":"2025-04-17T05:49:48.525Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd1, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:48.526Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 58%","timestamp":"2025-04-17T05:49:48.528Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd1 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:48.541Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd1...","timestamp":"2025-04-17T05:49:48.542Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd1, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:48.542Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd1 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:49:48.551Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Successfully processed segment 68008f27082e41fa7e9c6cd1. Status: translating","timestamp":"2025-04-17T05:49:48.552Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cd1 not queued for review (Status: translating).","timestamp":"2025-04-17T05:49:48.555Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 60% (26/43)","timestamp":"2025-04-17T05:49:48.555Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd1 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:49:48.556Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Successfully processed segment 68008f27082e41fa7e9c6cd1. Status: translating","timestamp":"2025-04-17T05:49:48.557Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cd1 not queued for review (Status: translating).","timestamp":"2025-04-17T05:49:48.557Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 60% (26/43)","timestamp":"2025-04-17T05:49:48.557Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd1 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:49:48.558Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cd1. Status: translating","timestamp":"2025-04-17T05:49:48.558Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd1 not queued for review (Status: translating).","timestamp":"2025-04-17T05:49:48.559Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 60% (26/43)","timestamp":"2025-04-17T05:49:48.559Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 60%","timestamp":"2025-04-17T05:49:48.561Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 60%","timestamp":"2025-04-17T05:49:48.573Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cd2 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:48.573Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:49:48.574Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd2, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:48.574Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cd2 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:48.575Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:49:48.576Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd2, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:48.576Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 60%","timestamp":"2025-04-17T05:49:48.579Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd2 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:48.580Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:49:48.580Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd2, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:48.581Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:49:48.617Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:48.618Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:49:48.623Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:48.625Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:49:48.631Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:48.632Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd2.","timestamp":"2025-04-17T05:49:48.638Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd2 status to TRANSLATING.","timestamp":"2025-04-17T05:49:48.648Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd2.","timestamp":"2025-04-17T05:49:48.651Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd2 status to TRANSLATING.","timestamp":"2025-04-17T05:49:48.652Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd2.","timestamp":"2025-04-17T05:49:48.658Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd2 status to TRANSLATING.","timestamp":"2025-04-17T05:49:48.659Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:48.663Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:48.667Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:48.667Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:48.668Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:48.669Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T05:49:48.682Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:48.682Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:48.688Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:48.693Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:48.699Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:48.699Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:48.700Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:48.707Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:48.708Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:48.708Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:48.708Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:48.709Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:48.709Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:49:48.709Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T05:49:48.709Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:48.709Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:48.711Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:48.711Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:48.720Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:48.721Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:48.722Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:48.723Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T05:49:48.723Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:48.723Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:48.730Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:48.750Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:48.751Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:48.752Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T05:49:48.753Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:48.753Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:48.756Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:48.756Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:48.757Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:48.757Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:48.757Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:48.757Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:48.758Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:48.758Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:48.759Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:49:48.759Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T05:49:48.760Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:48.761Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:48.763Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:48.776Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:48.790Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:48.791Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:48.791Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:48.792Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:48.793Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:48.793Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:48.793Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:48.805Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:48.806Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:49:48.807Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T05:49:48.808Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:48.809Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:48.810Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:48.812Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:48.973Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10418ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:48.977Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cce: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:48.989Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cce as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:48.989Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:49.010Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:49.016Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cce not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:49.018Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 51% (22/43)","timestamp":"2025-04-17T05:49:49.020Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 51%","timestamp":"2025-04-17T05:49:49.023Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:49.024Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:49.025Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:49.025Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:49.059Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:49.061Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccf.","timestamp":"2025-04-17T05:49:49.077Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccf status to TRANSLATING.","timestamp":"2025-04-17T05:49:49.078Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:49.100Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:49.111Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:49.111Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:49.113Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:49.113Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 105","timestamp":"2025-04-17T05:49:49.113Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:49.114Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:49.117Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:49.118Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:49.119Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:49.120Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:49.121Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:49.121Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:49.122Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:49.123Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:49.123Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:49:49.124Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":105,"timestamp":"2025-04-17T05:49:49.125Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:49.144Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:49.147Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:49.148Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"Registered processor for file type: docx","timestamp":"2025-04-17T05:49:54.625Z"}
{"level":"info","message":"Registered processor for file type: txt","timestamp":"2025-04-17T05:49:54.628Z"}
{"level":"info","message":"Registered processor for file type: xliff","timestamp":"2025-04-17T05:49:54.630Z"}
{"level":"info","message":"Registered processor for file type: mqxliff","timestamp":"2025-04-17T05:49:54.631Z"}
{"level":"info","message":"Translation queue service initialized. Connected to Redis: 127.0.0.1:6379","timestamp":"2025-04-17T05:49:54.750Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T05:49:55.500Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T05:49:55.501Z"}
{"level":"info","message":"Review routes updated to use namespace import for controller","timestamp":"2025-04-17T05:49:55.553Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T05:49:55.816Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:58.628Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10461ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:58.629Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd1: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:58.635Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd1 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:58.635Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:58.648Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cd1: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:58.649Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cd1 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:58.650Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 60% (26/43)","timestamp":"2025-04-17T05:49:58.650Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 60%","timestamp":"2025-04-17T05:49:58.651Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cd2 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:58.652Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:49:58.652Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd2, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:58.652Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd2 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:49:58.656Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Successfully processed segment 68008f27082e41fa7e9c6cd2. Status: translating","timestamp":"2025-04-17T05:49:58.656Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cd2 not queued for review (Status: translating).","timestamp":"2025-04-17T05:49:58.657Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 63% (27/43)","timestamp":"2025-04-17T05:49:58.657Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 63%","timestamp":"2025-04-17T05:49:58.657Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cd3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:58.658Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:49:58.658Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:58.658Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:49:58.674Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:58.675Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd3.","timestamp":"2025-04-17T05:49:58.679Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd3 status to TRANSLATING.","timestamp":"2025-04-17T05:49:58.679Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:58.692Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:58.700Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:58.701Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:58.701Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:58.702Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T05:49:58.702Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:58.702Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:58.705Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:58.714Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:58.714Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:58.715Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:58.715Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:58.715Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:58.716Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:58.716Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:58.716Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:49:58.716Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T05:49:58.716Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:58.717Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:58.717Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:58.717Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:59.141Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10333ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:59.142Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd2: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.146Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd2 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:59.147Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:59.149Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10440ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:59.149Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd2: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.150Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd2 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:59.150Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:59.154Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10394ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:59.154Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd2: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.155Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd2 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:59.155Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.160Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.167Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cd2 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:59.168Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 63% (27/43)","timestamp":"2025-04-17T05:49:59.168Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.169Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.172Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd2 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:59.175Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 63% (27/43)","timestamp":"2025-04-17T05:49:59.175Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 63%","timestamp":"2025-04-17T05:49:59.176Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cd3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:59.177Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:49:59.177Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:59.177Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.180Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.182Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cd2 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:59.182Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 63% (27/43)","timestamp":"2025-04-17T05:49:59.183Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 63%","timestamp":"2025-04-17T05:49:59.184Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:59.184Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:49:59.184Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:59.185Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 63%","timestamp":"2025-04-17T05:49:59.186Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cd3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:59.187Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:49:59.187Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:59.187Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd3 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:49:59.189Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Successfully processed segment 68008f27082e41fa7e9c6cd3. Status: translating","timestamp":"2025-04-17T05:49:59.197Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cd3 not queued for review (Status: translating).","timestamp":"2025-04-17T05:49:59.198Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 65% (28/43)","timestamp":"2025-04-17T05:49:59.198Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd3 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:49:59.200Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cd3. Status: translating","timestamp":"2025-04-17T05:49:59.200Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd3 not queued for review (Status: translating).","timestamp":"2025-04-17T05:49:59.200Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 65% (28/43)","timestamp":"2025-04-17T05:49:59.200Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd3 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:49:59.202Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Successfully processed segment 68008f27082e41fa7e9c6cd3. Status: translating","timestamp":"2025-04-17T05:49:59.202Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cd3 not queued for review (Status: translating).","timestamp":"2025-04-17T05:49:59.203Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 65% (28/43)","timestamp":"2025-04-17T05:49:59.203Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 65%","timestamp":"2025-04-17T05:49:59.204Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 65%","timestamp":"2025-04-17T05:49:59.204Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cd4 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:59.204Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:49:59.204Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd4, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:59.205Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd4 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:59.205Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:49:59.206Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd4, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:59.206Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 65%","timestamp":"2025-04-17T05:49:59.208Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cd4 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:59.208Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:49:59.208Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd4, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:59.209Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:49:59.238Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}sc{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:59.239Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:49:59.242Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}sc{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:59.243Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:49:59.245Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}sc{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:59.245Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd4.","timestamp":"2025-04-17T05:49:59.248Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd4 status to TRANSLATING.","timestamp":"2025-04-17T05:49:59.248Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd4.","timestamp":"2025-04-17T05:49:59.252Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd4 status to TRANSLATING.","timestamp":"2025-04-17T05:49:59.256Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd4.","timestamp":"2025-04-17T05:49:59.258Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd4 status to TRANSLATING.","timestamp":"2025-04-17T05:49:59.258Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:59.270Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:59.273Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:59.275Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:59.277Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:59.278Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:59.278Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:59.279Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 6","timestamp":"2025-04-17T05:49:59.279Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:59.279Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:59.282Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:59.282Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:59.289Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:59.290Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 6","timestamp":"2025-04-17T05:49:59.290Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:59.290Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:59.292Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:59.292Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:59.293Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:59.293Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 6","timestamp":"2025-04-17T05:49:59.293Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:59.293Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:59.297Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:59.297Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:59.297Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:59.298Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:59.298Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:59.307Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:59.307Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:59.307Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:59.307Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:49:59.308Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":6,"timestamp":"2025-04-17T05:49:59.308Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:59.309Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:59.309Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:59.309Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:59.312Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:59.313Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:59.313Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:59.313Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:59.313Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:59.313Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:59.314Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:59.314Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:59.314Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:49:59.315Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":6,"timestamp":"2025-04-17T05:49:59.315Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:59.315Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:59.315Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:59.316Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:59.318Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:59.319Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:59.319Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:59.320Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:59.320Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:59.320Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:59.320Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:59.321Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:59.321Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:49:59.321Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":6,"timestamp":"2025-04-17T05:49:59.321Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:59.322Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:59.322Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:59.322Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:59.648Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10522ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:49:59.649Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccf: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.655Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:49:59.656Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.665Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:49:59.666Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:49:59.666Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 53% (23/43)","timestamp":"2025-04-17T05:49:59.666Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 53%","timestamp":"2025-04-17T05:49:59.667Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:49:59.667Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:59.668Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:49:59.668Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:59.681Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:49:59.689Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd0.","timestamp":"2025-04-17T05:49:59.694Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd0 status to TRANSLATING.","timestamp":"2025-04-17T05:49:59.695Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:49:59.711Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:49:59.718Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:49:59.718Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:49:59.718Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:49:59.719Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 255","timestamp":"2025-04-17T05:49:59.719Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:49:59.719Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:49:59.722Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:49:59.723Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:49:59.723Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:49:59.723Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:49:59.723Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:49:59.723Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:49:59.724Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:49:59.724Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:49:59.724Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:49:59.725Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":255,"timestamp":"2025-04-17T05:49:59.732Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:49:59.732Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:49:59.732Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:49:59.733Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"Registered processor for file type: docx","timestamp":"2025-04-17T05:50:02.090Z"}
{"level":"info","message":"Registered processor for file type: txt","timestamp":"2025-04-17T05:50:02.092Z"}
{"level":"info","message":"Registered processor for file type: xliff","timestamp":"2025-04-17T05:50:02.095Z"}
{"level":"info","message":"Registered processor for file type: mqxliff","timestamp":"2025-04-17T05:50:02.095Z"}
{"level":"info","message":"Translation queue service initialized. Connected to Redis: 127.0.0.1:6379","timestamp":"2025-04-17T05:50:02.202Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T05:50:02.922Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T05:50:02.924Z"}
{"level":"info","message":"Review routes updated to use namespace import for controller","timestamp":"2025-04-17T05:50:02.971Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T05:50:03.224Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:50:09.298Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10582ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:50:09.299Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd3: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.305Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:50:09.305Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.316Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Error processing segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.317Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cd3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:50:09.317Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 65% (28/43)","timestamp":"2025-04-17T05:50:09.317Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 65%","timestamp":"2025-04-17T05:50:09.318Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cd4 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:50:09.318Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:50:09.319Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd4, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:50:09.319Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd4 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:50:09.321Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Successfully processed segment 68008f27082e41fa7e9c6cd4. Status: translating","timestamp":"2025-04-17T05:50:09.322Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527: Segment 68008f27082e41fa7e9c6cd4 not queued for review (Status: translating).","timestamp":"2025-04-17T05:50:09.322Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Updating progress: 67% (29/43)","timestamp":"2025-04-17T05:50:09.322Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 progress: 67%","timestamp":"2025-04-17T05:50:09.323Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Processing segment 68008f27082e41fa7e9c6cd5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:50:09.324Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867479527] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd5...","timestamp":"2025-04-17T05:50:09.324Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:50:09.324Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd5...","timestamp":"2025-04-17T05:50:09.336Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}sc{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:50:09.339Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd5.","timestamp":"2025-04-17T05:50:09.342Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd5 status to TRANSLATING.","timestamp":"2025-04-17T05:50:09.343Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:50:09.364Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:50:09.371Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:50:09.371Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:50:09.372Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:50:09.372Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 6","timestamp":"2025-04-17T05:50:09.372Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:50:09.373Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:50:09.376Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:50:09.382Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:50:09.382Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:50:09.383Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:50:09.383Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:50:09.383Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:50:09.383Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:50:09.383Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:50:09.383Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd5...","timestamp":"2025-04-17T05:50:09.383Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":6,"timestamp":"2025-04-17T05:50:09.384Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:50:09.384Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:50:09.384Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:50:09.384Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:50:09.811Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10490ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:50:09.812Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd4: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.817Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd4 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:50:09.818Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:50:09.822Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10514ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:50:09.824Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd4: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.826Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd4 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:50:09.826Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:50:09.831Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10516ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:50:09.840Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd4: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.841Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd4 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:50:09.841Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.849Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Error processing segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.850Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cd4 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:50:09.850Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 67% (29/43)","timestamp":"2025-04-17T05:50:09.851Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.854Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Error processing segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.855Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cd4 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:50:09.856Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 67% (29/43)","timestamp":"2025-04-17T05:50:09.856Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 67%","timestamp":"2025-04-17T05:50:09.857Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 67%","timestamp":"2025-04-17T05:50:09.858Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cd5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:50:09.858Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd5...","timestamp":"2025-04-17T05:50:09.858Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:50:09.859Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cd5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:50:09.873Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd5...","timestamp":"2025-04-17T05:50:09.873Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:50:09.874Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.879Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:09.879Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd4 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:50:09.880Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 67% (29/43)","timestamp":"2025-04-17T05:50:09.880Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd5 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:50:09.881Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Successfully processed segment 68008f27082e41fa7e9c6cd5. Status: translating","timestamp":"2025-04-17T05:50:09.882Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710: Segment 68008f27082e41fa7e9c6cd5 not queued for review (Status: translating).","timestamp":"2025-04-17T05:50:09.882Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Updating progress: 70% (30/43)","timestamp":"2025-04-17T05:50:09.882Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd5 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:50:09.883Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Successfully processed segment 68008f27082e41fa7e9c6cd5. Status: translating","timestamp":"2025-04-17T05:50:09.884Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180: Segment 68008f27082e41fa7e9c6cd5 not queued for review (Status: translating).","timestamp":"2025-04-17T05:50:09.885Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Updating progress: 70% (30/43)","timestamp":"2025-04-17T05:50:09.885Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 67%","timestamp":"2025-04-17T05:50:09.886Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 progress: 70%","timestamp":"2025-04-17T05:50:09.886Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:50:09.886Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd5...","timestamp":"2025-04-17T05:50:09.887Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:50:09.887Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Processing segment 68008f27082e41fa7e9c6cd6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:50:09.888Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867176710] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd6...","timestamp":"2025-04-17T05:50:09.888Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:50:09.888Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 progress: 70%","timestamp":"2025-04-17T05:50:09.890Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Processing segment 68008f27082e41fa7e9c6cd6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:50:09.890Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744867841180] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd6...","timestamp":"2025-04-17T05:50:09.890Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:50:09.891Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd5 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:50:09.905Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cd5. Status: translating","timestamp":"2025-04-17T05:50:09.906Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd5 not queued for review (Status: translating).","timestamp":"2025-04-17T05:50:09.906Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 70% (30/43)","timestamp":"2025-04-17T05:50:09.907Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 70%","timestamp":"2025-04-17T05:50:09.910Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:50:09.911Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd6...","timestamp":"2025-04-17T05:50:09.912Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:50:09.912Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd6...","timestamp":"2025-04-17T05:50:09.923Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:50:09.931Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd6...","timestamp":"2025-04-17T05:50:09.937Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:50:09.938Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd6.","timestamp":"2025-04-17T05:50:09.941Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd6 status to TRANSLATING.","timestamp":"2025-04-17T05:50:09.944Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd6.","timestamp":"2025-04-17T05:50:09.953Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd6 status to TRANSLATING.","timestamp":"2025-04-17T05:50:09.964Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd6...","timestamp":"2025-04-17T05:50:09.967Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:50:09.967Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:50:09.971Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:50:09.975Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd6.","timestamp":"2025-04-17T05:50:09.977Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd6 status to TRANSLATING.","timestamp":"2025-04-17T05:50:09.977Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:50:09.982Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:50:09.982Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:50:09.982Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:50:09.983Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 60","timestamp":"2025-04-17T05:50:09.983Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:50:09.997Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:50:10.000Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:50:10.001Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:50:10.002Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:50:10.003Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 60","timestamp":"2025-04-17T05:50:10.003Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:50:10.004Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:50:10.008Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:50:10.013Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:50:10.014Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:50:10.015Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:50:10.033Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:50:10.034Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:50:10.035Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:50:10.036Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:50:10.037Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:50:10.038Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd6...","timestamp":"2025-04-17T05:50:10.039Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":60,"timestamp":"2025-04-17T05:50:10.040Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:50:10.041Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:50:10.044Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:50:10.044Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:50:10.050Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:50:10.062Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:50:10.063Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:50:10.063Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:50:10.064Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:50:10.064Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:50:10.065Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:50:10.065Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:50:10.066Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd6...","timestamp":"2025-04-17T05:50:10.066Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":60,"timestamp":"2025-04-17T05:50:10.067Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:50:10.067Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:50:10.068Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:50:10.068Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:50:10.074Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:50:10.075Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:50:10.075Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:50:10.076Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 60","timestamp":"2025-04-17T05:50:10.076Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:50:10.076Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:50:10.084Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:50:10.097Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:50:10.098Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:50:10.099Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:50:10.099Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:50:10.100Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:50:10.100Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:50:10.100Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:50:10.101Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd6...","timestamp":"2025-04-17T05:50:10.101Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":60,"timestamp":"2025-04-17T05:50:10.101Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:50:10.102Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:50:10.102Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:50:10.102Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:50:10.311Z"}
{"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10579ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:50:10.312Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd0: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:10.318Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:50:10.318Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:10.330Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed","timestamp":"2025-04-17T05:50:10.331Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:50:10.331Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 56% (24/43)","timestamp":"2025-04-17T05:50:10.332Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 56%","timestamp":"2025-04-17T05:50:10.335Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd1 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:50:10.335Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd1...","timestamp":"2025-04-17T05:50:10.336Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd1, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:50:10.336Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd1...","timestamp":"2025-04-17T05:50:10.348Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"9\"><ph id=\"2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"0\" /&gt;</ph><ph id=\"3\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"1\" /&gt;</ph><ph id=\"4\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"2\" /&gt;</ph><ph id=\"5\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"3\" /&gt;</ph></rpr id=\"9\" transform=\"close\"><rpr id=\"8\">7.1.2</rpr id=\"8\" transform=\"close\">若有两个连续稀释度的平板菌落数在适宜计数范围内时，按式（1)计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.2。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:50:10.350Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd1.","timestamp":"2025-04-17T05:50:10.354Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd1 status to TRANSLATING.","timestamp":"2025-04-17T05:50:10.354Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:50:10.374Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:50:10.385Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:50:10.386Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:50:10.387Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:50:10.388Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 530","timestamp":"2025-04-17T05:50:10.389Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:50:10.389Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:50:10.392Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:50:10.393Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:50:10.393Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:50:10.394Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:50:10.394Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:50:10.395Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:50:10.395Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:50:10.395Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:50:10.396Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd1...","timestamp":"2025-04-17T05:50:10.396Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":530,"timestamp":"2025-04-17T05:50:10.396Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:50:10.397Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"9\"><ph id=\"2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"0\" /&gt;</ph><ph id=\"3\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"1\" /&gt;</ph><ph id=\"4\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"2\" /&gt;</ph><ph id=\"5\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"3\" /&gt;</ph></rpr id=\"9\" transform=\"close\"><rpr id=\"8\">7.1.2</rpr id=\"8\" transform=\"close\">若有两个连续稀释度的平板菌落数在适宜计数范围内时，按式（1)计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.2。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"9\"><ph id=\"2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"0\" /&gt;</ph><ph id=\"3\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"1\" /&gt;</ph><ph id=\"4\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"2\" /&gt;</ph><ph id=\"5\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">&lt;altcontent id=\"3\" /&gt;</ph></rpr id=\"9\" transform=\"close\"><rpr id=\"8\">7.1.2</rpr id=\"8\" transform=\"close\">若有两个连续稀释度的平板菌落数在适宜计数范围内时，按式（1)计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.2。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:50:10.397Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:50:10.397Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:50:10.837Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:50:10.853Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:50:10.859Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:50:10.861Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:50:10.861Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:50:10.869Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:50:10.894Z"}
{"level":"info","message":"Registered processor for file type: docx","timestamp":"2025-04-17T05:50:38.631Z"}
{"level":"info","message":"Registered processor for file type: txt","timestamp":"2025-04-17T05:50:38.634Z"}
{"level":"info","message":"Registered processor for file type: xliff","timestamp":"2025-04-17T05:50:38.636Z"}
{"level":"info","message":"Registered processor for file type: mqxliff","timestamp":"2025-04-17T05:50:38.636Z"}
{"level":"info","message":"Translation queue service initialized. Connected to Redis: 127.0.0.1:6379","timestamp":"2025-04-17T05:50:38.742Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T05:50:39.391Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T05:50:39.391Z"}
{"level":"info","message":"Review routes updated to use namespace import for controller","timestamp":"2025-04-17T05:50:39.438Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T05:50:39.691Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:50:39.992Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:50:40.205Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:50:40.209Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:50:40.210Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:50:40.211Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:50:40.216Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:50:40.226Z"}
{"level":"info","message":"Translation queue service initialized. Connected to Redis: 127.0.0.1:6379","timestamp":"2025-04-17T05:51:06.886Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T05:51:07.151Z"}
{"level":"warn","message":"Review queue service initialized WITHOUT Redis connection (temporary).","timestamp":"2025-04-17T05:51:07.168Z"}
{"level":"info","message":"MongoDB connected successfully for worker.","timestamp":"2025-04-17T05:51:07.197Z"}
{"level":"info","message":"Translation worker started...","timestamp":"2025-04-17T05:51:07.198Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:51:10.844Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:51:10.865Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:51:10.868Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:51:10.869Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:51:10.870Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:51:10.874Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:51:10.885Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-68008f27082e41fa7e9c6cb2-1744867479527","level":"error","message":"Job file-68008f27082e41fa7e9c6cb2-1744867479527 failed. Error: job stalled more than allowable limit","timestamp":"2025-04-17T05:51:37.228Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-68008f27082e41fa7e9c6cb2-1744867176710","level":"error","message":"Job file-68008f27082e41fa7e9c6cb2-1744867176710 failed. Error: job stalled more than allowable limit","timestamp":"2025-04-17T05:51:37.230Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-68008f27082e41fa7e9c6cb2-1744867841180","level":"error","message":"Job file-68008f27082e41fa7e9c6cb2-1744867841180 failed. Error: job stalled more than allowable limit","timestamp":"2025-04-17T05:51:37.231Z"}
{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] START Processing job. Raw Data:","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"timestamp":"2025-04-17T05:51:37.237Z","type":"file","userId":"67fcb942de30090a16d422b0"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Extracted - promptTemplateId: 67fe34abde39936502045d6c, aiConfigId: 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:51:37.238Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing Details - Type: file, Project: 6800625db601745b33861ae0, File: 68008f27082e41fa7e9c6cb2, AI Config: 67fe227be8f10dbf81036e7e, Prompt: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:51:37.238Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Determining segments to translate... Type: file","timestamp":"2025-04-17T05:51:37.238Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Fetching project 6800625db601745b33861ae0 for language info...","timestamp":"2025-04-17T05:51:37.257Z"}
{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] START Processing job. Raw Data:","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"timestamp":"2025-04-17T05:51:37.258Z","type":"file","userId":"67fcb942de30090a16d422b0"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Extracted - promptTemplateId: 67fe34abde39936502045d6c, aiConfigId: 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:51:37.258Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing Details - Type: file, Project: 6800625db601745b33861ae0, File: 68008f27082e41fa7e9c6cb2, AI Config: 67fe227be8f10dbf81036e7e, Prompt: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:51:37.259Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Determining segments to translate... Type: file","timestamp":"2025-04-17T05:51:37.259Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Project languages: zh-CN -> en-US","timestamp":"2025-04-17T05:51:37.264Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Fetching project 6800625db601745b33861ae0 for language info...","timestamp":"2025-04-17T05:51:37.269Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] File Job: Determined 37 segments to translate.","timestamp":"2025-04-17T05:51:37.276Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Determined Languages: zh-CN -> en-US","timestamp":"2025-04-17T05:51:37.276Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Starting segment processing loop for 37 segments.","timestamp":"2025-04-17T05:51:37.276Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cb5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:51:37.276Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T05:51:37.277Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:51:37.277Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Project languages: zh-CN -> en-US","timestamp":"2025-04-17T05:51:37.280Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] File Job: Determined 37 segments to translate.","timestamp":"2025-04-17T05:51:37.292Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Determined Languages: zh-CN -> en-US","timestamp":"2025-04-17T05:51:37.292Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Starting segment processing loop for 37 segments.","timestamp":"2025-04-17T05:51:37.292Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:51:37.292Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T05:51:37.292Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:51:37.293Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T05:51:37.303Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"样品的稀释\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:51:37.304Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb5.","timestamp":"2025-04-17T05:51:37.309Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb5 status to TRANSLATING.","timestamp":"2025-04-17T05:51:37.309Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T05:51:37.316Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"样品的稀释\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:51:37.317Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:51:37.318Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb5.","timestamp":"2025-04-17T05:51:37.320Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb5 status to TRANSLATING.","timestamp":"2025-04-17T05:51:37.320Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:51:37.322Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:51:37.322Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:51:37.323Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:51:37.323Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 5","timestamp":"2025-04-17T05:51:37.323Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:51:37.324Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:51:37.327Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:51:37.330Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:51:37.330Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:51:37.333Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:51:37.333Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:51:37.334Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:51:37.334Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:51:37.334Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:51:37.334Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:51:37.334Z"}
{"level":"info","message":"Creating singleton adapter instance for grok.","timestamp":"2025-04-17T05:51:37.334Z"}
{"level":"warn","message":"[AIServiceFactory] loadDefaultConfigForProvider called for grok. Using potentially insecure defaults or environment variables.","timestamp":"2025-04-17T05:51:37.334Z"}
{"level":"info","message":"[GrokAdapter] Initialized with API Key (masked): ****jdOO","timestamp":"2025-04-17T05:51:37.335Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T05:51:37.335Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":5,"timestamp":"2025-04-17T05:51:37.335Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:51:37.336Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n样品的稀释\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n样品的稀释\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:51:37.336Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:51:37.337Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:51:37.377Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:51:37.378Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:51:37.380Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:51:37.381Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 5","timestamp":"2025-04-17T05:51:37.381Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:51:37.381Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:51:37.384Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:51:37.384Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:51:37.384Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:51:37.385Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:51:37.385Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:51:37.385Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:51:37.385Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:51:37.385Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:51:37.385Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T05:51:37.386Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":5,"timestamp":"2025-04-17T05:51:37.386Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:51:37.386Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n样品的稀释\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n样品的稀释\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:51:37.386Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:51:37.386Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:51:37.696Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:51:37.700Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:51:37.703Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:51:37.704Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:51:37.705Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:51:37.707Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:51:37.711Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:51:47.984Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10647ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:51:47.987Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb5: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:47.999Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:51:48.000Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:51:48.014Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10627ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:51:48.014Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb5: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:48.016Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:51:48.016Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:48.027Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:48.031Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cb5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:51:48.032Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 2% (1/43)","timestamp":"2025-04-17T05:51:48.033Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:48.037Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:48.038Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:51:48.039Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 2% (1/43)","timestamp":"2025-04-17T05:51:48.040Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 2%","timestamp":"2025-04-17T05:51:48.042Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cb6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:51:48.043Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T05:51:48.043Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:51:48.043Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 2%","timestamp":"2025-04-17T05:51:48.046Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:51:48.047Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T05:51:48.047Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:51:48.047Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T05:51:48.084Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:51:48.084Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T05:51:48.090Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:51:48.093Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb6.","timestamp":"2025-04-17T05:51:48.097Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb6 status to TRANSLATING.","timestamp":"2025-04-17T05:51:48.097Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb6.","timestamp":"2025-04-17T05:51:48.102Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb6 status to TRANSLATING.","timestamp":"2025-04-17T05:51:48.111Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:51:48.120Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:51:48.123Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:51:48.127Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:51:48.127Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:51:48.128Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:51:48.128Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 100","timestamp":"2025-04-17T05:51:48.130Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:51:48.131Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:51:48.140Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:51:48.144Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:51:48.145Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:51:48.146Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 100","timestamp":"2025-04-17T05:51:48.147Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:51:48.148Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:51:48.154Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:51:48.154Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:51:48.155Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:51:48.155Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:51:48.156Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:51:48.156Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:51:48.157Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:51:48.157Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:51:48.158Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T05:51:48.158Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":100,"timestamp":"2025-04-17T05:51:48.160Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:51:48.160Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:51:48.161Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:51:48.161Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:51:48.168Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:51:48.184Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:51:48.185Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:51:48.186Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:51:48.186Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:51:48.186Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:51:48.187Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:51:48.187Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:51:48.188Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T05:51:48.188Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":100,"timestamp":"2025-04-17T05:51:48.189Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:51:48.189Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:51:48.190Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:51:48.191Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:51:58.791Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10630ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:51:58.792Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb6: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:58.803Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:51:58.803Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:51:58.807Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10618ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:51:58.807Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb6: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:58.808Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:51:58.808Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:58.823Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:58.832Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cb6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:51:58.833Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 5% (2/43)","timestamp":"2025-04-17T05:51:58.834Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:58.843Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:51:58.846Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:51:58.848Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 5% (2/43)","timestamp":"2025-04-17T05:51:58.861Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 5%","timestamp":"2025-04-17T05:51:58.862Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cb7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:51:58.863Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T05:51:58.863Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:51:58.864Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 5%","timestamp":"2025-04-17T05:51:58.867Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:51:58.868Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T05:51:58.869Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:51:58.869Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T05:51:58.905Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:51:58.907Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T05:51:58.912Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:51:58.912Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb7.","timestamp":"2025-04-17T05:51:58.915Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb7 status to TRANSLATING.","timestamp":"2025-04-17T05:51:58.938Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb7.","timestamp":"2025-04-17T05:51:58.944Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb7 status to TRANSLATING.","timestamp":"2025-04-17T05:51:58.945Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:51:58.951Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:51:58.954Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:51:58.955Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:51:58.955Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:51:58.956Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 900","timestamp":"2025-04-17T05:51:58.956Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:51:58.956Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:51:58.960Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:51:58.961Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:51:58.971Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:51:58.971Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:51:58.971Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:51:58.972Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:51:58.972Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:51:58.972Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:51:58.973Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T05:51:58.973Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":900,"timestamp":"2025-04-17T05:51:58.974Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:51:58.974Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:51:58.976Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:51:58.976Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:51:58.983Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:51:58.987Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:51:58.988Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:51:58.988Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:51:58.988Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 900","timestamp":"2025-04-17T05:51:58.989Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:51:58.989Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:51:58.994Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:51:59.008Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:51:59.009Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:51:59.010Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:51:59.010Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:51:59.010Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:51:59.011Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:51:59.011Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:51:59.011Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T05:51:59.011Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":900,"timestamp":"2025-04-17T05:51:59.012Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:51:59.012Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:51:59.013Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:51:59.015Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:09.623Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10649ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:09.624Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:09.627Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:52:09.627Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:09.629Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10617ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:09.630Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:09.630Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:52:09.631Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:09.635Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:09.636Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cb7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:52:09.638Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 7% (3/43)","timestamp":"2025-04-17T05:52:09.638Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:09.653Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:09.655Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:52:09.657Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 7% (3/43)","timestamp":"2025-04-17T05:52:09.658Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 7%","timestamp":"2025-04-17T05:52:09.660Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 7%","timestamp":"2025-04-17T05:52:09.661Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cb8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:52:09.662Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T05:52:09.664Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:52:09.665Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:52:09.667Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T05:52:09.668Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:52:09.670Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T05:52:09.697Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:09.699Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb8.","timestamp":"2025-04-17T05:52:09.712Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb8 status to TRANSLATING.","timestamp":"2025-04-17T05:52:09.714Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T05:52:09.721Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:09.722Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb8.","timestamp":"2025-04-17T05:52:09.727Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb8 status to TRANSLATING.","timestamp":"2025-04-17T05:52:09.728Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:52:09.735Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:52:09.743Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:52:09.744Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:52:09.745Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:52:09.745Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:52:09.746Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:52:09.746Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:52:09.753Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:52:09.757Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:52:09.758Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:52:09.760Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:52:09.760Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:52:09.761Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:52:09.762Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:52:09.762Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:52:09.764Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T05:52:09.765Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":51,"timestamp":"2025-04-17T05:52:09.767Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:52:09.768Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:52:09.768Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:52:09.769Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:52:09.773Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:52:09.779Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:52:09.779Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:52:09.780Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:52:09.781Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:52:09.790Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:52:09.791Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:52:09.794Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:52:09.795Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:52:09.795Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:52:09.798Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:52:09.798Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:52:09.798Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:52:09.799Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:52:09.799Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:52:09.799Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T05:52:09.799Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":51,"timestamp":"2025-04-17T05:52:09.800Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:52:09.800Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:52:09.800Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:52:09.801Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:52:10.862Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:52:10.869Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:10.870Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:10.870Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:10.871Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:10.874Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:10.879Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:20.369Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10602ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:20.370Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:20.375Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:52:20.375Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:20.378Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10578ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:20.379Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:20.379Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:52:20.379Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:20.389Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:20.394Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cb8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:52:20.395Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 9% (4/43)","timestamp":"2025-04-17T05:52:20.397Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:20.407Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:20.409Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:52:20.410Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 9% (4/43)","timestamp":"2025-04-17T05:52:20.412Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 9%","timestamp":"2025-04-17T05:52:20.413Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 9%","timestamp":"2025-04-17T05:52:20.416Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cb9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:52:20.427Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T05:52:20.429Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:52:20.430Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:52:20.435Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T05:52:20.436Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:52:20.437Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T05:52:20.497Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.2液体样品：\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:20.498Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T05:52:20.510Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.2液体样品：\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:20.510Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb9.","timestamp":"2025-04-17T05:52:20.516Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb9 status to TRANSLATING.","timestamp":"2025-04-17T05:52:20.516Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb9.","timestamp":"2025-04-17T05:52:20.521Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb9 status to TRANSLATING.","timestamp":"2025-04-17T05:52:20.521Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:52:20.527Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:52:20.538Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:52:20.539Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:52:20.549Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:52:20.549Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 10","timestamp":"2025-04-17T05:52:20.551Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:52:20.552Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:52:20.562Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:52:20.563Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:52:20.564Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:52:20.564Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:52:20.568Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:52:20.572Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:52:20.574Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:52:20.588Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:52:20.590Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T05:52:20.590Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":10,"timestamp":"2025-04-17T05:52:20.592Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:52:20.607Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:52:20.617Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:52:20.619Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:52:20.632Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:52:20.635Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:52:20.642Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:52:20.642Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:52:20.643Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 10","timestamp":"2025-04-17T05:52:20.645Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:52:20.646Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:52:20.651Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:52:20.658Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:52:20.660Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:52:20.661Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:52:20.661Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:52:20.661Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:52:20.662Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:52:20.662Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:52:20.662Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T05:52:20.663Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":10,"timestamp":"2025-04-17T05:52:20.663Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:52:20.663Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:52:20.664Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:52:20.664Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:31.282Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10690ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:31.289Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:31.293Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:52:31.294Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:31.300Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10636ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:31.300Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:31.302Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:52:31.302Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:31.314Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:31.318Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cb9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:52:31.318Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 12% (5/43)","timestamp":"2025-04-17T05:52:31.319Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:31.320Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:31.321Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:52:31.322Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 12% (5/43)","timestamp":"2025-04-17T05:52:31.323Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 12%","timestamp":"2025-04-17T05:52:31.326Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cba in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:52:31.327Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T05:52:31.328Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cba, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:52:31.337Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 12%","timestamp":"2025-04-17T05:52:31.339Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cba in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:52:31.341Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T05:52:31.343Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cba, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:52:31.343Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T05:52:31.378Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:31.380Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T05:52:31.385Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:31.386Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cba.","timestamp":"2025-04-17T05:52:31.391Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cba status to TRANSLATING.","timestamp":"2025-04-17T05:52:31.417Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cba.","timestamp":"2025-04-17T05:52:31.425Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cba status to TRANSLATING.","timestamp":"2025-04-17T05:52:31.426Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:52:31.433Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:52:31.437Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:52:31.445Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:52:31.447Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:52:31.448Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:52:31.449Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 503","timestamp":"2025-04-17T05:52:31.452Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:52:31.453Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:52:31.458Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:52:31.459Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:52:31.460Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:52:31.461Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:52:31.462Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:52:31.463Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:52:31.465Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:52:31.467Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:52:31.467Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T05:52:31.486Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":503,"timestamp":"2025-04-17T05:52:31.489Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:52:31.490Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:52:31.494Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:52:31.495Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:52:31.501Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:52:31.510Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:52:31.511Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:52:31.513Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 503","timestamp":"2025-04-17T05:52:31.514Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:52:31.516Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:52:31.521Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:52:31.523Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:52:31.524Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:52:31.525Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:52:31.527Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:52:31.538Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:52:31.539Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:52:31.541Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:52:31.543Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T05:52:31.544Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":503,"timestamp":"2025-04-17T05:52:31.545Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:52:31.547Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:52:31.550Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:52:31.550Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:52:37.740Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:52:37.748Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:37.749Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:37.750Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:37.750Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:37.753Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:37.761Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:42.147Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10657ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:42.149Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cba: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:42.155Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cba as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:52:42.155Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:42.162Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10617ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:42.164Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cba: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:42.165Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cba as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:52:42.169Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:42.176Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:42.187Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cba not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:52:42.187Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 14% (6/43)","timestamp":"2025-04-17T05:52:42.188Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:42.190Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:42.191Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cba not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:52:42.192Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 14% (6/43)","timestamp":"2025-04-17T05:52:42.192Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 14%","timestamp":"2025-04-17T05:52:42.193Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cbb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:52:42.193Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T05:52:42.193Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:52:42.194Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 14%","timestamp":"2025-04-17T05:52:42.197Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:52:42.198Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T05:52:42.198Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:52:42.199Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T05:52:42.217Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:42.217Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T05:52:42.222Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:42.222Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbb.","timestamp":"2025-04-17T05:52:42.224Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbb status to TRANSLATING.","timestamp":"2025-04-17T05:52:42.225Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbb.","timestamp":"2025-04-17T05:52:42.227Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbb status to TRANSLATING.","timestamp":"2025-04-17T05:52:42.227Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:52:42.243Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:52:42.251Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:52:42.256Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:52:42.257Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:52:42.257Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:52:42.258Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:52:42.258Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:52:42.258Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:52:42.264Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:52:42.264Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:52:42.265Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:52:42.266Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:52:42.267Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:52:42.267Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:52:42.268Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:52:42.268Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:52:42.268Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T05:52:42.269Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":51,"timestamp":"2025-04-17T05:52:42.269Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:52:42.270Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:52:42.273Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:52:42.285Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:52:42.291Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:52:42.292Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:52:42.292Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:52:42.292Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:52:42.292Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:52:42.293Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:52:42.297Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:52:42.298Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:52:42.298Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:52:42.299Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:52:42.299Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:52:42.299Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:52:42.300Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:52:42.300Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:52:42.301Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T05:52:42.315Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":51,"timestamp":"2025-04-17T05:52:42.316Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:52:42.316Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:52:42.318Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:52:42.318Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/users/stats","timestamp":"2025-04-17T05:52:45.136Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/recent","timestamp":"2025-04-17T05:52:45.138Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/users/stats","timestamp":"2025-04-17T05:52:45.140Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:45.142Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:45.142Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:45.143Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:45.144Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: GET /api/users/stats","timestamp":"2025-04-17T05:52:45.146Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:45.147Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:45.147Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:45.148Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:45.149Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/recent","timestamp":"2025-04-17T05:52:45.151Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:45.154Z"}
{"level":"info","message":"Request received to get stats for user: 67fcb942de30090a16d422b0","timestamp":"2025-04-17T05:52:45.154Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/recent","timestamp":"2025-04-17T05:52:45.157Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:45.157Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:45.158Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:45.158Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:45.160Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:45.169Z"}
{"level":"info","message":"Request received to get stats for user: 67fcb942de30090a16d422b0","timestamp":"2025-04-17T05:52:45.170Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/recent","timestamp":"2025-04-17T05:52:45.175Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:45.178Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:45.179Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:45.179Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:45.182Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:45.185Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:45.212Z"}
{"level":"info","message":"Stats retrieved for user 67fcb942de30090a16d422b0: {\"totalProjects\":15,\"pendingReviews\":0,\"completedFiles\":0,\"overallProgress\":50}","timestamp":"2025-04-17T05:52:45.261Z"}
{"level":"info","message":"Stats retrieved for user 67fcb942de30090a16d422b0: {\"totalProjects\":15,\"pendingReviews\":0,\"completedFiles\":0,\"overallProgress\":50}","timestamp":"2025-04-17T05:52:45.267Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects?limit=20","timestamp":"2025-04-17T05:52:45.704Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects?limit=20","timestamp":"2025-04-17T05:52:45.716Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:45.717Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:45.718Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:45.718Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:45.720Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:45.724Z"}
{"level":"info","message":"[ProjectController.getProjects] Entered function for user ID (from auth): 67fcb942de30090a16d422b0","timestamp":"2025-04-17T05:52:45.725Z"}
{"level":"info","message":"[ProjectController.getProjects] Service returned result for user 67fcb942de30090a16d422b0:","pagination":{"limit":20,"page":1,"total":15,"totalPages":1},"projects":[{"__v":0,"_id":"6800625db601745b33861ae0","createdAt":"2025-04-17T02:07:25.548Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"ttt","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-17T02:07:25.548Z"},{"__v":0,"_id":"67ff99f4faf101ce1590b9bb","createdAt":"2025-04-16T11:52:20.438Z","deadline":"2025-04-17T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"啪啪啪","domain":"Legal","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"啪啪啪","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-16T11:52:20.438Z"},{"__v":0,"_id":"67fe03eacb309c902c850eb8","createdAt":"2025-04-15T06:59:54.293Z","deadline":"2025-04-19T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"大苏打","domain":"Regulatory","files":[],"industry":"Insurance","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test2","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:59:54.293Z"},{"__v":0,"_id":"67fe0005cb309c902c850db4","createdAt":"2025-04-15T06:43:17.704Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:43:17.704Z"},{"__v":0,"_id":"67fdff98cb309c902c850dab","createdAt":"2025-04-15T06:41:28.139Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:41:28.139Z"},{"__v":0,"_id":"67fdcfab3034155a167dee53","createdAt":"2025-04-15T03:16:59.289Z","deadline":"2025-04-25T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"languagePairs":[{"source":"es-ES","target":"ja"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"时代的","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-15T03:16:59.289Z"},{"__v":0,"_id":"67fdcb1a3b5c61926af422a3","createdAt":"2025-04-15T02:57:30.435Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Legal","files":[],"languagePairs":[{"source":"es-ES","target":"en-GB"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"对的","owner":"67fcb942de30090a16d422b0","reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:57:30.435Z"},{"__v":0,"_id":"67fdc7595cd4632c3a64e06c","createdAt":"2025-04-15T02:41:29.100Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Technical","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"en-US","target":"es-ES"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"是","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:41:29.100Z"},{"__v":0,"_id":"67fdc5535cd4632c3a64e019","createdAt":"2025-04-15T02:32:51.795Z","deadline":"2025-04-27T00:00:00.000Z","files":[],"languagePairs":[{"source":"zh-CN","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"设施","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-15T02:32:51.795Z"},{"__v":0,"_id":"67fcfe157c51da91b704e51e","createdAt":"2025-04-14T12:22:45.978Z","deadline":"2025-04-04T00:00:00.000Z","domain":"Education","files":[],"languagePairs":[{"source":"it","target":"ar"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T12:22:45.978Z"},{"__v":0,"_id":"67fcfc2102aa2a1f99f37d37","createdAt":"2025-04-14T12:14:25.708Z","deadline":"2025-04-12T00:00:00.000Z","domain":"Finance","files":[],"industry":"Construction & Civil Engineering","languagePairs":[{"source":"de","target":"it"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"003","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-14T12:14:25.708Z"},{"__v":0,"_id":"67fcecf20e1b74f905d75904","createdAt":"2025-04-14T11:09:38.351Z","deadline":"2025-04-24T00:00:00.000Z","description":"111","domain":"Medical","files":[],"industry":"Insurance","languagePairs":[{"source":"de","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"111","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:09:38.351Z"},{"__v":0,"_id":"67fcec3e0e1b74f905d758bd","createdAt":"2025-04-14T11:06:38.798Z","deadline":"2025-04-19T00:00:00.000Z","description":"是","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"en-GB","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:06:38.798Z"},{"__v":0,"_id":"67fcebfb0e1b74f905d758ac","createdAt":"2025-04-14T11:05:31.666Z","deadline":"2025-04-18T00:00:00.000Z","domain":"Finance","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"zh-TW","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:05:31.666Z"},{"__v":0,"_id":"67fce378e8e77e8888f5a6d8","createdAt":"2025-04-14T10:29:12.586Z","deadline":"2025-04-22T00:00:00.000Z","description":"设施","domain":"Gaming","files":[],"industry":"Software Development","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T10:29:12.586Z"}],"timestamp":"2025-04-17T05:52:45.770Z"}
{"level":"info","message":"[ProjectController.getProjects] Found 15 projects.","timestamp":"2025-04-17T05:52:45.791Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/auth/profile","timestamp":"2025-04-17T05:52:48.906Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/auth/profile","timestamp":"2025-04-17T05:52:48.925Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:48.927Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:48.928Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:48.929Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:48.931Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:48.940Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/auth/profile","timestamp":"2025-04-17T05:52:48.960Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/auth/profile","timestamp":"2025-04-17T05:52:48.964Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:48.966Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:48.966Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:48.967Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:48.972Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:48.984Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:52:49.157Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects?limit=20","timestamp":"2025-04-17T05:52:49.161Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:49.163Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:49.163Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:49.164Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:49.165Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:52:49.168Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:52:49.170Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:49.171Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:49.172Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:49.172Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:49.174Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:49.179Z"}
{"level":"info","message":"[ProjectController.getProjects] Entered function for user ID (from auth): 67fcb942de30090a16d422b0","timestamp":"2025-04-17T05:52:49.180Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:52:49.184Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:49.184Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:49.185Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:49.185Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:49.186Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:49.190Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:52:49.193Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:49.199Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:49.200Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:49.200Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:49.202Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:49.210Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:49.217Z"}
{"level":"info","message":"[ProjectController.getProjects] Service returned result for user 67fcb942de30090a16d422b0:","pagination":{"limit":20,"page":1,"total":15,"totalPages":1},"projects":[{"__v":0,"_id":"6800625db601745b33861ae0","createdAt":"2025-04-17T02:07:25.548Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"ttt","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-17T02:07:25.548Z"},{"__v":0,"_id":"67ff99f4faf101ce1590b9bb","createdAt":"2025-04-16T11:52:20.438Z","deadline":"2025-04-17T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"啪啪啪","domain":"Legal","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"啪啪啪","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-16T11:52:20.438Z"},{"__v":0,"_id":"67fe03eacb309c902c850eb8","createdAt":"2025-04-15T06:59:54.293Z","deadline":"2025-04-19T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"大苏打","domain":"Regulatory","files":[],"industry":"Insurance","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test2","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:59:54.293Z"},{"__v":0,"_id":"67fe0005cb309c902c850db4","createdAt":"2025-04-15T06:43:17.704Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:43:17.704Z"},{"__v":0,"_id":"67fdff98cb309c902c850dab","createdAt":"2025-04-15T06:41:28.139Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:41:28.139Z"},{"__v":0,"_id":"67fdcfab3034155a167dee53","createdAt":"2025-04-15T03:16:59.289Z","deadline":"2025-04-25T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"languagePairs":[{"source":"es-ES","target":"ja"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"时代的","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-15T03:16:59.289Z"},{"__v":0,"_id":"67fdcb1a3b5c61926af422a3","createdAt":"2025-04-15T02:57:30.435Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Legal","files":[],"languagePairs":[{"source":"es-ES","target":"en-GB"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"对的","owner":"67fcb942de30090a16d422b0","reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:57:30.435Z"},{"__v":0,"_id":"67fdc7595cd4632c3a64e06c","createdAt":"2025-04-15T02:41:29.100Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Technical","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"en-US","target":"es-ES"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"是","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:41:29.100Z"},{"__v":0,"_id":"67fdc5535cd4632c3a64e019","createdAt":"2025-04-15T02:32:51.795Z","deadline":"2025-04-27T00:00:00.000Z","files":[],"languagePairs":[{"source":"zh-CN","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"设施","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-15T02:32:51.795Z"},{"__v":0,"_id":"67fcfe157c51da91b704e51e","createdAt":"2025-04-14T12:22:45.978Z","deadline":"2025-04-04T00:00:00.000Z","domain":"Education","files":[],"languagePairs":[{"source":"it","target":"ar"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T12:22:45.978Z"},{"__v":0,"_id":"67fcfc2102aa2a1f99f37d37","createdAt":"2025-04-14T12:14:25.708Z","deadline":"2025-04-12T00:00:00.000Z","domain":"Finance","files":[],"industry":"Construction & Civil Engineering","languagePairs":[{"source":"de","target":"it"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"003","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-14T12:14:25.708Z"},{"__v":0,"_id":"67fcecf20e1b74f905d75904","createdAt":"2025-04-14T11:09:38.351Z","deadline":"2025-04-24T00:00:00.000Z","description":"111","domain":"Medical","files":[],"industry":"Insurance","languagePairs":[{"source":"de","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"111","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:09:38.351Z"},{"__v":0,"_id":"67fcec3e0e1b74f905d758bd","createdAt":"2025-04-14T11:06:38.798Z","deadline":"2025-04-19T00:00:00.000Z","description":"是","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"en-GB","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:06:38.798Z"},{"__v":0,"_id":"67fcebfb0e1b74f905d758ac","createdAt":"2025-04-14T11:05:31.666Z","deadline":"2025-04-18T00:00:00.000Z","domain":"Finance","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"zh-TW","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:05:31.666Z"},{"__v":0,"_id":"67fce378e8e77e8888f5a6d8","createdAt":"2025-04-14T10:29:12.586Z","deadline":"2025-04-22T00:00:00.000Z","description":"设施","domain":"Gaming","files":[],"industry":"Software Development","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T10:29:12.586Z"}],"timestamp":"2025-04-17T05:52:49.241Z"}
{"level":"info","message":"[ProjectController.getProjects] Found 15 projects.","timestamp":"2025-04-17T05:52:49.268Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:50.873Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:50.876Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:50.877Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:50.877Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:50.877Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:50.878Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:50.885Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T05:52:52.591Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T05:52:52.592Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T05:52:52.597Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:52.598Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:52.598Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:52.599Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:52.600Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T05:52:52.603Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:52.604Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:52.604Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:52.604Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:52.605Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:52.608Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:52.609Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:52.610Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:52.610Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:52.612Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:52.616Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:52.619Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:52.619Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:52.620Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:52.621Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:52.623Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:52.627Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:52.928Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10657ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:52.932Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:52.939Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:52:52.940Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:52.945Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10628ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:52:52.945Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:52.946Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:52:52.946Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:52.951Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:52.952Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cbb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:52:52.953Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 16% (7/43)","timestamp":"2025-04-17T05:52:52.953Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:52.967Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:52:52.968Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:52:52.969Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 16% (7/43)","timestamp":"2025-04-17T05:52:52.970Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 16%","timestamp":"2025-04-17T05:52:52.975Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cbc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:52:52.976Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T05:52:52.978Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:52:52.980Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 16%","timestamp":"2025-04-17T05:52:52.982Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:52:52.983Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T05:52:52.983Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:52:52.983Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T05:52:53.011Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:53.012Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T05:52:53.017Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:52:53.018Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbc.","timestamp":"2025-04-17T05:52:53.032Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbc status to TRANSLATING.","timestamp":"2025-04-17T05:52:53.033Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbc.","timestamp":"2025-04-17T05:52:53.038Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbc status to TRANSLATING.","timestamp":"2025-04-17T05:52:53.039Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:52:53.052Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:52:53.057Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:52:53.061Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:52:53.061Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:52:53.062Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:52:53.064Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 199","timestamp":"2025-04-17T05:52:53.064Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:52:53.073Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:52:53.076Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:52:53.076Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:52:53.077Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:52:53.077Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 199","timestamp":"2025-04-17T05:52:53.077Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:52:53.080Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:52:53.086Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:52:53.087Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:52:53.087Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:52:53.088Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:52:53.088Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:52:53.089Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:52:53.089Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:52:53.090Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:52:53.090Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T05:52:53.092Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":199,"timestamp":"2025-04-17T05:52:53.092Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:52:53.092Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:52:53.093Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:52:53.095Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:52:53.110Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:52:53.112Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:52:53.113Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:52:53.114Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:52:53.114Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:52:53.114Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:52:53.115Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:52:53.115Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:52:53.115Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T05:52:53.115Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":199,"timestamp":"2025-04-17T05:52:53.116Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:52:53.116Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:52:53.117Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:52:53.117Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T05:52:58.698Z"}
{"level":"info","message":"[ENTRY] Received request: POST /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T05:52:58.717Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:58.719Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:58.720Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:58.720Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:58.722Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:58.727Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:52:58.727Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:52:58.728Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:52:58.728Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:52:58.735Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:52:58.739Z"}
{"level":"info","message":"User 67fcb942de30090a16d422b0 uploading file \"test.docx_eng-US.mqxliff\" to project 6800625db601745b33861ae0 (Languages: zh-CN -> en-US)","timestamp":"2025-04-17T05:52:58.764Z"}
{"level":"info","message":"File record created for test.docx_eng-US.mqxliff with ID 6800973a55fa4eee124c497c","timestamp":"2025-04-17T05:52:58.816Z"}
{"level":"info","message":"Processing file D:/project/translation-platform/uploads/file-1744869178746-727283251.mqxliff using processor for type mqxliff","timestamp":"2025-04-17T05:52:58.842Z"}
{"level":"info","message":"Starting XLIFF segment extraction from file: D:/project/translation-platform/uploads/file-1744869178746-727283251.mqxliff (MemoQ: true)","timestamp":"2025-04-17T05:52:58.844Z"}
{"level":"info","message":"Successfully extracted 7 segments from XLIFF file: D:/project/translation-platform/uploads/file-1744869178746-727283251.mqxliff.","timestamp":"2025-04-17T05:52:58.901Z"}
{"level":"info","message":"Successfully processed file D:/project/translation-platform/uploads/file-1744869178746-727283251.mqxliff. Found 7 segments.","timestamp":"2025-04-17T05:52:58.902Z"}
{"level":"info","message":"Inserted 7 segments for file 6800973a55fa4eee124c497c","timestamp":"2025-04-17T05:52:58.940Z"}
{"level":"info","message":"Successfully processed file test.docx_eng-US.mqxliff (ID: 6800973a55fa4eee124c497c)","timestamp":"2025-04-17T05:52:58.954Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects?limit=100","timestamp":"2025-04-17T05:53:00.706Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects?limit=100","timestamp":"2025-04-17T05:53:00.707Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects?limit=100","timestamp":"2025-04-17T05:53:00.709Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:00.710Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:00.710Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:00.711Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:00.713Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects?limit=100","timestamp":"2025-04-17T05:53:00.715Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:00.716Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:00.719Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:00.719Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:00.721Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:00.725Z"}
{"level":"info","message":"[ProjectController.getProjects] Entered function for user ID (from auth): 67fcb942de30090a16d422b0","timestamp":"2025-04-17T05:53:00.726Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:00.730Z"}
{"level":"info","message":"[ProjectController.getProjects] Entered function for user ID (from auth): 67fcb942de30090a16d422b0","timestamp":"2025-04-17T05:53:00.730Z"}
{"level":"info","message":"[ProjectController.getProjects] Service returned result for user 67fcb942de30090a16d422b0:","pagination":{"limit":100,"page":1,"total":15,"totalPages":1},"projects":[{"__v":0,"_id":"6800625db601745b33861ae0","createdAt":"2025-04-17T02:07:25.548Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"ttt","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-17T02:07:25.548Z"},{"__v":0,"_id":"67ff99f4faf101ce1590b9bb","createdAt":"2025-04-16T11:52:20.438Z","deadline":"2025-04-17T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"啪啪啪","domain":"Legal","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"啪啪啪","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-16T11:52:20.438Z"},{"__v":0,"_id":"67fe03eacb309c902c850eb8","createdAt":"2025-04-15T06:59:54.293Z","deadline":"2025-04-19T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"大苏打","domain":"Regulatory","files":[],"industry":"Insurance","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test2","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:59:54.293Z"},{"__v":0,"_id":"67fe0005cb309c902c850db4","createdAt":"2025-04-15T06:43:17.704Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:43:17.704Z"},{"__v":0,"_id":"67fdff98cb309c902c850dab","createdAt":"2025-04-15T06:41:28.139Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:41:28.139Z"},{"__v":0,"_id":"67fdcfab3034155a167dee53","createdAt":"2025-04-15T03:16:59.289Z","deadline":"2025-04-25T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"languagePairs":[{"source":"es-ES","target":"ja"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"时代的","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-15T03:16:59.289Z"},{"__v":0,"_id":"67fdcb1a3b5c61926af422a3","createdAt":"2025-04-15T02:57:30.435Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Legal","files":[],"languagePairs":[{"source":"es-ES","target":"en-GB"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"对的","owner":"67fcb942de30090a16d422b0","reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:57:30.435Z"},{"__v":0,"_id":"67fdc7595cd4632c3a64e06c","createdAt":"2025-04-15T02:41:29.100Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Technical","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"en-US","target":"es-ES"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"是","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:41:29.100Z"},{"__v":0,"_id":"67fdc5535cd4632c3a64e019","createdAt":"2025-04-15T02:32:51.795Z","deadline":"2025-04-27T00:00:00.000Z","files":[],"languagePairs":[{"source":"zh-CN","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"设施","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-15T02:32:51.795Z"},{"__v":0,"_id":"67fcfe157c51da91b704e51e","createdAt":"2025-04-14T12:22:45.978Z","deadline":"2025-04-04T00:00:00.000Z","domain":"Education","files":[],"languagePairs":[{"source":"it","target":"ar"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T12:22:45.978Z"},{"__v":0,"_id":"67fcfc2102aa2a1f99f37d37","createdAt":"2025-04-14T12:14:25.708Z","deadline":"2025-04-12T00:00:00.000Z","domain":"Finance","files":[],"industry":"Construction & Civil Engineering","languagePairs":[{"source":"de","target":"it"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"003","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-14T12:14:25.708Z"},{"__v":0,"_id":"67fcecf20e1b74f905d75904","createdAt":"2025-04-14T11:09:38.351Z","deadline":"2025-04-24T00:00:00.000Z","description":"111","domain":"Medical","files":[],"industry":"Insurance","languagePairs":[{"source":"de","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"111","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:09:38.351Z"},{"__v":0,"_id":"67fcec3e0e1b74f905d758bd","createdAt":"2025-04-14T11:06:38.798Z","deadline":"2025-04-19T00:00:00.000Z","description":"是","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"en-GB","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:06:38.798Z"},{"__v":0,"_id":"67fcebfb0e1b74f905d758ac","createdAt":"2025-04-14T11:05:31.666Z","deadline":"2025-04-18T00:00:00.000Z","domain":"Finance","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"zh-TW","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:05:31.666Z"},{"__v":0,"_id":"67fce378e8e77e8888f5a6d8","createdAt":"2025-04-14T10:29:12.586Z","deadline":"2025-04-22T00:00:00.000Z","description":"设施","domain":"Gaming","files":[],"industry":"Software Development","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T10:29:12.586Z"}],"timestamp":"2025-04-17T05:53:00.753Z"}
{"level":"info","message":"[ProjectController.getProjects] Found 15 projects.","timestamp":"2025-04-17T05:53:00.765Z"}
{"level":"info","message":"[ProjectController.getProjects] Service returned result for user 67fcb942de30090a16d422b0:","pagination":{"limit":100,"page":1,"total":15,"totalPages":1},"projects":[{"__v":0,"_id":"6800625db601745b33861ae0","createdAt":"2025-04-17T02:07:25.548Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"ttt","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-17T02:07:25.548Z"},{"__v":0,"_id":"67ff99f4faf101ce1590b9bb","createdAt":"2025-04-16T11:52:20.438Z","deadline":"2025-04-17T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"啪啪啪","domain":"Legal","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"啪啪啪","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-16T11:52:20.438Z"},{"__v":0,"_id":"67fe03eacb309c902c850eb8","createdAt":"2025-04-15T06:59:54.293Z","deadline":"2025-04-19T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"大苏打","domain":"Regulatory","files":[],"industry":"Insurance","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test2","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:59:54.293Z"},{"__v":0,"_id":"67fe0005cb309c902c850db4","createdAt":"2025-04-15T06:43:17.704Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:43:17.704Z"},{"__v":0,"_id":"67fdff98cb309c902c850dab","createdAt":"2025-04-15T06:41:28.139Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:41:28.139Z"},{"__v":0,"_id":"67fdcfab3034155a167dee53","createdAt":"2025-04-15T03:16:59.289Z","deadline":"2025-04-25T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"languagePairs":[{"source":"es-ES","target":"ja"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"时代的","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-15T03:16:59.289Z"},{"__v":0,"_id":"67fdcb1a3b5c61926af422a3","createdAt":"2025-04-15T02:57:30.435Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Legal","files":[],"languagePairs":[{"source":"es-ES","target":"en-GB"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"对的","owner":"67fcb942de30090a16d422b0","reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:57:30.435Z"},{"__v":0,"_id":"67fdc7595cd4632c3a64e06c","createdAt":"2025-04-15T02:41:29.100Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Technical","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"en-US","target":"es-ES"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"是","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:41:29.100Z"},{"__v":0,"_id":"67fdc5535cd4632c3a64e019","createdAt":"2025-04-15T02:32:51.795Z","deadline":"2025-04-27T00:00:00.000Z","files":[],"languagePairs":[{"source":"zh-CN","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"设施","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-15T02:32:51.795Z"},{"__v":0,"_id":"67fcfe157c51da91b704e51e","createdAt":"2025-04-14T12:22:45.978Z","deadline":"2025-04-04T00:00:00.000Z","domain":"Education","files":[],"languagePairs":[{"source":"it","target":"ar"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T12:22:45.978Z"},{"__v":0,"_id":"67fcfc2102aa2a1f99f37d37","createdAt":"2025-04-14T12:14:25.708Z","deadline":"2025-04-12T00:00:00.000Z","domain":"Finance","files":[],"industry":"Construction & Civil Engineering","languagePairs":[{"source":"de","target":"it"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"003","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-14T12:14:25.708Z"},{"__v":0,"_id":"67fcecf20e1b74f905d75904","createdAt":"2025-04-14T11:09:38.351Z","deadline":"2025-04-24T00:00:00.000Z","description":"111","domain":"Medical","files":[],"industry":"Insurance","languagePairs":[{"source":"de","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"111","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:09:38.351Z"},{"__v":0,"_id":"67fcec3e0e1b74f905d758bd","createdAt":"2025-04-14T11:06:38.798Z","deadline":"2025-04-19T00:00:00.000Z","description":"是","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"en-GB","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:06:38.798Z"},{"__v":0,"_id":"67fcebfb0e1b74f905d758ac","createdAt":"2025-04-14T11:05:31.666Z","deadline":"2025-04-18T00:00:00.000Z","domain":"Finance","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"zh-TW","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:05:31.666Z"},{"__v":0,"_id":"67fce378e8e77e8888f5a6d8","createdAt":"2025-04-14T10:29:12.586Z","deadline":"2025-04-22T00:00:00.000Z","description":"设施","domain":"Gaming","files":[],"industry":"Software Development","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T10:29:12.586Z"}],"timestamp":"2025-04-17T05:53:00.772Z"}
{"level":"info","message":"[ProjectController.getProjects] Found 15 projects.","timestamp":"2025-04-17T05:53:00.777Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T05:53:01.879Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:01.882Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:01.884Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:01.884Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:01.886Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:01.892Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:01.896Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:01.901Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:01.901Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:01.901Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:01.903Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/prompts","timestamp":"2025-04-17T05:53:01.907Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/ai-configs","timestamp":"2025-04-17T05:53:01.908Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:01.909Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:01.911Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:01.912Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:01.915Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:01.916Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:01.917Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: GET /api/prompts","timestamp":"2025-04-17T05:53:01.922Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:01.923Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:01.923Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:01.923Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:01.924Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: GET /api/ai-configs","timestamp":"2025-04-17T05:53:01.926Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:01.926Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:01.927Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:01.927Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:01.929Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:01.937Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:01.939Z"}
{"level":"info","message":"Entering PromptTemplateController.getAllTemplates","timestamp":"2025-04-17T05:53:01.940Z"}
{"level":"debug","message":"PromptTemplateService.getAllPromptTemplates called","timestamp":"2025-04-17T05:53:01.940Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:01.944Z"}
{"level":"info","message":"Entering AIConfigController.getAllConfigs","timestamp":"2025-04-17T05:53:01.947Z"}
{"level":"info","message":"AIConfigService.getAllConfigs: Retrieved 1 total AI configs","timestamp":"2025-04-17T05:53:01.969Z"}
{"level":"info","message":"Found 4 prompt templates.","timestamp":"2025-04-17T05:53:01.983Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:03.790Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10697ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:03.798Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:03.805Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:03.806Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:03.815Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10697ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:03.816Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:03.817Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:03.828Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:03.833Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:03.834Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cbc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:03.835Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 19% (8/43)","timestamp":"2025-04-17T05:53:03.835Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:03.842Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:03.845Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:03.846Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 19% (8/43)","timestamp":"2025-04-17T05:53:03.846Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 19%","timestamp":"2025-04-17T05:53:03.848Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cbd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:53:03.860Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:53:03.860Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:03.860Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 19%","timestamp":"2025-04-17T05:53:03.866Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:53:03.867Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:53:03.867Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:03.868Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:53:03.898Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:03.899Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:53:03.905Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:03.906Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbd.","timestamp":"2025-04-17T05:53:03.908Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbd status to TRANSLATING.","timestamp":"2025-04-17T05:53:03.909Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbd.","timestamp":"2025-04-17T05:53:03.913Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbd status to TRANSLATING.","timestamp":"2025-04-17T05:53:03.925Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:03.931Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:03.934Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:03.935Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:03.935Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:03.936Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 314","timestamp":"2025-04-17T05:53:03.937Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:53:03.937Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:53:03.941Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:03.942Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:53:03.943Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:03.943Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:53:03.944Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:53:03.944Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:53:03.954Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:53:03.955Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:53:03.955Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:53:03.955Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":314,"timestamp":"2025-04-17T05:53:03.956Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:53:03.956Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:53:03.957Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:53:03.957Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:03.961Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:03.965Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:03.965Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:03.965Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:03.965Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 314","timestamp":"2025-04-17T05:53:03.966Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:53:03.966Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:53:03.968Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:03.969Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:53:03.969Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:03.969Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:53:03.970Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:53:03.970Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:53:03.971Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:53:03.971Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:53:03.972Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:53:03.972Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":314,"timestamp":"2025-04-17T05:53:03.973Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:53:03.973Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:53:03.974Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:53:03.975Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:53:10.860Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:53:10.877Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:10.879Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:10.880Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:10.880Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:10.882Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:10.887Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/6800625db601745b33861ae0/files/6800973a55fa4eee124c497c/translate","timestamp":"2025-04-17T05:53:14.066Z"}
{"level":"info","message":"[ENTRY] Received request: POST /api/projects/6800625db601745b33861ae0/files/6800973a55fa4eee124c497c/translate","timestamp":"2025-04-17T05:53:14.069Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:14.088Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:14.090Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:14.091Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:14.094Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:14.099Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:14.100Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:14.100Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:14.102Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:14.104Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:14.106Z"}
{"level":"info","message":"User 67fcb942de30090a16d422b0 queuing translation for file 6800973a55fa4eee124c497c in project 6800625db601745b33861ae0 using AI Config 67fe227be8f10dbf81036e7e and Prompt 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:14.118Z"}
{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"6800973a55fa4eee124c497c","level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] START Processing job. Raw Data:","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fcfb8802aa2a1f99f37d25","requesterRoles":["admin"],"timestamp":"2025-04-17T05:53:14.128Z","type":"file","userId":"67fcb942de30090a16d422b0"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T05:53:14.136Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Extracted - promptTemplateId: 67fcfb8802aa2a1f99f37d25, aiConfigId: 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:14.128Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing Details - Type: file, Project: 6800625db601745b33861ae0, File: 6800973a55fa4eee124c497c, AI Config: 67fe227be8f10dbf81036e7e, Prompt: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:14.132Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Determining segments to translate... Type: file","timestamp":"2025-04-17T05:53:14.133Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T05:53:14.138Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Fetching project 6800625db601745b33861ae0 for language info...","timestamp":"2025-04-17T05:53:14.138Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Project languages: zh-CN -> en-US","timestamp":"2025-04-17T05:53:14.143Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:14.139Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:14.139Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:14.139Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:14.142Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:14.146Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] File Job: Determined 7 segments to translate.","timestamp":"2025-04-17T05:53:14.150Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:14.146Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:14.147Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:14.147Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:14.149Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:14.158Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Determined Languages: zh-CN -> en-US","timestamp":"2025-04-17T05:53:14.155Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Starting segment processing loop for 7 segments.","timestamp":"2025-04-17T05:53:14.156Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c497f in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:14.157Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T05:53:14.157Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c497f, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:14.158Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T05:53:14.176Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1<rpr id=\"0\">.</rpr id=\"0\" transform=\"close\">1固体和半固体样品<rpr id=\"0\">：</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:14.184Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c497f.","timestamp":"2025-04-17T05:53:14.188Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c497f status to TRANSLATING.","timestamp":"2025-04-17T05:53:14.188Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:14.202Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:14.205Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:14.206Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:14.206Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:14.207Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 100","timestamp":"2025-04-17T05:53:14.207Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:14.207Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:14.212Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.216Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.216Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:14.216Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c497f: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.217Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c497f as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:14.217Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.233Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.242Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c497f not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:14.243Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 14% (1/7)","timestamp":"2025-04-17T05:53:14.244Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 14%","timestamp":"2025-04-17T05:53:14.245Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4980 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:14.246Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T05:53:14.247Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4980, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:14.248Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T05:53:14.275Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"称取25<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\"><rpr id=\"1\">8</rpr id=\"1\" transform=\"close\"> 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">10 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\">均质1 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">2 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:14.276Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4980.","timestamp":"2025-04-17T05:53:14.284Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4980 status to TRANSLATING.","timestamp":"2025-04-17T05:53:14.285Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:14.311Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:14.317Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:14.318Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:14.319Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:14.319Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 900","timestamp":"2025-04-17T05:53:14.320Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:14.321Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:14.340Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.341Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.342Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:14.343Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4980: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.344Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4980 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:14.345Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.375Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.377Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4980 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:14.378Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 29% (2/7)","timestamp":"2025-04-17T05:53:14.379Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 29%","timestamp":"2025-04-17T05:53:14.384Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4981 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:14.391Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T05:53:14.392Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4981, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:14.393Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T05:53:14.417Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品勻液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:14.418Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4981.","timestamp":"2025-04-17T05:53:14.425Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4981 status to TRANSLATING.","timestamp":"2025-04-17T05:53:14.425Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:14.437Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:14.453Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:14.455Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:14.456Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:14.457Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:53:14.458Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:14.459Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:14.466Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.475Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.476Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:14.476Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4981: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.477Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4981 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:14.477Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.499Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.508Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4981 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:14.509Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 43% (3/7)","timestamp":"2025-04-17T05:53:14.509Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 43%","timestamp":"2025-04-17T05:53:14.511Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4982 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:14.513Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T05:53:14.514Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4982, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:14.514Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:14.543Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10586ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:14.547Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:14.551Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:14.553Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:14.561Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10587ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:14.569Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:14.570Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:14.570Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T05:53:14.576Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.2液体样品：\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:14.577Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:14.580Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:14.581Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cbd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:14.582Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 21% (9/43)","timestamp":"2025-04-17T05:53:14.582Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4982.","timestamp":"2025-04-17T05:53:14.583Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4982 status to TRANSLATING.","timestamp":"2025-04-17T05:53:14.584Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 21%","timestamp":"2025-04-17T05:53:14.586Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cbe in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:53:14.586Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:53:14.586Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbe, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:14.586Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:14.594Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:14.601Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:14.602Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 21% (9/43)","timestamp":"2025-04-17T05:53:14.602Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:14.604Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 21%","timestamp":"2025-04-17T05:53:14.608Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbe in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:53:14.609Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:53:14.609Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbe, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:14.610Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:14.612Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:14.612Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:14.613Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:14.613Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 10","timestamp":"2025-04-17T05:53:14.614Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:14.614Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:14.627Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.633Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.634Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:14.634Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4982: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.635Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4982 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:14.636Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:53:14.644Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:14.645Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbe.","timestamp":"2025-04-17T05:53:14.652Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbe status to TRANSLATING.","timestamp":"2025-04-17T05:53:14.653Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.661Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.668Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4982 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:14.668Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 57% (4/7)","timestamp":"2025-04-17T05:53:14.668Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:53:14.673Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:14.674Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 57%","timestamp":"2025-04-17T05:53:14.678Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4983 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:14.678Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4983...","timestamp":"2025-04-17T05:53:14.680Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4983, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:14.680Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:14.683Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbe.","timestamp":"2025-04-17T05:53:14.687Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbe status to TRANSLATING.","timestamp":"2025-04-17T05:53:14.695Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:14.702Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:14.702Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:14.703Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:14.703Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 71","timestamp":"2025-04-17T05:53:14.704Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:53:14.704Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:14.708Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:53:14.713Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.714Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:53:14.715Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:14.715Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:53:14.715Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:53:14.715Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:53:14.716Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:53:14.716Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:53:14.716Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:53:14.717Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":71,"timestamp":"2025-04-17T05:53:14.725Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:53:14.726Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:53:14.726Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:53:14.727Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:14.730Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:14.730Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:14.731Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:14.731Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 71","timestamp":"2025-04-17T05:53:14.731Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:53:14.731Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:53:14.738Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.739Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:53:14.739Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:14.739Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:53:14.740Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:53:14.740Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:53:14.740Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:53:14.740Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:53:14.740Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:53:14.741Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":71,"timestamp":"2025-04-17T05:53:14.741Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:53:14.741Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:53:14.742Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:53:14.742Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4983...","timestamp":"2025-04-17T05:53:14.745Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"以无菌吸管吸取25<rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:14.746Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4983.","timestamp":"2025-04-17T05:53:14.751Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4983 status to TRANSLATING.","timestamp":"2025-04-17T05:53:14.765Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:14.783Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:14.788Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:14.789Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:14.789Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:14.790Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 503","timestamp":"2025-04-17T05:53:14.790Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:14.790Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:14.793Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.793Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.794Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:14.795Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4983: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.796Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4983 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:14.805Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.830Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.835Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4983 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:14.835Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 71% (5/7)","timestamp":"2025-04-17T05:53:14.837Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 71%","timestamp":"2025-04-17T05:53:14.839Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4984 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:14.841Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4984...","timestamp":"2025-04-17T05:53:14.843Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4984, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:14.845Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4984...","timestamp":"2025-04-17T05:53:14.871Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:14.873Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4984.","timestamp":"2025-04-17T05:53:14.876Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4984 status to TRANSLATING.","timestamp":"2025-04-17T05:53:14.876Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:14.892Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:14.895Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:14.895Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:14.896Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:14.896Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:53:14.896Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:14.897Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:14.901Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.902Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.902Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:14.903Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4984: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.904Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4984 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:14.915Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.923Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.924Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4984 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:14.925Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 86% (6/7)","timestamp":"2025-04-17T05:53:14.926Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 86%","timestamp":"2025-04-17T05:53:14.928Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4985 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:14.929Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4985...","timestamp":"2025-04-17T05:53:14.929Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4985, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:14.930Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4985...","timestamp":"2025-04-17T05:53:14.951Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"当结果要求为每<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"1\">6</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:14.953Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4985.","timestamp":"2025-04-17T05:53:14.959Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4985 status to TRANSLATING.","timestamp":"2025-04-17T05:53:14.959Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:14.968Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:14.977Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:14.978Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:14.978Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:14.978Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 199","timestamp":"2025-04-17T05:53:14.978Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:14.979Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:14.983Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.983Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:14.984Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:14.984Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4985: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:14.984Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4985 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:14.985Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:15.001Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:15.008Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4985 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:15.009Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 100% (7/7)","timestamp":"2025-04-17T05:53:15.010Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 100%","timestamp":"2025-04-17T05:53:15.012Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] FINISHED Segment Loop. Processed: 0, Errors: 7, Total Segments in Job: 7","timestamp":"2025-04-17T05:53:15.012Z"}
{"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Failing job due to segment errors: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:15.013Z"}
{"error":{},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] FAILED Catastrophically: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:15.014Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"6800973a55fa4eee124c497c","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fcfb8802aa2a1f99f37d25","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-6800973a55fa4eee124c497c-1744869194120","level":"error","message":"Job file-6800973a55fa4eee124c497c-1744869194120 failed. Error: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:15.019Z"}
{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"6800973a55fa4eee124c497c","level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] START Processing job. Raw Data:","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fcfb8802aa2a1f99f37d25","requesterRoles":["admin"],"timestamp":"2025-04-17T05:53:20.030Z","type":"file","userId":"67fcb942de30090a16d422b0"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Extracted - promptTemplateId: 67fcfb8802aa2a1f99f37d25, aiConfigId: 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:20.031Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing Details - Type: file, Project: 6800625db601745b33861ae0, File: 6800973a55fa4eee124c497c, AI Config: 67fe227be8f10dbf81036e7e, Prompt: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:20.035Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Determining segments to translate... Type: file","timestamp":"2025-04-17T05:53:20.037Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Fetching project 6800625db601745b33861ae0 for language info...","timestamp":"2025-04-17T05:53:20.043Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Project languages: zh-CN -> en-US","timestamp":"2025-04-17T05:53:20.051Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] File Job: Determined 7 segments to translate.","timestamp":"2025-04-17T05:53:20.056Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Determined Languages: zh-CN -> en-US","timestamp":"2025-04-17T05:53:20.057Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Starting segment processing loop for 7 segments.","timestamp":"2025-04-17T05:53:20.057Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c497f in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:20.057Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T05:53:20.057Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c497f, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:20.058Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T05:53:20.082Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1<rpr id=\"0\">.</rpr id=\"0\" transform=\"close\">1固体和半固体样品<rpr id=\"0\">：</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:20.083Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c497f.","timestamp":"2025-04-17T05:53:20.086Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c497f status to TRANSLATING.","timestamp":"2025-04-17T05:53:20.087Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:20.105Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:20.110Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:20.111Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:20.112Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:20.112Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 100","timestamp":"2025-04-17T05:53:20.112Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:20.112Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:20.118Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.118Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.119Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:20.120Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c497f: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.120Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c497f as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:20.120Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.140Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.141Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c497f not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:20.142Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 14% (1/7)","timestamp":"2025-04-17T05:53:20.142Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 14%","timestamp":"2025-04-17T05:53:20.144Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4980 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:20.145Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T05:53:20.145Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4980, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:20.145Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T05:53:20.166Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"称取25<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\"><rpr id=\"1\">8</rpr id=\"1\" transform=\"close\"> 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">10 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\">均质1 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">2 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:20.167Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4980.","timestamp":"2025-04-17T05:53:20.174Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4980 status to TRANSLATING.","timestamp":"2025-04-17T05:53:20.175Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:20.186Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:20.195Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:20.196Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:20.197Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:20.197Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 900","timestamp":"2025-04-17T05:53:20.198Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:20.199Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:20.203Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.204Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.204Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:20.204Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4980: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.205Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4980 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:20.206Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.217Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.219Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4980 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:20.220Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 29% (2/7)","timestamp":"2025-04-17T05:53:20.222Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 29%","timestamp":"2025-04-17T05:53:20.226Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4981 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:20.227Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T05:53:20.227Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4981, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:20.227Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T05:53:20.242Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品勻液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:20.242Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4981.","timestamp":"2025-04-17T05:53:20.245Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4981 status to TRANSLATING.","timestamp":"2025-04-17T05:53:20.250Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:20.266Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:20.270Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:20.271Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:20.272Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:20.272Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:53:20.272Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:20.272Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:20.276Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.276Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.276Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:20.277Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4981: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.278Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4981 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:20.286Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.300Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.301Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4981 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:20.301Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 43% (3/7)","timestamp":"2025-04-17T05:53:20.301Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 43%","timestamp":"2025-04-17T05:53:20.304Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4982 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:20.304Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T05:53:20.304Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4982, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:20.304Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T05:53:20.325Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.2液体样品：\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:20.327Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4982.","timestamp":"2025-04-17T05:53:20.334Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4982 status to TRANSLATING.","timestamp":"2025-04-17T05:53:20.335Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:20.343Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:20.352Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:20.353Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:20.353Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:20.354Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 10","timestamp":"2025-04-17T05:53:20.354Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:20.354Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:20.361Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.362Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.362Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:20.363Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4982: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.363Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4982 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:20.364Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.375Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.378Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4982 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:20.379Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 57% (4/7)","timestamp":"2025-04-17T05:53:20.379Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 57%","timestamp":"2025-04-17T05:53:20.380Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4983 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:20.380Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4983...","timestamp":"2025-04-17T05:53:20.381Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4983, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:20.381Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4983...","timestamp":"2025-04-17T05:53:20.406Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"以无菌吸管吸取25<rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:20.407Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4983.","timestamp":"2025-04-17T05:53:20.415Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4983 status to TRANSLATING.","timestamp":"2025-04-17T05:53:20.415Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:20.429Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:20.437Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:20.438Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:20.439Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:20.440Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 503","timestamp":"2025-04-17T05:53:20.441Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:20.441Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:20.444Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.445Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.446Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:20.447Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4983: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.449Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4983 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:20.453Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.470Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.472Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4983 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:20.472Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 71% (5/7)","timestamp":"2025-04-17T05:53:20.473Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 71%","timestamp":"2025-04-17T05:53:20.475Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4984 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:20.475Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4984...","timestamp":"2025-04-17T05:53:20.476Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4984, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:20.477Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4984...","timestamp":"2025-04-17T05:53:20.503Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:20.503Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4984.","timestamp":"2025-04-17T05:53:20.512Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4984 status to TRANSLATING.","timestamp":"2025-04-17T05:53:20.513Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:20.529Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:20.536Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:20.537Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:20.538Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:20.538Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:53:20.538Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:20.538Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:20.543Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.548Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.550Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:20.550Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4984: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.551Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4984 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:20.551Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.567Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.569Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4984 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:20.570Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 86% (6/7)","timestamp":"2025-04-17T05:53:20.574Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 86%","timestamp":"2025-04-17T05:53:20.576Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4985 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:20.577Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4985...","timestamp":"2025-04-17T05:53:20.577Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4985, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:20.578Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4985...","timestamp":"2025-04-17T05:53:20.615Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"当结果要求为每<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"1\">6</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:20.616Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4985.","timestamp":"2025-04-17T05:53:20.619Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4985 status to TRANSLATING.","timestamp":"2025-04-17T05:53:20.624Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:20.638Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:20.641Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:20.641Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:20.642Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:20.642Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 199","timestamp":"2025-04-17T05:53:20.642Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:20.643Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:20.644Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.644Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:20.645Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:20.645Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4985: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.645Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4985 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:20.645Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.651Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.653Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4985 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:20.653Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 100% (7/7)","timestamp":"2025-04-17T05:53:20.653Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 100%","timestamp":"2025-04-17T05:53:20.654Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] FINISHED Segment Loop. Processed: 0, Errors: 7, Total Segments in Job: 7","timestamp":"2025-04-17T05:53:20.654Z"}
{"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Failing job due to segment errors: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.655Z"}
{"error":{},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] FAILED Catastrophically: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.655Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"6800973a55fa4eee124c497c","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fcfb8802aa2a1f99f37d25","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-6800973a55fa4eee124c497c-1744869194120","level":"error","message":"Job file-6800973a55fa4eee124c497c-1744869194120 failed. Error: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:20.657Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:25.425Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10699ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:25.426Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbe: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:25.436Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbe as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:25.437Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:25.441Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10699ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:25.444Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbe: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:25.445Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbe as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:25.445Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:25.463Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:25.467Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbe not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:25.467Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 23% (10/43)","timestamp":"2025-04-17T05:53:25.467Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:25.469Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:25.470Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cbe not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:25.470Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 23% (10/43)","timestamp":"2025-04-17T05:53:25.470Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 23%","timestamp":"2025-04-17T05:53:25.471Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:53:25.471Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:53:25.471Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:25.472Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 23%","timestamp":"2025-04-17T05:53:25.473Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cbf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:53:25.473Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:53:25.474Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:25.474Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:53:25.482Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:25.482Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:53:25.483Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:25.483Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbf.","timestamp":"2025-04-17T05:53:25.484Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbf status to TRANSLATING.","timestamp":"2025-04-17T05:53:25.484Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbf.","timestamp":"2025-04-17T05:53:25.485Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbf status to TRANSLATING.","timestamp":"2025-04-17T05:53:25.492Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:25.503Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:25.505Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:25.506Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:25.507Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:25.507Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:25.507Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 110","timestamp":"2025-04-17T05:53:25.507Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:53:25.507Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:25.509Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:25.509Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:25.509Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:25.510Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 110","timestamp":"2025-04-17T05:53:25.510Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:53:25.510Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:53:25.511Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:25.511Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:53:25.511Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:25.511Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:53:25.511Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:53:25.511Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:53:25.511Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:53:25.512Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:53:25.512Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:53:25.512Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":110,"timestamp":"2025-04-17T05:53:25.512Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:53:25.513Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:53:25.513Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:53:25.513Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:53:25.515Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:25.515Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:53:25.515Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:25.515Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:53:25.515Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:53:25.515Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:53:25.515Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:53:25.515Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:53:25.515Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:53:25.515Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":110,"timestamp":"2025-04-17T05:53:25.515Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:53:25.515Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:53:25.516Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:53:25.516Z","url":"https://api.x.ai/v1/chat/completions"}
{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"6800973a55fa4eee124c497c","level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] START Processing job. Raw Data:","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fcfb8802aa2a1f99f37d25","requesterRoles":["admin"],"timestamp":"2025-04-17T05:53:30.736Z","type":"file","userId":"67fcb942de30090a16d422b0"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Extracted - promptTemplateId: 67fcfb8802aa2a1f99f37d25, aiConfigId: 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:33.962Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing Details - Type: file, Project: 6800625db601745b33861ae0, File: 6800973a55fa4eee124c497c, AI Config: 67fe227be8f10dbf81036e7e, Prompt: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:33.976Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Determining segments to translate... Type: file","timestamp":"2025-04-17T05:53:33.980Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Fetching project 6800625db601745b33861ae0 for language info...","timestamp":"2025-04-17T05:53:33.984Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Project languages: zh-CN -> en-US","timestamp":"2025-04-17T05:53:33.986Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] File Job: Determined 7 segments to translate.","timestamp":"2025-04-17T05:53:33.990Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Determined Languages: zh-CN -> en-US","timestamp":"2025-04-17T05:53:33.994Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Starting segment processing loop for 7 segments.","timestamp":"2025-04-17T05:53:33.994Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c497f in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:33.994Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T05:53:33.994Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c497f, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:33.994Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T05:53:34.003Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1<rpr id=\"0\">.</rpr id=\"0\" transform=\"close\">1固体和半固体样品<rpr id=\"0\">：</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:34.004Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c497f.","timestamp":"2025-04-17T05:53:34.006Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c497f status to TRANSLATING.","timestamp":"2025-04-17T05:53:34.010Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:34.029Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:34.033Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:34.033Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:34.033Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:34.033Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 100","timestamp":"2025-04-17T05:53:34.034Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:34.034Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:34.035Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.035Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.036Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:34.036Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c497f: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.036Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c497f as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:34.036Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.041Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.042Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c497f not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:34.043Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 14% (1/7)","timestamp":"2025-04-17T05:53:34.043Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 14%","timestamp":"2025-04-17T05:53:34.043Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4980 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:34.044Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T05:53:34.044Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4980, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:34.044Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T05:53:34.053Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"称取25<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\"><rpr id=\"1\">8</rpr id=\"1\" transform=\"close\"> 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">10 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\">均质1 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">2 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:34.053Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4980.","timestamp":"2025-04-17T05:53:34.062Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4980 status to TRANSLATING.","timestamp":"2025-04-17T05:53:34.062Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:34.067Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:34.069Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:34.077Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:34.077Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:34.078Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 900","timestamp":"2025-04-17T05:53:34.078Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:34.078Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:34.080Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.080Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.080Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:34.080Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4980: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.081Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4980 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:34.082Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.086Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.090Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4980 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:34.091Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 29% (2/7)","timestamp":"2025-04-17T05:53:34.091Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 29%","timestamp":"2025-04-17T05:53:34.092Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4981 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:34.092Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T05:53:34.092Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4981, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:34.093Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T05:53:34.101Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品勻液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:34.103Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4981.","timestamp":"2025-04-17T05:53:34.106Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4981 status to TRANSLATING.","timestamp":"2025-04-17T05:53:34.106Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:34.118Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:34.120Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:34.120Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:34.120Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:34.120Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:53:34.120Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:34.120Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:34.121Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.121Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.122Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:34.122Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4981: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.122Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4981 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:34.122Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.134Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.135Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4981 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:34.136Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 43% (3/7)","timestamp":"2025-04-17T05:53:34.136Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 43%","timestamp":"2025-04-17T05:53:34.136Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4982 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:34.137Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T05:53:34.137Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4982, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:34.137Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T05:53:34.144Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.2液体样品：\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:34.144Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4982.","timestamp":"2025-04-17T05:53:34.146Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4982 status to TRANSLATING.","timestamp":"2025-04-17T05:53:34.146Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:34.165Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:34.167Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:34.168Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:34.168Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:34.168Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 10","timestamp":"2025-04-17T05:53:34.168Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:34.168Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:34.171Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.172Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.172Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:34.172Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4982: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.172Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4982 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:34.172Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.182Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.184Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4982 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:34.185Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 57% (4/7)","timestamp":"2025-04-17T05:53:34.185Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 57%","timestamp":"2025-04-17T05:53:34.186Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4983 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:34.186Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4983...","timestamp":"2025-04-17T05:53:34.186Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4983, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:34.187Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4983...","timestamp":"2025-04-17T05:53:34.194Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"以无菌吸管吸取25<rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:34.196Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4983.","timestamp":"2025-04-17T05:53:34.198Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4983 status to TRANSLATING.","timestamp":"2025-04-17T05:53:34.198Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:34.210Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:34.214Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:34.214Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:34.214Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:34.214Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 503","timestamp":"2025-04-17T05:53:34.214Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:34.214Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:34.216Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.216Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.216Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:34.217Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4983: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.217Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4983 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:34.217Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.226Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.227Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4983 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:34.227Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 71% (5/7)","timestamp":"2025-04-17T05:53:34.228Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 71%","timestamp":"2025-04-17T05:53:34.228Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4984 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:34.228Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4984...","timestamp":"2025-04-17T05:53:34.228Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4984, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:34.228Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4984...","timestamp":"2025-04-17T05:53:34.235Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:34.235Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4984.","timestamp":"2025-04-17T05:53:34.237Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4984 status to TRANSLATING.","timestamp":"2025-04-17T05:53:34.237Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:34.242Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:34.245Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:34.245Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:34.245Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:34.245Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:53:34.245Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:34.245Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:34.247Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.247Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.247Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:34.247Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4984: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.248Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4984 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:34.248Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.252Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.252Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4984 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:34.252Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 86% (6/7)","timestamp":"2025-04-17T05:53:34.252Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 86%","timestamp":"2025-04-17T05:53:34.253Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Processing segment 6800973a55fa4eee124c4985 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T05:53:34.253Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4985...","timestamp":"2025-04-17T05:53:34.253Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4985, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fcfb8802aa2a1f99f37d25","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:34.253Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4985...","timestamp":"2025-04-17T05:53:34.261Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"当结果要求为每<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"1\">6</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:34.261Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4985.","timestamp":"2025-04-17T05:53:34.265Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4985 status to TRANSLATING.","timestamp":"2025-04-17T05:53:34.266Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:34.276Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:34.280Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:34.280Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:34.281Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fcfb8802aa2a1f99f37d25","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:34.281Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 199","timestamp":"2025-04-17T05:53:34.282Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fcfb8802aa2a1f99f37d25","timestamp":"2025-04-17T05:53:34.282Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: undefined","timestamp":"2025-04-17T05:53:34.286Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.287Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length undefined): undefined...","timestamp":"2025-04-17T05:53:34.292Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:34.292Z"}
{"error":{},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4985: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.293Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4985 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:34.294Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.304Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Error processing segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.311Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869194120: Segment 6800973a55fa4eee124c4985 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:34.311Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Updating progress: 100% (7/7)","timestamp":"2025-04-17T05:53:34.311Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869194120 progress: 100%","timestamp":"2025-04-17T05:53:34.312Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] FINISHED Segment Loop. Processed: 0, Errors: 7, Total Segments in Job: 7","timestamp":"2025-04-17T05:53:34.313Z"}
{"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] Failing job due to segment errors: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.313Z"}
{"error":{},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869194120] FAILED Catastrophically: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.313Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"6800973a55fa4eee124c497c","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fcfb8802aa2a1f99f37d25","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-6800973a55fa4eee124c497c-1744869194120","level":"error","message":"Job file-6800973a55fa4eee124c497c-1744869194120 failed. Error: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace'); Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Cannot read properties of undefined (reading 'replace')","timestamp":"2025-04-17T05:53:34.317Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:39.055Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 13543ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:39.057Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:39.065Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:39.065Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:39.069Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 13554ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:39.070Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:39.072Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:39.073Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:39.095Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:39.096Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cbf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:39.097Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 26% (11/43)","timestamp":"2025-04-17T05:53:39.097Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:39.099Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:39.099Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:39.100Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 26% (11/43)","timestamp":"2025-04-17T05:53:39.100Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 26%","timestamp":"2025-04-17T05:53:39.101Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:53:39.113Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:53:39.114Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:39.114Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 26%","timestamp":"2025-04-17T05:53:39.117Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:53:39.118Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:53:39.119Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:39.119Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:53:39.143Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:39.144Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:53:39.149Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:39.149Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc0.","timestamp":"2025-04-17T05:53:39.152Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc0 status to TRANSLATING.","timestamp":"2025-04-17T05:53:39.152Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc0.","timestamp":"2025-04-17T05:53:39.156Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc0 status to TRANSLATING.","timestamp":"2025-04-17T05:53:39.157Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:39.168Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:39.178Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:39.185Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:39.185Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:39.186Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:39.186Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 163","timestamp":"2025-04-17T05:53:39.186Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:53:39.186Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:39.192Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:39.193Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:39.193Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:39.193Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 163","timestamp":"2025-04-17T05:53:39.194Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:53:39.194Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:53:39.197Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:39.205Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:53:39.205Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:39.206Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:53:39.206Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:53:39.206Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:53:39.206Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:53:39.207Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:53:39.207Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:53:39.207Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":163,"timestamp":"2025-04-17T05:53:39.207Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:53:39.208Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:53:39.208Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:53:39.208Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:53:39.210Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:39.211Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:53:39.211Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:39.211Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:53:39.212Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:53:39.212Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:53:39.212Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:53:39.212Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:53:39.212Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:53:39.213Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":163,"timestamp":"2025-04-17T05:53:39.213Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:53:39.213Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:53:39.213Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:53:39.213Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:53:49.207Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:53:49.211Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:53:49.213Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:53:49.213Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:53:49.215Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:53:49.220Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:53:49.224Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:49.823Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10615ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:49.823Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc0: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:49.826Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:49.827Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:49.829Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10616ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:53:49.830Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc0: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:49.830Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:53:49.830Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:49.846Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:49.847Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:49.847Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 28% (12/43)","timestamp":"2025-04-17T05:53:49.847Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:49.849Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:53:49.850Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:53:49.851Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 28% (12/43)","timestamp":"2025-04-17T05:53:49.851Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 28%","timestamp":"2025-04-17T05:53:49.852Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:53:49.852Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:53:49.853Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:49.865Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 28%","timestamp":"2025-04-17T05:53:49.867Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:53:49.868Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:53:49.868Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:53:49.868Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:53:49.877Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:49.877Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:53:49.880Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:53:49.880Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc3.","timestamp":"2025-04-17T05:53:49.882Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc3 status to TRANSLATING.","timestamp":"2025-04-17T05:53:49.882Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc3.","timestamp":"2025-04-17T05:53:49.884Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc3 status to TRANSLATING.","timestamp":"2025-04-17T05:53:49.889Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:49.902Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:53:49.910Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:49.912Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:49.912Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:49.912Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:49.912Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 177","timestamp":"2025-04-17T05:53:49.913Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:53:49.913Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:53:49.914Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:53:49.914Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:53:49.914Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:53:49.915Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 177","timestamp":"2025-04-17T05:53:49.915Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:53:49.915Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:53:49.916Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:49.916Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:53:49.917Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:49.917Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:53:49.917Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:53:49.918Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:53:49.918Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:53:49.919Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:53:49.919Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:53:49.920Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":177,"timestamp":"2025-04-17T05:53:49.921Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:53:49.921Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:53:49.922Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:53:49.922Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:53:49.924Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:53:49.924Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:53:49.924Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:53:49.924Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:53:49.925Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:53:49.925Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:53:49.925Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:53:49.925Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:53:49.925Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:53:49.925Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":177,"timestamp":"2025-04-17T05:53:49.925Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:53:49.925Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:53:49.925Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:53:49.926Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:00.516Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10594ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:00.517Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc3: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:00.526Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:00.527Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:00.529Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10604ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:00.530Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc3: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:00.532Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:00.532Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:00.539Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:00.540Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:00.541Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 30% (13/43)","timestamp":"2025-04-17T05:54:00.542Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 30%","timestamp":"2025-04-17T05:54:00.543Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:00.543Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:54:00.544Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:00.544Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:00.549Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:00.561Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:00.562Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 30% (13/43)","timestamp":"2025-04-17T05:54:00.563Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 30%","timestamp":"2025-04-17T05:54:00.565Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:00.565Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:54:00.565Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:00.565Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:54:00.575Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:00.576Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc5.","timestamp":"2025-04-17T05:54:00.581Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc5 status to TRANSLATING.","timestamp":"2025-04-17T05:54:00.584Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:54:00.593Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:00.597Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:00.601Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc5.","timestamp":"2025-04-17T05:54:00.605Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc5 status to TRANSLATING.","timestamp":"2025-04-17T05:54:00.605Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:00.609Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:00.610Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:00.614Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:00.614Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 193","timestamp":"2025-04-17T05:54:00.614Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:00.614Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:00.616Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:00.619Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:00.619Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:00.619Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:00.619Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:00.620Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:00.620Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:00.620Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:00.620Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:00.620Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:54:00.620Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":193,"timestamp":"2025-04-17T05:54:00.620Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:00.620Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:00.621Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:00.621Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:00.623Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:00.623Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:00.623Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:00.624Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 193","timestamp":"2025-04-17T05:54:00.625Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:00.625Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:00.629Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:00.634Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:00.634Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:00.635Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:00.636Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:00.636Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:00.636Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:00.636Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:00.636Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:54:00.636Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":193,"timestamp":"2025-04-17T05:54:00.637Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:00.637Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:00.637Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:00.637Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:54:10.864Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:54:10.872Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:54:10.873Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:54:10.874Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:54:10.875Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:54:10.877Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:54:10.881Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:11.270Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10650ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:11.272Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc5: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:11.278Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:11.279Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:11.282Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10645ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:11.283Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc5: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:11.285Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:11.286Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:11.293Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:11.293Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:11.294Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 33% (14/43)","timestamp":"2025-04-17T05:54:11.294Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:11.296Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:11.296Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:11.296Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 33% (14/43)","timestamp":"2025-04-17T05:54:11.297Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 33%","timestamp":"2025-04-17T05:54:11.297Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:11.297Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:54:11.297Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:11.297Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 33%","timestamp":"2025-04-17T05:54:11.299Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:11.299Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:54:11.299Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:11.299Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:54:11.308Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:11.308Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc6.","timestamp":"2025-04-17T05:54:11.312Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc6 status to TRANSLATING.","timestamp":"2025-04-17T05:54:11.313Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:54:11.314Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:11.314Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:11.315Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc6.","timestamp":"2025-04-17T05:54:11.316Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc6 status to TRANSLATING.","timestamp":"2025-04-17T05:54:11.321Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:11.324Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:11.324Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:11.324Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:11.324Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 116","timestamp":"2025-04-17T05:54:11.324Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:11.324Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:11.326Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:11.326Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:11.326Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:11.326Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:11.326Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:11.326Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:11.326Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:11.327Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:11.327Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:54:11.327Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":116,"timestamp":"2025-04-17T05:54:11.327Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:11.327Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:11.327Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:11.328Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:11.334Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:11.340Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:11.340Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:11.341Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:11.341Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 116","timestamp":"2025-04-17T05:54:11.341Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:11.341Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:11.342Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:11.342Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:11.342Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:11.343Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:11.343Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:11.343Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:11.343Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:11.343Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:11.343Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:54:11.343Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":116,"timestamp":"2025-04-17T05:54:11.343Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:11.343Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:11.344Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:11.344Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:22.006Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10678ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:22.006Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc6: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:22.009Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:22.010Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:22.011Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10668ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:22.011Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc6: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:22.012Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:22.012Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:22.029Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:22.030Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:22.030Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 35% (15/43)","timestamp":"2025-04-17T05:54:22.031Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:22.033Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:22.033Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:22.034Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 35% (15/43)","timestamp":"2025-04-17T05:54:22.034Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 35%","timestamp":"2025-04-17T05:54:22.034Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:22.035Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:54:22.035Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:22.035Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 35%","timestamp":"2025-04-17T05:54:22.036Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:22.036Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:54:22.036Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:22.036Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:54:22.044Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:22.045Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:54:22.046Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:22.046Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc7.","timestamp":"2025-04-17T05:54:22.047Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc7 status to TRANSLATING.","timestamp":"2025-04-17T05:54:22.047Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc7.","timestamp":"2025-04-17T05:54:22.048Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc7 status to TRANSLATING.","timestamp":"2025-04-17T05:54:22.049Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:22.053Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:22.060Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:22.061Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:22.061Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:22.061Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:22.061Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 164","timestamp":"2025-04-17T05:54:22.061Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:22.061Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:22.062Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:22.062Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:22.062Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:22.063Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 164","timestamp":"2025-04-17T05:54:22.063Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:22.063Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:22.065Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:22.065Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:22.065Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:22.065Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:22.065Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:22.065Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:22.065Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:22.065Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:22.065Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:54:22.066Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":164,"timestamp":"2025-04-17T05:54:22.066Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:22.066Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:22.066Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:22.066Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:22.069Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:22.075Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:22.075Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:22.076Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:22.076Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:22.076Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:22.076Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:22.076Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:22.076Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:54:22.076Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":164,"timestamp":"2025-04-17T05:54:22.077Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:22.077Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:22.077Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:22.077Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:32.714Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10647ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:32.715Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:32.732Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:32.732Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:32.738Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10660ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:32.738Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:32.739Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:32.740Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:32.752Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:32.753Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:32.753Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 37% (16/43)","timestamp":"2025-04-17T05:54:32.754Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 37%","timestamp":"2025-04-17T05:54:32.755Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:32.755Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:54:32.755Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:32.755Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:32.760Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:32.761Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:32.761Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 37% (16/43)","timestamp":"2025-04-17T05:54:32.761Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 37%","timestamp":"2025-04-17T05:54:32.766Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:32.766Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:54:32.767Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:32.768Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:54:32.776Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:32.779Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc8.","timestamp":"2025-04-17T05:54:32.785Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc8 status to TRANSLATING.","timestamp":"2025-04-17T05:54:32.785Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:54:32.791Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:32.793Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:32.796Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc8.","timestamp":"2025-04-17T05:54:32.799Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc8 status to TRANSLATING.","timestamp":"2025-04-17T05:54:32.799Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:32.802Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:32.803Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:32.803Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:32.803Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:54:32.803Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:32.804Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:32.806Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:32.811Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:32.811Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:32.811Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:32.812Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:32.812Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:32.812Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:32.812Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:32.812Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:54:32.812Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:54:32.812Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:32.813Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:32.813Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:32.813Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:32.815Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:32.819Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:32.819Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:32.829Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:32.830Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:54:32.830Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:32.830Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:32.834Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:32.835Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:32.835Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:32.836Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:32.836Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:32.836Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:32.837Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:32.837Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:32.837Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:54:32.837Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:54:32.838Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:32.838Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:32.839Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:32.841Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:43.418Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10605ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:43.419Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:43.426Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:43.427Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:43.430Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10592ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:43.431Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:43.432Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:43.433Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:43.440Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:43.440Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:43.441Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 40% (17/43)","timestamp":"2025-04-17T05:54:43.441Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:43.442Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:43.442Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:43.442Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 40% (17/43)","timestamp":"2025-04-17T05:54:43.442Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 40%","timestamp":"2025-04-17T05:54:43.443Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:43.443Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:54:43.443Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:43.443Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 40%","timestamp":"2025-04-17T05:54:43.444Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:43.444Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:54:43.445Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:43.445Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:54:43.458Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:43.458Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:54:43.461Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:43.461Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc9.","timestamp":"2025-04-17T05:54:43.462Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc9 status to TRANSLATING.","timestamp":"2025-04-17T05:54:43.463Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc9.","timestamp":"2025-04-17T05:54:43.464Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc9 status to TRANSLATING.","timestamp":"2025-04-17T05:54:43.464Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:43.480Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:43.483Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:43.486Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:43.486Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:43.487Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:43.487Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:54:43.487Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:43.487Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:43.488Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:43.488Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:43.489Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:43.489Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:54:43.489Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:43.489Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:43.490Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:43.490Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:43.490Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:43.491Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:43.491Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:43.491Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:43.491Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:43.491Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:43.492Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:54:43.492Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:54:43.492Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:43.492Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:43.492Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:43.493Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:43.495Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:43.501Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:43.501Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:43.501Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:43.502Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:43.502Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:43.502Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:43.502Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:43.502Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:54:43.502Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:54:43.503Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:43.503Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:43.503Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:43.504Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T05:54:49.226Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T05:54:49.229Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T05:54:49.230Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T05:54:49.231Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T05:54:49.231Z"}
{"email":"admin@example.com","exp":1744941016,"iat":1744854616,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T05:54:49.232Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T05:54:49.238Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:54.128Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10636ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:54.129Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:54.133Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:54.134Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:54.136Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10633ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:54:54.136Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:54.136Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:54:54.136Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:54.147Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:54.148Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:54.148Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 42% (18/43)","timestamp":"2025-04-17T05:54:54.148Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:54.150Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:54:54.150Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:54:54.151Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 42% (18/43)","timestamp":"2025-04-17T05:54:54.151Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 42%","timestamp":"2025-04-17T05:54:54.151Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cca in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:54.151Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:54:54.151Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cca, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:54.151Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 42%","timestamp":"2025-04-17T05:54:54.153Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cca in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:54:54.153Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:54:54.153Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cca, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:54:54.153Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:54:54.161Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:54.164Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:54:54.165Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:54:54.166Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cca.","timestamp":"2025-04-17T05:54:54.169Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cca status to TRANSLATING.","timestamp":"2025-04-17T05:54:54.169Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cca.","timestamp":"2025-04-17T05:54:54.170Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cca status to TRANSLATING.","timestamp":"2025-04-17T05:54:54.170Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:54.173Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:54:54.174Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:54.176Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:54.187Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:54.188Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:54.188Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 211","timestamp":"2025-04-17T05:54:54.188Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:54.188Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:54:54.189Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:54:54.190Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:54:54.190Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:54:54.190Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 211","timestamp":"2025-04-17T05:54:54.190Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:54:54.190Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:54.193Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:54.193Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:54.193Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:54.194Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:54.194Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:54.194Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:54.194Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:54.194Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:54.195Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:54:54.195Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":211,"timestamp":"2025-04-17T05:54:54.195Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:54.195Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:54.196Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:54.196Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:54:54.198Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:54:54.198Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:54:54.199Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:54:54.199Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:54:54.200Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:54:54.200Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:54:54.201Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:54:54.201Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:54:54.201Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T05:54:54.201Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":211,"timestamp":"2025-04-17T05:54:54.201Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:54:54.202Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:54:54.202Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:54:54.202Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:04.847Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10652ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:04.848Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cca: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:04.854Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cca as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:04.855Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:04.859Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10658ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:04.860Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cca: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:04.861Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cca as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:04.861Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:04.872Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:04.876Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cca not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:04.877Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 44% (19/43)","timestamp":"2025-04-17T05:55:04.877Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 44%","timestamp":"2025-04-17T05:55:04.879Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:04.879Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:55:04.879Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:04.880Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:04.886Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:04.888Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cca not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:04.888Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 44% (19/43)","timestamp":"2025-04-17T05:55:04.889Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 44%","timestamp":"2025-04-17T05:55:04.895Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:04.904Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:55:04.905Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:04.905Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:55:04.919Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:04.920Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccb.","timestamp":"2025-04-17T05:55:04.926Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccb status to TRANSLATING.","timestamp":"2025-04-17T05:55:04.931Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:55:04.936Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:04.936Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccb.","timestamp":"2025-04-17T05:55:04.939Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccb status to TRANSLATING.","timestamp":"2025-04-17T05:55:04.939Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:04.945Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:04.956Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:04.956Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:04.956Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:04.957Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 173","timestamp":"2025-04-17T05:55:04.957Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:04.957Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:04.961Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:04.961Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:04.961Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:04.962Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:04.962Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:04.962Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:04.963Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:04.963Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:04.963Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:55:04.963Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":173,"timestamp":"2025-04-17T05:55:04.964Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:04.964Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:04.964Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:04.964Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:04.968Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:04.971Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:04.971Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:04.972Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:04.972Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 173","timestamp":"2025-04-17T05:55:04.972Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:04.972Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:04.976Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:04.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:04.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:04.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:04.988Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:04.988Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:04.988Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:04.988Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:04.988Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T05:55:04.989Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":173,"timestamp":"2025-04-17T05:55:04.989Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:04.989Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:04.989Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:04.989Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:15.610Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10646ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:15.614Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:15.619Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:15.620Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:15.623Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10634ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:15.624Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:15.625Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:15.625Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:15.631Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:15.632Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:15.632Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 47% (20/43)","timestamp":"2025-04-17T05:55:15.632Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:15.634Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:15.635Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:15.635Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 47% (20/43)","timestamp":"2025-04-17T05:55:15.636Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 47%","timestamp":"2025-04-17T05:55:15.636Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:15.637Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:55:15.638Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:15.638Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 47%","timestamp":"2025-04-17T05:55:15.639Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:15.646Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:55:15.646Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:15.646Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:55:15.655Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:15.656Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:55:15.661Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:15.661Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccc.","timestamp":"2025-04-17T05:55:15.663Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccc status to TRANSLATING.","timestamp":"2025-04-17T05:55:15.663Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccc.","timestamp":"2025-04-17T05:55:15.665Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccc status to TRANSLATING.","timestamp":"2025-04-17T05:55:15.665Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:15.672Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:15.679Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:15.681Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:15.682Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:15.682Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:15.682Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 124","timestamp":"2025-04-17T05:55:15.682Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:15.682Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:15.683Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:15.684Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:15.684Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:15.684Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 124","timestamp":"2025-04-17T05:55:15.684Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:15.684Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:15.685Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:15.686Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:15.686Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:15.686Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:15.686Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:15.686Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:15.687Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:15.687Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:15.687Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:55:15.687Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":124,"timestamp":"2025-04-17T05:55:15.687Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:15.687Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:15.688Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:15.688Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:15.689Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:15.689Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:15.690Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:15.690Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:15.690Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:15.690Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:15.690Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:15.690Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:15.690Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T05:55:15.690Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":124,"timestamp":"2025-04-17T05:55:15.691Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:15.691Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:15.691Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:15.691Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:26.384Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10695ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:26.385Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:26.391Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:26.392Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:26.398Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10706ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:26.399Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:26.402Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:26.403Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:26.406Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:26.407Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:26.407Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 49% (21/43)","timestamp":"2025-04-17T05:55:26.407Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:26.410Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:26.410Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:26.410Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 49% (21/43)","timestamp":"2025-04-17T05:55:26.410Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 49%","timestamp":"2025-04-17T05:55:26.411Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:26.411Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:55:26.411Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:26.411Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 49%","timestamp":"2025-04-17T05:55:26.412Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:26.419Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:55:26.419Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:26.419Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:55:26.427Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:26.428Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:55:26.438Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:26.438Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccd.","timestamp":"2025-04-17T05:55:26.441Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccd status to TRANSLATING.","timestamp":"2025-04-17T05:55:26.441Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccd.","timestamp":"2025-04-17T05:55:26.443Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccd status to TRANSLATING.","timestamp":"2025-04-17T05:55:26.443Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:26.467Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:26.469Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:26.471Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:26.471Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:26.472Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:26.472Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 149","timestamp":"2025-04-17T05:55:26.472Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:26.472Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:26.474Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:26.474Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:26.474Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:26.474Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 149","timestamp":"2025-04-17T05:55:26.474Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:26.475Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:26.477Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:26.485Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:26.485Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:26.485Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:26.485Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:26.486Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:26.486Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:26.486Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:26.486Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:55:26.486Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":149,"timestamp":"2025-04-17T05:55:26.486Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:26.487Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:26.487Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:26.487Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:26.489Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:26.489Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:26.490Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:26.490Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:26.491Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:26.491Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:26.491Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:26.492Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:26.492Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T05:55:26.492Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":149,"timestamp":"2025-04-17T05:55:26.493Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:26.493Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:26.493Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:26.493Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:37.142Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10656ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:37.142Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:37.146Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:37.147Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:37.149Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10657ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:37.149Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:37.149Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:37.149Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:37.160Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:37.164Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:37.164Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 51% (22/43)","timestamp":"2025-04-17T05:55:37.164Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:37.166Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:37.166Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:37.166Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 51% (22/43)","timestamp":"2025-04-17T05:55:37.166Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 51%","timestamp":"2025-04-17T05:55:37.166Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cce in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:37.167Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:55:37.167Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cce, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:37.167Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 51%","timestamp":"2025-04-17T05:55:37.168Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cce in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:37.168Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:55:37.168Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cce, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:37.169Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:55:37.178Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:37.178Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:55:37.181Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:37.182Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cce.","timestamp":"2025-04-17T05:55:37.182Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cce status to TRANSLATING.","timestamp":"2025-04-17T05:55:37.183Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cce.","timestamp":"2025-04-17T05:55:37.183Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cce status to TRANSLATING.","timestamp":"2025-04-17T05:55:37.184Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:37.190Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:37.194Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:37.196Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:37.196Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:37.196Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:37.197Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:55:37.197Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:37.197Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:37.198Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:37.199Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:37.199Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:37.199Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:55:37.199Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:37.200Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:37.201Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:37.201Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:37.201Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:37.201Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:37.202Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:37.202Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:37.202Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:37.202Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:37.202Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:55:37.202Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:55:37.202Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:37.202Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:37.203Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:37.203Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:37.205Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:37.212Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:37.213Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:37.213Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:37.213Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:37.213Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:37.214Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:37.214Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:37.214Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T05:55:37.215Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:55:37.215Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:37.215Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:37.215Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:37.215Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:47.850Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10648ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:47.852Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cce: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:47.857Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cce as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:47.858Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:47.860Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10645ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:47.862Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cce: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:47.862Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cce as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:47.863Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:47.869Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:47.877Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cce not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:47.877Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 53% (23/43)","timestamp":"2025-04-17T05:55:47.878Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 53%","timestamp":"2025-04-17T05:55:47.879Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:47.879Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:55:47.880Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:47.880Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:47.884Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:47.885Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cce not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:47.886Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 53% (23/43)","timestamp":"2025-04-17T05:55:47.886Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 53%","timestamp":"2025-04-17T05:55:47.890Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:47.890Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:55:47.890Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:47.890Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:55:47.901Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:47.905Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccf.","timestamp":"2025-04-17T05:55:47.911Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccf status to TRANSLATING.","timestamp":"2025-04-17T05:55:47.911Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:55:47.916Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:47.916Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccf.","timestamp":"2025-04-17T05:55:47.920Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccf status to TRANSLATING.","timestamp":"2025-04-17T05:55:47.920Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:47.928Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:47.932Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:47.936Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:47.937Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:47.937Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:47.937Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 105","timestamp":"2025-04-17T05:55:47.937Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:47.938Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:47.940Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:47.940Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:47.941Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:47.942Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 105","timestamp":"2025-04-17T05:55:47.943Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:47.948Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:47.950Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:47.951Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:47.951Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:47.951Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:47.951Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:47.951Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:47.951Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:47.952Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:47.952Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:55:47.952Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":105,"timestamp":"2025-04-17T05:55:47.952Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:47.952Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:47.953Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:47.953Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:47.957Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:47.963Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:47.964Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:47.964Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:47.964Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:47.965Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:47.965Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:47.965Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:47.965Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T05:55:47.965Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":105,"timestamp":"2025-04-17T05:55:47.965Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:47.966Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:47.966Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:47.966Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:58.642Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10689ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:58.643Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:58.648Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:58.650Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:58.653Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10688ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:55:58.654Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:58.654Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:55:58.655Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:58.665Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:58.667Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:58.667Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 56% (24/43)","timestamp":"2025-04-17T05:55:58.668Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:58.670Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:55:58.670Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:55:58.670Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 56% (24/43)","timestamp":"2025-04-17T05:55:58.670Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 56%","timestamp":"2025-04-17T05:55:58.671Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:58.671Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:55:58.672Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:58.672Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 56%","timestamp":"2025-04-17T05:55:58.674Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:55:58.674Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:55:58.674Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:55:58.674Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:55:58.683Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:58.683Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:55:58.685Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:55:58.685Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd0.","timestamp":"2025-04-17T05:55:58.687Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd0 status to TRANSLATING.","timestamp":"2025-04-17T05:55:58.694Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd0.","timestamp":"2025-04-17T05:55:58.696Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd0 status to TRANSLATING.","timestamp":"2025-04-17T05:55:58.696Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:58.706Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:55:58.711Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:58.713Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:58.713Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:58.713Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:58.713Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 255","timestamp":"2025-04-17T05:55:58.713Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:58.714Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:55:58.715Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:55:58.715Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:55:58.715Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:55:58.715Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 255","timestamp":"2025-04-17T05:55:58.715Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:55:58.715Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:58.718Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:58.718Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:58.718Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:58.718Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:58.718Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:58.719Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:58.719Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:58.719Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:58.719Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:55:58.719Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":255,"timestamp":"2025-04-17T05:55:58.719Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:58.726Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:58.727Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:58.727Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:55:58.729Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:55:58.729Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:55:58.729Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:55:58.730Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:55:58.730Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:55:58.730Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:55:58.730Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:55:58.730Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:55:58.730Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T05:55:58.730Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":255,"timestamp":"2025-04-17T05:55:58.730Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:55:58.730Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:55:58.731Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:55:58.731Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:09.381Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10662ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:09.382Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd0: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:09.388Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:56:09.388Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:09.391Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10660ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:09.391Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd0: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:09.391Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:56:09.391Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:09.398Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:09.400Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:56:09.400Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 58% (25/43)","timestamp":"2025-04-17T05:56:09.401Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:09.401Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:09.402Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:56:09.402Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 58% (25/43)","timestamp":"2025-04-17T05:56:09.402Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 58%","timestamp":"2025-04-17T05:56:09.403Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd2 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:56:09.403Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:56:09.403Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd2, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:56:09.404Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 58%","timestamp":"2025-04-17T05:56:09.405Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd2 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:56:09.405Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:56:09.405Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd2, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:56:09.405Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:56:09.414Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:56:09.422Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:56:09.424Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:56:09.425Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd2.","timestamp":"2025-04-17T05:56:09.427Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd2 status to TRANSLATING.","timestamp":"2025-04-17T05:56:09.427Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd2.","timestamp":"2025-04-17T05:56:09.430Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd2 status to TRANSLATING.","timestamp":"2025-04-17T05:56:09.430Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:56:09.445Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:56:09.448Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:56:09.449Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:56:09.450Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:56:09.450Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:56:09.450Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T05:56:09.450Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:56:09.450Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:56:09.452Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:56:09.452Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:56:09.453Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:56:09.453Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T05:56:09.453Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:56:09.453Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:56:09.455Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:56:09.455Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:56:09.455Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:56:09.456Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:56:09.456Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:56:09.456Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:56:09.456Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:56:09.456Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:56:09.456Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:56:09.457Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T05:56:09.457Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:56:09.457Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:56:09.457Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:56:09.457Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:56:09.459Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:56:09.467Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:56:09.467Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:56:09.468Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:56:09.468Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:56:09.468Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:56:09.468Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:56:09.470Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:56:09.470Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T05:56:09.470Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T05:56:09.470Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:56:09.470Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:56:09.471Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:56:09.471Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:20.124Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10666ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:20.124Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd2: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:20.127Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd2 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:56:20.127Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:20.129Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10659ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:20.130Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd2: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:20.130Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd2 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:56:20.131Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:20.167Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:20.168Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd2 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:56:20.168Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 60% (26/43)","timestamp":"2025-04-17T05:56:20.168Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:20.170Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:20.176Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd2 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:56:20.176Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 60% (26/43)","timestamp":"2025-04-17T05:56:20.176Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 60%","timestamp":"2025-04-17T05:56:20.177Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:56:20.177Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:56:20.177Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:56:20.178Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 60%","timestamp":"2025-04-17T05:56:20.180Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:56:20.180Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:56:20.181Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:56:20.181Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:56:20.191Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:56:20.192Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:56:20.194Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:56:20.195Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd3.","timestamp":"2025-04-17T05:56:20.196Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd3 status to TRANSLATING.","timestamp":"2025-04-17T05:56:20.196Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd3.","timestamp":"2025-04-17T05:56:20.198Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd3 status to TRANSLATING.","timestamp":"2025-04-17T05:56:20.198Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:56:20.203Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:56:20.209Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:56:20.211Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:56:20.211Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:56:20.212Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:56:20.212Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T05:56:20.212Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:56:20.212Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:56:20.214Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:56:20.214Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:56:20.215Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:56:20.215Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T05:56:20.215Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:56:20.215Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:56:20.216Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:56:20.216Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:56:20.216Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:56:20.216Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:56:20.216Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:56:20.217Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:56:20.217Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:56:20.217Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:56:20.217Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:56:20.217Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T05:56:20.225Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:56:20.225Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:56:20.225Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:56:20.225Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:56:20.227Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:56:20.227Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:56:20.227Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:56:20.227Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:56:20.227Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:56:20.227Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:56:20.227Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:56:20.228Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:56:20.228Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T05:56:20.228Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T05:56:20.228Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:56:20.228Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:56:20.228Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:56:20.228Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:30.840Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10615ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:30.844Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd3: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:30.845Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:56:30.846Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:30.847Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10619ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:30.848Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd3: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:30.848Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:56:30.849Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:30.851Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:30.852Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:56:30.852Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 63% (27/43)","timestamp":"2025-04-17T05:56:30.853Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:30.856Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:30.857Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:56:30.858Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 63% (27/43)","timestamp":"2025-04-17T05:56:30.859Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 63%","timestamp":"2025-04-17T05:56:30.860Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 63%","timestamp":"2025-04-17T05:56:30.861Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd4 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:56:30.861Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:56:30.862Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd4, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:56:30.862Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd4 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:56:30.864Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:56:30.865Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd4, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:56:30.865Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:56:30.883Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}sc{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:56:30.884Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:56:30.885Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}sc{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:56:30.886Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd4.","timestamp":"2025-04-17T05:56:30.889Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd4 status to TRANSLATING.","timestamp":"2025-04-17T05:56:30.889Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd4.","timestamp":"2025-04-17T05:56:30.891Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd4 status to TRANSLATING.","timestamp":"2025-04-17T05:56:30.891Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:56:30.900Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:56:30.907Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:56:30.909Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:56:30.910Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:56:30.910Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:56:30.910Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 6","timestamp":"2025-04-17T05:56:30.910Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:56:30.911Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:56:30.913Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:56:30.913Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:56:30.913Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:56:30.914Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 6","timestamp":"2025-04-17T05:56:30.914Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:56:30.922Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:56:30.925Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:56:30.925Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:56:30.925Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:56:30.926Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:56:30.926Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:56:30.927Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:56:30.927Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:56:30.927Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:56:30.927Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:56:30.928Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":6,"timestamp":"2025-04-17T05:56:30.928Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:56:30.928Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:56:30.928Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:56:30.928Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:56:30.930Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:56:30.939Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:56:30.939Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:56:30.939Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:56:30.940Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:56:30.940Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:56:30.940Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:56:30.940Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:56:30.940Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T05:56:30.940Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":6,"timestamp":"2025-04-17T05:56:30.940Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:56:30.941Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:56:30.941Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:56:30.941Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:41.554Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10626ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:41.555Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd4: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:41.557Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd4 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:56:41.557Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:41.559Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10619ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:41.559Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd4: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:41.560Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd4 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:56:41.560Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:41.568Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:41.569Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd4 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:56:41.569Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 65% (28/43)","timestamp":"2025-04-17T05:56:41.569Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:41.570Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:41.577Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd4 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:56:41.577Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 65% (28/43)","timestamp":"2025-04-17T05:56:41.577Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 65%","timestamp":"2025-04-17T05:56:41.578Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:56:41.578Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T05:56:41.578Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:56:41.578Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 65%","timestamp":"2025-04-17T05:56:41.579Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:56:41.579Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T05:56:41.579Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:56:41.579Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T05:56:41.590Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:56:41.590Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T05:56:41.591Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:56:41.591Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd7.","timestamp":"2025-04-17T05:56:41.592Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd7 status to TRANSLATING.","timestamp":"2025-04-17T05:56:41.592Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd7.","timestamp":"2025-04-17T05:56:41.594Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd7 status to TRANSLATING.","timestamp":"2025-04-17T05:56:41.594Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:56:41.596Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:56:41.598Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:56:41.599Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:56:41.599Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:56:41.599Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:56:41.599Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 60","timestamp":"2025-04-17T05:56:41.599Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:56:41.599Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:56:41.600Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:56:41.600Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:56:41.600Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:56:41.606Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 60","timestamp":"2025-04-17T05:56:41.607Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:56:41.607Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:56:41.608Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:56:41.608Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:56:41.608Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:56:41.609Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:56:41.609Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:56:41.609Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:56:41.609Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:56:41.609Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:56:41.609Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T05:56:41.609Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":60,"timestamp":"2025-04-17T05:56:41.609Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:56:41.609Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:56:41.610Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:56:41.610Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:56:41.611Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:56:41.612Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:56:41.612Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:56:41.612Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:56:41.612Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:56:41.612Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:56:41.612Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:56:41.613Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:56:41.613Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T05:56:41.614Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":60,"timestamp":"2025-04-17T05:56:41.614Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:56:41.614Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:56:41.614Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:56:41.614Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:52.239Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10630ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:52.240Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:52.246Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:56:52.246Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:52.248Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10633ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:56:52.248Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:52.248Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:56:52.248Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:52.257Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:52.258Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:56:52.259Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 67% (29/43)","timestamp":"2025-04-17T05:56:52.259Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:52.260Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:56:52.260Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:56:52.261Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 67% (29/43)","timestamp":"2025-04-17T05:56:52.261Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 67%","timestamp":"2025-04-17T05:56:52.261Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:56:52.261Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T05:56:52.261Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:56:52.262Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 67%","timestamp":"2025-04-17T05:56:52.263Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:56:52.263Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T05:56:52.263Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:56:52.263Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T05:56:52.273Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:56:52.276Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T05:56:52.279Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:56:52.279Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd8.","timestamp":"2025-04-17T05:56:52.280Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd8 status to TRANSLATING.","timestamp":"2025-04-17T05:56:52.280Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd8.","timestamp":"2025-04-17T05:56:52.282Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd8 status to TRANSLATING.","timestamp":"2025-04-17T05:56:52.282Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:56:52.285Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:56:52.287Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:56:52.287Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:56:52.287Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:56:52.287Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:56:52.288Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:56:52.288Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:56:52.290Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:56:52.290Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:56:52.290Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:56:52.291Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:56:52.291Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:56:52.291Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:56:52.291Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:56:52.291Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:56:52.291Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T05:56:52.291Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:56:52.291Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:56:52.292Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:56:52.292Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:56:52.292Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:56:52.302Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:56:52.308Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:56:52.308Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:56:52.308Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:56:52.309Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:56:52.309Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:56:52.309Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:56:52.310Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:56:52.310Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:56:52.310Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:56:52.311Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:56:52.311Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:56:52.311Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:56:52.312Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:56:52.312Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:56:52.312Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T05:56:52.312Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:56:52.313Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:56:52.313Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:56:52.313Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:56:52.313Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:02.906Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10614ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:02.907Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:02.914Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:02.914Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:02.918Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10605ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:02.919Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:02.921Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:02.921Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:02.928Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:02.929Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:02.930Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 70% (30/43)","timestamp":"2025-04-17T05:57:02.930Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 70%","timestamp":"2025-04-17T05:57:02.932Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:02.933Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T05:57:02.933Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:02.933Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:02.938Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:02.952Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:02.952Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 70% (30/43)","timestamp":"2025-04-17T05:57:02.953Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 70%","timestamp":"2025-04-17T05:57:02.956Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:02.957Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T05:57:02.957Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:02.957Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T05:57:02.989Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:02.990Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T05:57:02.995Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:02.998Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd9.","timestamp":"2025-04-17T05:57:03.017Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd9 status to TRANSLATING.","timestamp":"2025-04-17T05:57:03.017Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd9.","timestamp":"2025-04-17T05:57:03.020Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd9 status to TRANSLATING.","timestamp":"2025-04-17T05:57:03.021Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:03.033Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:03.042Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:03.048Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:03.049Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:03.050Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:03.050Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:57:03.050Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:03.051Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:03.053Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:03.053Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:03.053Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:03.054Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:57:03.054Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:03.054Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:03.058Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:03.058Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:03.059Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:03.072Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:03.072Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:03.073Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:03.073Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:03.073Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:03.073Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T05:57:03.074Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:57:03.075Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:03.075Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:03.076Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:03.076Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:03.082Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:03.083Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:03.083Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:03.083Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:03.083Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:03.084Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:03.084Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:03.084Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:03.085Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T05:57:03.085Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:57:03.085Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:03.086Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:03.086Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:03.087Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:13.755Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10679ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:13.759Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:13.765Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:13.768Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:13.779Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10690ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:13.788Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:13.793Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:13.794Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:13.810Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:13.812Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:13.814Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 72% (31/43)","timestamp":"2025-04-17T05:57:13.825Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:13.830Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:13.833Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:13.833Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 72% (31/43)","timestamp":"2025-04-17T05:57:13.836Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 72%","timestamp":"2025-04-17T05:57:13.839Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 72%","timestamp":"2025-04-17T05:57:13.840Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cda in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:13.840Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T05:57:13.844Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cda, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:13.845Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cda in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:13.847Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T05:57:13.857Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cda, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:13.857Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T05:57:13.881Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"式中:\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:13.882Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T05:57:13.887Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"式中:\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:13.888Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cda.","timestamp":"2025-04-17T05:57:13.892Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cda status to TRANSLATING.","timestamp":"2025-04-17T05:57:13.903Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cda.","timestamp":"2025-04-17T05:57:13.910Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cda status to TRANSLATING.","timestamp":"2025-04-17T05:57:13.911Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:13.926Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:13.935Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:13.939Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:13.940Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:13.940Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:13.946Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 3","timestamp":"2025-04-17T05:57:13.948Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:13.950Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:13.960Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:13.966Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:13.969Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:13.970Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:13.971Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:13.976Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:13.977Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:13.979Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:13.981Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T05:57:13.982Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":3,"timestamp":"2025-04-17T05:57:13.983Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:13.986Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n式中:\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n式中:\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:13.994Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:13.995Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:14.001Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:14.009Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:14.010Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:14.010Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 3","timestamp":"2025-04-17T05:57:14.010Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:14.011Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:14.018Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:14.025Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:14.026Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:14.027Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:14.027Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:14.027Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:14.028Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:14.028Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:14.028Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T05:57:14.028Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":3,"timestamp":"2025-04-17T05:57:14.030Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:14.031Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n式中:\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n式中:\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:14.032Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:14.032Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:24.702Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10719ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:24.703Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cda: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:24.710Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cda as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:24.713Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:24.720Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10689ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:24.727Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cda: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:24.728Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cda as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:24.728Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:24.741Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:24.743Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cda not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:24.746Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 74% (32/43)","timestamp":"2025-04-17T05:57:24.750Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:24.764Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:24.764Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cda not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:24.765Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 74% (32/43)","timestamp":"2025-04-17T05:57:24.765Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 74%","timestamp":"2025-04-17T05:57:24.768Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 74%","timestamp":"2025-04-17T05:57:24.770Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:24.771Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T05:57:24.773Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:24.775Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cdb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:24.777Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T05:57:24.779Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:24.787Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T05:57:24.821Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:24.823Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T05:57:24.829Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:24.829Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdb.","timestamp":"2025-04-17T05:57:24.833Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdb status to TRANSLATING.","timestamp":"2025-04-17T05:57:24.834Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdb.","timestamp":"2025-04-17T05:57:24.839Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdb status to TRANSLATING.","timestamp":"2025-04-17T05:57:24.839Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:24.845Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:24.854Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:24.860Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:24.860Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:24.861Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:24.861Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 53","timestamp":"2025-04-17T05:57:24.862Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:24.862Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:24.865Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:24.865Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:24.866Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:24.866Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 53","timestamp":"2025-04-17T05:57:24.867Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:24.867Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:24.869Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:24.870Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:24.870Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:24.871Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:24.871Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:24.871Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:24.872Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:24.872Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:24.872Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T05:57:24.873Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":53,"timestamp":"2025-04-17T05:57:24.874Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:24.884Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:24.884Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:24.885Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:24.888Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:24.888Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:24.889Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:24.889Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:24.890Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:24.890Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:24.891Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:24.891Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:24.894Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T05:57:24.895Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":53,"timestamp":"2025-04-17T05:57:24.896Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:24.896Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:24.897Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:24.897Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:35.570Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10695ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:35.573Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:35.579Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:35.579Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:35.586Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10690ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:35.587Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:35.589Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:35.590Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:35.600Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:35.616Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:35.617Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 77% (33/43)","timestamp":"2025-04-17T05:57:35.617Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:35.622Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:35.624Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cdb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:35.626Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 77% (33/43)","timestamp":"2025-04-17T05:57:35.627Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 77%","timestamp":"2025-04-17T05:57:35.629Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:35.631Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T05:57:35.643Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:35.643Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 77%","timestamp":"2025-04-17T05:57:35.647Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cdc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:35.648Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T05:57:35.648Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:35.648Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T05:57:35.674Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:35.676Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdc.","timestamp":"2025-04-17T05:57:35.682Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdc status to TRANSLATING.","timestamp":"2025-04-17T05:57:35.687Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T05:57:35.697Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:35.699Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdc.","timestamp":"2025-04-17T05:57:35.703Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdc status to TRANSLATING.","timestamp":"2025-04-17T05:57:35.705Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:35.711Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:35.725Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:35.726Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:35.726Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:35.726Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 68","timestamp":"2025-04-17T05:57:35.727Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:35.728Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:35.731Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:35.736Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:35.737Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:35.737Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:35.737Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:35.738Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:35.738Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:35.738Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:35.739Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:35.739Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T05:57:35.740Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":68,"timestamp":"2025-04-17T05:57:35.740Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:35.748Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:35.748Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:35.750Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:35.752Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:35.753Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:35.753Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:35.753Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 68","timestamp":"2025-04-17T05:57:35.754Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:35.754Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:35.760Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:35.760Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:35.761Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:35.761Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:35.762Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:35.763Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:35.763Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:35.763Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:35.764Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T05:57:35.764Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":68,"timestamp":"2025-04-17T05:57:35.765Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:35.765Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:35.765Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:35.766Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:46.401Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10660ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:46.405Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:46.419Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:46.420Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:46.424Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10658ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:46.424Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:46.425Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:46.425Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:46.440Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:46.441Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:46.441Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 79% (34/43)","timestamp":"2025-04-17T05:57:46.441Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:46.442Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:46.443Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cdc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:46.443Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 79% (34/43)","timestamp":"2025-04-17T05:57:46.443Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 79%","timestamp":"2025-04-17T05:57:46.445Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 79%","timestamp":"2025-04-17T05:57:46.445Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:46.446Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T05:57:46.446Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:46.446Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cdd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:46.447Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T05:57:46.448Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:46.449Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T05:57:46.473Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:46.473Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T05:57:46.481Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:46.482Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdd.","timestamp":"2025-04-17T05:57:46.487Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdd status to TRANSLATING.","timestamp":"2025-04-17T05:57:46.488Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdd.","timestamp":"2025-04-17T05:57:46.491Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdd status to TRANSLATING.","timestamp":"2025-04-17T05:57:46.493Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:46.511Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:46.515Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:46.515Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:46.516Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:46.516Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 64","timestamp":"2025-04-17T05:57:46.516Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:46.516Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:46.518Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:46.519Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:46.519Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:46.519Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:46.519Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:46.519Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:46.520Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:46.520Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:46.520Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T05:57:46.520Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":64,"timestamp":"2025-04-17T05:57:46.520Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:46.521Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:46.521Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:46.521Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:46.525Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:46.535Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:46.536Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:46.536Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:46.537Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 64","timestamp":"2025-04-17T05:57:46.537Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:46.537Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:46.542Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:46.543Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:46.543Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:46.543Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:46.544Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:46.545Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:46.545Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:46.545Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:46.546Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T05:57:46.546Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":64,"timestamp":"2025-04-17T05:57:46.546Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:46.547Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:46.547Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:46.547Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:57.159Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10638ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:57.160Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:57.168Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:57.168Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:57.175Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10628ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:57:57.177Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:57.178Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:57:57.179Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:57.198Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:57.204Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:57.206Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 81% (35/43)","timestamp":"2025-04-17T05:57:57.207Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:57.212Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:57:57.214Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cdd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:57:57.215Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 81% (35/43)","timestamp":"2025-04-17T05:57:57.217Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 81%","timestamp":"2025-04-17T05:57:57.220Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 81%","timestamp":"2025-04-17T05:57:57.238Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cde in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:57.239Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T05:57:57.239Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cde, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:57.239Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cde in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:57:57.242Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T05:57:57.243Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cde, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:57:57.245Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T05:57:57.275Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:57.277Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cde.","timestamp":"2025-04-17T05:57:57.293Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cde status to TRANSLATING.","timestamp":"2025-04-17T05:57:57.319Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T05:57:57.324Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:57:57.325Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:57.334Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:57.344Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:57.345Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:57.346Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:57.350Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 167","timestamp":"2025-04-17T05:57:57.351Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:57.351Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cde.","timestamp":"2025-04-17T05:57:57.354Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cde status to TRANSLATING.","timestamp":"2025-04-17T05:57:57.355Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:57.359Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:57.361Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:57.368Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:57.368Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:57.368Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:57.369Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:57.369Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:57.372Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:57.372Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T05:57:57.373Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":167,"timestamp":"2025-04-17T05:57:57.374Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:57.375Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:57.376Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:57.377Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:57:57.381Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:57:57.385Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:57:57.385Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:57:57.386Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:57:57.386Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 167","timestamp":"2025-04-17T05:57:57.386Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:57:57.386Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:57:57.390Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:57:57.391Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:57:57.403Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:57:57.403Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:57:57.404Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:57:57.404Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:57:57.404Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:57:57.404Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:57:57.404Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T05:57:57.404Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":167,"timestamp":"2025-04-17T05:57:57.405Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:57:57.405Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:57:57.405Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:57:57.405Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:08.023Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10650ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:08.024Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cde: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:08.032Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cde as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:58:08.033Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:08.040Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10634ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:08.044Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cde: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:08.047Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cde as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:58:08.048Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:08.063Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:08.067Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cde not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:58:08.068Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 84% (36/43)","timestamp":"2025-04-17T05:58:08.068Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 84%","timestamp":"2025-04-17T05:58:08.070Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:08.071Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T05:58:08.071Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:08.071Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:08.073Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:08.074Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cde not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:58:08.074Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 84% (36/43)","timestamp":"2025-04-17T05:58:08.074Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 84%","timestamp":"2025-04-17T05:58:08.077Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cdf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:08.078Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T05:58:08.079Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:08.079Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T05:58:08.100Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:58:08.101Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdf.","timestamp":"2025-04-17T05:58:08.107Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdf status to TRANSLATING.","timestamp":"2025-04-17T05:58:08.108Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T05:58:08.115Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:58:08.116Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:58:08.134Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdf.","timestamp":"2025-04-17T05:58:08.136Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdf status to TRANSLATING.","timestamp":"2025-04-17T05:58:08.137Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:58:08.142Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:58:08.142Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:58:08.143Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:58:08.143Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 213","timestamp":"2025-04-17T05:58:08.144Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:58:08.144Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:58:08.149Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:58:08.158Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:58:08.159Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:58:08.160Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:58:08.161Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:58:08.161Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:58:08.161Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:58:08.161Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:58:08.162Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T05:58:08.162Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":213,"timestamp":"2025-04-17T05:58:08.162Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:58:08.163Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:58:08.164Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:58:08.165Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:58:08.172Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:58:08.177Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:58:08.177Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:58:08.178Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:58:08.191Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 213","timestamp":"2025-04-17T05:58:08.192Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:58:08.192Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:58:08.194Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:58:08.194Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:58:08.195Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:58:08.196Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:58:08.196Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:58:08.197Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:58:08.197Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:58:08.198Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:58:08.198Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T05:58:08.199Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":213,"timestamp":"2025-04-17T05:58:08.200Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:58:08.200Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:58:08.200Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:58:08.200Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:18.816Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10654ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runNextTicks (node:internal/process/task_queues:69:3)\n    at processImmediate (node:internal/timers:459:9)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:18.825Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.827Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:58:18.828Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:18.840Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10640ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:18.842Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.844Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:58:18.846Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.871Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.872Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:58:18.873Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 86% (37/43)","timestamp":"2025-04-17T05:58:18.874Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 86%","timestamp":"2025-04-17T05:58:18.875Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] FINISHED Segment Loop. Processed: 0, Errors: 37, Total Segments in Job: 43","timestamp":"2025-04-17T05:58:18.875Z"}
{"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Failing job due to segment errors: 37 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.875Z"}
{"error":{},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] FAILED Catastrophically: 37 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.879Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.904Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.904Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cdf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:58:18.906Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 86% (37/43)","timestamp":"2025-04-17T05:58:18.907Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 86%","timestamp":"2025-04-17T05:58:18.909Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] FINISHED Segment Loop. Processed: 0, Errors: 37, Total Segments in Job: 43","timestamp":"2025-04-17T05:58:18.932Z"}
{"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Failing job due to segment errors: 37 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.932Z"}
{"error":{},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] FAILED Catastrophically: 37 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.935Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-68008f27082e41fa7e9c6cb2-1744868752818","level":"error","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 failed. Error: 37 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.937Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-68008f27082e41fa7e9c6cb2-1744868196091","level":"error","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 failed. Error: 37 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:18.942Z"}
{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] START Processing job. Raw Data:","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"timestamp":"2025-04-17T05:58:23.984Z","type":"file","userId":"67fcb942de30090a16d422b0"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Extracted - promptTemplateId: 67fe34abde39936502045d6c, aiConfigId: 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:58:23.996Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing Details - Type: file, Project: 6800625db601745b33861ae0, File: 68008f27082e41fa7e9c6cb2, AI Config: 67fe227be8f10dbf81036e7e, Prompt: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:58:24.004Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Determining segments to translate... Type: file","timestamp":"2025-04-17T05:58:24.005Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Fetching project 6800625db601745b33861ae0 for language info...","timestamp":"2025-04-17T05:58:24.022Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Project languages: zh-CN -> en-US","timestamp":"2025-04-17T05:58:24.031Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] File Job: Determined 37 segments to translate.","timestamp":"2025-04-17T05:58:24.049Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Determined Languages: zh-CN -> en-US","timestamp":"2025-04-17T05:58:24.050Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Starting segment processing loop for 37 segments.","timestamp":"2025-04-17T05:58:24.050Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:24.050Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T05:58:24.051Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:24.051Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T05:58:24.065Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"样品的稀释\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:58:24.066Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb5.","timestamp":"2025-04-17T05:58:24.069Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb5 status to TRANSLATING.","timestamp":"2025-04-17T05:58:24.069Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:58:24.098Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:58:24.103Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:58:24.108Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:58:24.108Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:58:24.109Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 5","timestamp":"2025-04-17T05:58:24.109Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:58:24.110Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:58:24.114Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:58:24.115Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:58:24.115Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:58:24.116Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:58:24.116Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:58:24.116Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:58:24.117Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:58:24.117Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:58:24.117Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T05:58:24.118Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":5,"timestamp":"2025-04-17T05:58:24.118Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:58:24.119Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n样品的稀释\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n样品的稀释\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:58:24.119Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:58:24.120Z","url":"https://api.x.ai/v1/chat/completions"}
{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] START Processing job. Raw Data:","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"timestamp":"2025-04-17T05:58:29.016Z","type":"file","userId":"67fcb942de30090a16d422b0"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Extracted - promptTemplateId: 67fe34abde39936502045d6c, aiConfigId: 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:58:29.018Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing Details - Type: file, Project: 6800625db601745b33861ae0, File: 68008f27082e41fa7e9c6cb2, AI Config: 67fe227be8f10dbf81036e7e, Prompt: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:58:29.024Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Determining segments to translate... Type: file","timestamp":"2025-04-17T05:58:29.024Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Fetching project 6800625db601745b33861ae0 for language info...","timestamp":"2025-04-17T05:58:29.027Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Project languages: zh-CN -> en-US","timestamp":"2025-04-17T05:58:29.035Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] File Job: Determined 36 segments to translate.","timestamp":"2025-04-17T05:58:29.052Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Determined Languages: zh-CN -> en-US","timestamp":"2025-04-17T05:58:29.053Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Starting segment processing loop for 36 segments.","timestamp":"2025-04-17T05:58:29.054Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cb6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:29.055Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T05:58:29.055Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:29.056Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T05:58:29.072Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:58:29.073Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb6.","timestamp":"2025-04-17T05:58:29.077Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb6 status to TRANSLATING.","timestamp":"2025-04-17T05:58:29.078Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:58:29.097Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:58:29.100Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:58:29.101Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:58:29.101Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:58:29.102Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 100","timestamp":"2025-04-17T05:58:29.102Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:58:29.103Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:58:29.108Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:58:29.108Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:58:29.122Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:58:29.124Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:58:29.124Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:58:29.124Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:58:29.125Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:58:29.126Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:58:29.126Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T05:58:29.128Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":100,"timestamp":"2025-04-17T05:58:29.129Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:58:29.129Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:58:29.130Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:58:29.131Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:34.797Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10679ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:34.798Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb5: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:34.804Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:58:34.805Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:34.811Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:34.812Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:58:34.822Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 2% (1/43)","timestamp":"2025-04-17T05:58:34.822Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 2%","timestamp":"2025-04-17T05:58:34.823Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:34.824Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T05:58:34.824Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:34.824Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cb6 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:58:34.827Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cb6. Status: translating","timestamp":"2025-04-17T05:58:34.830Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb6 not queued for review (Status: translating).","timestamp":"2025-04-17T05:58:34.830Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 5% (2/43)","timestamp":"2025-04-17T05:58:34.832Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 5%","timestamp":"2025-04-17T05:58:34.834Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:34.834Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T05:58:34.834Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:34.835Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T05:58:34.848Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:58:34.854Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb7.","timestamp":"2025-04-17T05:58:34.859Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb7 status to TRANSLATING.","timestamp":"2025-04-17T05:58:34.860Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:58:34.877Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:58:34.884Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:58:34.884Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:58:34.885Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:58:34.885Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 900","timestamp":"2025-04-17T05:58:34.885Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:58:34.885Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:58:34.888Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:58:34.889Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:58:34.889Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:58:34.889Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:58:34.889Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:58:34.890Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:58:34.890Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:58:34.900Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:58:34.901Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T05:58:34.901Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":900,"timestamp":"2025-04-17T05:58:34.901Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:58:34.902Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:58:34.902Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:58:34.903Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:39.352Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10222ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:39.353Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb6: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:39.359Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:58:39.359Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:39.374Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:39.375Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cb6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:58:39.376Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 2% (1/43)","timestamp":"2025-04-17T05:58:39.376Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 2%","timestamp":"2025-04-17T05:58:39.377Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cb7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:39.377Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T05:58:39.378Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:39.378Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cb7 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:58:39.382Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cb7. Status: translating","timestamp":"2025-04-17T05:58:39.390Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cb7 not queued for review (Status: translating).","timestamp":"2025-04-17T05:58:39.391Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 5% (2/43)","timestamp":"2025-04-17T05:58:39.391Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 5%","timestamp":"2025-04-17T05:58:39.392Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cb8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:39.392Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T05:58:39.392Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:39.392Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T05:58:39.405Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:58:39.405Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb8.","timestamp":"2025-04-17T05:58:39.409Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb8 status to TRANSLATING.","timestamp":"2025-04-17T05:58:39.410Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:58:39.430Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:58:39.434Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:58:39.435Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:58:39.435Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:58:39.435Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:58:39.435Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:58:39.436Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:58:39.441Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:58:39.441Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:58:39.442Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:58:39.442Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:58:39.443Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:58:39.443Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:58:39.443Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:58:39.443Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:58:39.443Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T05:58:39.457Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":51,"timestamp":"2025-04-17T05:58:39.457Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:58:39.458Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:58:39.458Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:58:39.458Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:45.416Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10515ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:45.417Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:45.422Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:58:45.422Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:45.437Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:45.438Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:58:45.439Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 7% (3/43)","timestamp":"2025-04-17T05:58:45.439Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 7%","timestamp":"2025-04-17T05:58:45.440Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:45.441Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T05:58:45.441Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:45.441Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cb8 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:58:45.445Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cb8. Status: translating","timestamp":"2025-04-17T05:58:45.445Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb8 not queued for review (Status: translating).","timestamp":"2025-04-17T05:58:45.446Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 9% (4/43)","timestamp":"2025-04-17T05:58:45.446Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 9%","timestamp":"2025-04-17T05:58:45.454Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:45.454Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T05:58:45.454Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:45.455Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T05:58:45.466Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.2液体样品：\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:58:45.466Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb9.","timestamp":"2025-04-17T05:58:45.470Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb9 status to TRANSLATING.","timestamp":"2025-04-17T05:58:45.470Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:58:45.478Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:58:45.483Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:58:45.484Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:58:45.484Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:58:45.484Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 10","timestamp":"2025-04-17T05:58:45.484Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:58:45.485Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:58:45.487Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:58:45.488Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:58:45.489Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:58:45.489Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:58:45.489Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:58:45.489Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:58:45.489Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:58:45.490Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:58:45.490Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T05:58:45.490Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":10,"timestamp":"2025-04-17T05:58:45.490Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:58:45.491Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:58:45.491Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:58:45.491Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:49.983Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10526ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:49.985Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:49.994Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:58:49.994Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:50.024Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:50.025Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cb8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:58:50.026Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 7% (3/43)","timestamp":"2025-04-17T05:58:50.026Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 7%","timestamp":"2025-04-17T05:58:50.028Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cb9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:50.029Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T05:58:50.030Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:50.031Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cb9 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:58:50.035Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cb9. Status: translating","timestamp":"2025-04-17T05:58:50.036Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cb9 not queued for review (Status: translating).","timestamp":"2025-04-17T05:58:50.036Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 9% (4/43)","timestamp":"2025-04-17T05:58:50.037Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 9%","timestamp":"2025-04-17T05:58:50.038Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cba in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:50.039Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T05:58:50.039Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cba, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:50.039Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T05:58:50.055Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:58:50.057Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cba.","timestamp":"2025-04-17T05:58:50.059Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cba status to TRANSLATING.","timestamp":"2025-04-17T05:58:50.061Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:58:50.077Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:58:50.086Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:58:50.086Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:58:50.087Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:58:50.088Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 503","timestamp":"2025-04-17T05:58:50.088Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:58:50.089Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:58:50.094Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:58:50.099Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:58:50.099Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:58:50.100Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:58:50.100Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:58:50.100Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:58:50.100Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:58:50.100Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:58:50.101Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T05:58:50.101Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":503,"timestamp":"2025-04-17T05:58:50.101Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:58:50.101Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:58:50.101Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:58:50.102Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:56.046Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10556ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:58:56.047Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:56.052Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:58:56.052Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:56.065Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:58:56.072Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:58:56.072Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 12% (5/43)","timestamp":"2025-04-17T05:58:56.072Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 12%","timestamp":"2025-04-17T05:58:56.073Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cba in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:56.074Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T05:58:56.074Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cba, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:56.074Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cba already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:58:56.077Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cba. Status: translating","timestamp":"2025-04-17T05:58:56.078Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cba not queued for review (Status: translating).","timestamp":"2025-04-17T05:58:56.078Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 14% (6/43)","timestamp":"2025-04-17T05:58:56.079Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 14%","timestamp":"2025-04-17T05:58:56.080Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:58:56.080Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T05:58:56.080Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:58:56.081Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T05:58:56.094Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:58:56.104Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbb.","timestamp":"2025-04-17T05:58:56.107Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbb status to TRANSLATING.","timestamp":"2025-04-17T05:58:56.107Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:58:56.127Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:58:56.131Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:58:56.132Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:58:56.132Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:58:56.132Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T05:58:56.132Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:58:56.133Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:58:56.137Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:58:56.137Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:58:56.138Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:58:56.138Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:58:56.138Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:58:56.139Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:58:56.139Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:58:56.139Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:58:56.139Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T05:58:56.140Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":51,"timestamp":"2025-04-17T05:58:56.149Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:58:56.149Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:58:56.150Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:58:56.150Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:00.601Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10500ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:00.609Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cba: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:00.614Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cba as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:59:00.615Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:00.628Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:00.630Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cba not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:59:00.635Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 12% (5/43)","timestamp":"2025-04-17T05:59:00.636Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 12%","timestamp":"2025-04-17T05:59:00.637Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cbb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:00.637Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T05:59:00.637Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:00.639Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cbb already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:59:00.646Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cbb. Status: translating","timestamp":"2025-04-17T05:59:00.654Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cbb not queued for review (Status: translating).","timestamp":"2025-04-17T05:59:00.654Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 14% (6/43)","timestamp":"2025-04-17T05:59:00.654Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 14%","timestamp":"2025-04-17T05:59:00.656Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cbc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:00.656Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T05:59:00.657Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:00.657Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T05:59:00.668Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:59:00.669Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbc.","timestamp":"2025-04-17T05:59:00.673Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbc status to TRANSLATING.","timestamp":"2025-04-17T05:59:00.673Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:59:00.694Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:59:00.697Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:59:00.697Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:59:00.698Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:59:00.698Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 199","timestamp":"2025-04-17T05:59:00.699Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:59:00.699Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:59:00.701Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:59:00.702Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:59:00.702Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:59:00.702Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:59:00.702Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:59:00.702Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:59:00.703Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:59:00.703Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:59:00.703Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T05:59:00.703Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":199,"timestamp":"2025-04-17T05:59:00.704Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:59:00.704Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:59:00.704Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:59:00.704Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:06.727Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10578ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:06.731Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:06.733Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:59:06.734Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:06.746Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:06.747Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:59:06.747Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 16% (7/43)","timestamp":"2025-04-17T05:59:06.747Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 16%","timestamp":"2025-04-17T05:59:06.747Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:06.748Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T05:59:06.748Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:06.748Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cbc already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:59:06.751Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cbc. Status: translating","timestamp":"2025-04-17T05:59:06.751Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbc not queued for review (Status: translating).","timestamp":"2025-04-17T05:59:06.751Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 19% (8/43)","timestamp":"2025-04-17T05:59:06.752Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 19%","timestamp":"2025-04-17T05:59:06.752Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:06.752Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:59:06.752Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:06.753Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:59:06.766Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:59:06.768Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbd.","timestamp":"2025-04-17T05:59:06.771Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbd status to TRANSLATING.","timestamp":"2025-04-17T05:59:06.773Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:59:06.791Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:59:06.798Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:59:06.799Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:59:06.799Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:59:06.799Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 314","timestamp":"2025-04-17T05:59:06.800Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:59:06.801Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:59:06.803Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:59:06.803Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:59:06.804Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:59:06.804Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:59:06.804Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:59:06.804Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:59:06.805Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:59:06.805Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:59:06.805Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:59:06.805Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":314,"timestamp":"2025-04-17T05:59:06.805Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:59:06.806Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:59:06.806Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:59:06.807Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:11.322Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10619ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:11.323Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:11.329Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:59:11.329Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:11.343Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:11.346Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cbc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:59:11.346Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 16% (7/43)","timestamp":"2025-04-17T05:59:11.346Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 16%","timestamp":"2025-04-17T05:59:11.347Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cbd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:11.348Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T05:59:11.348Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:11.349Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cbd already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:59:11.352Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cbd. Status: translating","timestamp":"2025-04-17T05:59:11.352Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cbd not queued for review (Status: translating).","timestamp":"2025-04-17T05:59:11.353Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 19% (8/43)","timestamp":"2025-04-17T05:59:11.353Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 19%","timestamp":"2025-04-17T05:59:11.363Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cbe in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:11.363Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:59:11.363Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbe, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:11.364Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:59:11.377Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:59:11.378Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbe.","timestamp":"2025-04-17T05:59:11.381Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbe status to TRANSLATING.","timestamp":"2025-04-17T05:59:11.381Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:59:11.387Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:59:11.393Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:59:11.394Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:59:11.394Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:59:11.395Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 71","timestamp":"2025-04-17T05:59:11.395Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:59:11.396Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:59:11.399Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:59:11.400Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:59:11.400Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:59:11.401Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:59:11.401Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:59:11.409Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:59:11.410Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:59:11.410Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:59:11.410Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:59:11.410Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":71,"timestamp":"2025-04-17T05:59:11.411Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:59:11.411Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:59:11.411Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:59:11.412Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:17.378Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10573ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:17.380Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:17.387Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:59:17.387Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:17.417Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:17.419Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:59:17.420Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 21% (9/43)","timestamp":"2025-04-17T05:59:17.421Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 21%","timestamp":"2025-04-17T05:59:17.422Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbe in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:17.423Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T05:59:17.423Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbe, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:17.424Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cbe already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:59:17.428Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cbe. Status: translating","timestamp":"2025-04-17T05:59:17.429Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbe not queued for review (Status: translating).","timestamp":"2025-04-17T05:59:17.429Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 23% (10/43)","timestamp":"2025-04-17T05:59:17.430Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 23%","timestamp":"2025-04-17T05:59:17.430Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:17.431Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:59:17.431Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:17.431Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:59:17.445Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:59:17.447Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbf.","timestamp":"2025-04-17T05:59:17.451Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbf status to TRANSLATING.","timestamp":"2025-04-17T05:59:17.451Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:59:17.470Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:59:17.476Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:59:17.476Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:59:17.476Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:59:17.476Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 110","timestamp":"2025-04-17T05:59:17.476Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:59:17.477Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:59:17.479Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:59:17.480Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:59:17.480Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:59:17.481Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:59:17.482Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:59:17.482Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:59:17.482Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:59:17.482Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:59:17.482Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:59:17.483Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":110,"timestamp":"2025-04-17T05:59:17.483Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:59:17.483Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:59:17.483Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:59:17.484Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:21.937Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10525ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:21.937Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbe: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:21.944Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbe as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:59:21.945Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:21.959Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:21.964Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cbe not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:59:21.965Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 21% (9/43)","timestamp":"2025-04-17T05:59:21.966Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 21%","timestamp":"2025-04-17T05:59:21.969Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cbf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:21.969Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T05:59:21.970Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:21.971Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cbf already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:59:21.975Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cbf. Status: translating","timestamp":"2025-04-17T05:59:21.976Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cbf not queued for review (Status: translating).","timestamp":"2025-04-17T05:59:21.976Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 23% (10/43)","timestamp":"2025-04-17T05:59:21.976Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 23%","timestamp":"2025-04-17T05:59:21.977Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:21.977Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:59:21.977Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:21.977Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:59:21.986Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:59:21.990Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc0.","timestamp":"2025-04-17T05:59:21.993Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc0 status to TRANSLATING.","timestamp":"2025-04-17T05:59:21.994Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:59:22.015Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:59:22.024Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:59:22.025Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:59:22.026Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:59:22.027Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 163","timestamp":"2025-04-17T05:59:22.027Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:59:22.028Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:59:22.032Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:59:22.032Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:59:22.033Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:59:22.033Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:59:22.034Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:59:22.034Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:59:22.034Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:59:22.034Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:59:22.035Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:59:22.035Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":163,"timestamp":"2025-04-17T05:59:22.035Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:59:22.035Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:59:22.036Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:59:22.036Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:28.036Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10553ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:28.037Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:28.047Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:59:28.049Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:28.069Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:28.075Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:59:28.076Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 26% (11/43)","timestamp":"2025-04-17T05:59:28.076Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 26%","timestamp":"2025-04-17T05:59:28.078Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:28.080Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T05:59:28.081Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:28.085Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cc0 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:59:28.091Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cc0. Status: translating","timestamp":"2025-04-17T05:59:28.092Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc0 not queued for review (Status: translating).","timestamp":"2025-04-17T05:59:28.092Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 28% (12/43)","timestamp":"2025-04-17T05:59:28.093Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 28%","timestamp":"2025-04-17T05:59:28.094Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:28.096Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:59:28.097Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:28.098Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:59:28.120Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:59:28.121Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc3.","timestamp":"2025-04-17T05:59:28.125Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc3 status to TRANSLATING.","timestamp":"2025-04-17T05:59:28.126Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:59:28.149Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:59:28.155Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:59:28.156Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:59:28.157Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:59:28.160Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 177","timestamp":"2025-04-17T05:59:28.160Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:59:28.161Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:59:28.163Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:59:28.163Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:59:28.163Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:59:28.163Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:59:28.163Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:59:28.163Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:59:28.163Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:59:28.164Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:59:28.164Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:59:28.164Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":177,"timestamp":"2025-04-17T05:59:28.164Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:59:28.164Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:59:28.165Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:59:28.165Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:32.586Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10551ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:32.586Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc0: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:32.589Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:59:32.591Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:32.607Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:32.614Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:59:32.614Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 26% (11/43)","timestamp":"2025-04-17T05:59:32.617Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 26%","timestamp":"2025-04-17T05:59:32.626Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:32.628Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T05:59:32.630Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:32.631Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cc3 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:59:32.637Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cc3. Status: translating","timestamp":"2025-04-17T05:59:32.641Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc3 not queued for review (Status: translating).","timestamp":"2025-04-17T05:59:32.641Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 28% (12/43)","timestamp":"2025-04-17T05:59:32.642Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 28%","timestamp":"2025-04-17T05:59:32.642Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:32.643Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:59:32.643Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:32.643Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:59:32.659Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:59:32.659Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc5.","timestamp":"2025-04-17T05:59:32.663Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc5 status to TRANSLATING.","timestamp":"2025-04-17T05:59:32.664Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:59:32.683Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:59:32.686Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:59:32.687Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:59:32.687Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:59:32.688Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 193","timestamp":"2025-04-17T05:59:32.689Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:59:32.689Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:59:32.692Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:59:32.693Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:59:32.693Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:59:32.693Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:59:32.693Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:59:32.694Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:59:32.694Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:59:32.694Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:59:32.694Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:59:32.695Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":193,"timestamp":"2025-04-17T05:59:32.695Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:59:32.706Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:59:32.707Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:59:32.707Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:38.675Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10510ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:38.675Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc3: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:38.678Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:59:38.679Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:38.698Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:38.699Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:59:38.699Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 30% (13/43)","timestamp":"2025-04-17T05:59:38.699Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 30%","timestamp":"2025-04-17T05:59:38.700Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:38.702Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T05:59:38.702Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:38.702Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cc5 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:59:38.706Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cc5. Status: translating","timestamp":"2025-04-17T05:59:38.706Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc5 not queued for review (Status: translating).","timestamp":"2025-04-17T05:59:38.707Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 33% (14/43)","timestamp":"2025-04-17T05:59:38.707Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 33%","timestamp":"2025-04-17T05:59:38.708Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:38.709Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:59:38.709Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:38.709Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:59:38.722Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:59:38.731Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc6.","timestamp":"2025-04-17T05:59:38.735Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc6 status to TRANSLATING.","timestamp":"2025-04-17T05:59:38.736Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:59:38.747Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:59:38.751Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:59:38.757Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:59:38.758Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:59:38.759Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 116","timestamp":"2025-04-17T05:59:38.759Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:59:38.760Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:59:38.764Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:59:38.764Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:59:38.765Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:59:38.765Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:59:38.765Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:59:38.766Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:59:38.774Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:59:38.774Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:59:38.774Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:59:38.774Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":116,"timestamp":"2025-04-17T05:59:38.775Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:59:38.775Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:59:38.775Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:59:38.776Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:43.235Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10539ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:43.235Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc5: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:43.243Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:59:43.243Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:43.276Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:43.277Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:59:43.277Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 30% (13/43)","timestamp":"2025-04-17T05:59:43.278Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 30%","timestamp":"2025-04-17T05:59:43.282Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:43.282Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T05:59:43.283Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:43.283Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cc6 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:59:43.287Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cc6. Status: translating","timestamp":"2025-04-17T05:59:43.287Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc6 not queued for review (Status: translating).","timestamp":"2025-04-17T05:59:43.287Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 33% (14/43)","timestamp":"2025-04-17T05:59:43.288Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 33%","timestamp":"2025-04-17T05:59:43.288Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:43.289Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:59:43.289Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:43.289Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:59:43.305Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:59:43.306Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc7.","timestamp":"2025-04-17T05:59:43.311Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc7 status to TRANSLATING.","timestamp":"2025-04-17T05:59:43.311Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:59:43.317Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:59:43.319Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:59:43.324Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:59:43.324Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:59:43.324Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 164","timestamp":"2025-04-17T05:59:43.324Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:59:43.325Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:59:43.330Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:59:43.332Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:59:43.332Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:59:43.333Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:59:43.333Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:59:43.333Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:59:43.333Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:59:43.333Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:59:43.333Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:59:43.334Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":164,"timestamp":"2025-04-17T05:59:43.334Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:59:43.334Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:59:43.334Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:59:43.334Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:49.309Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10534ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:49.310Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc6: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:49.317Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:59:49.317Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:49.328Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:49.336Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:59:49.336Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 35% (15/43)","timestamp":"2025-04-17T05:59:49.336Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 35%","timestamp":"2025-04-17T05:59:49.337Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:49.338Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T05:59:49.338Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:49.338Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cc7 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:59:49.345Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cc7. Status: translating","timestamp":"2025-04-17T05:59:49.346Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc7 not queued for review (Status: translating).","timestamp":"2025-04-17T05:59:49.346Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 37% (16/43)","timestamp":"2025-04-17T05:59:49.346Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 37%","timestamp":"2025-04-17T05:59:49.348Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:49.348Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:59:49.349Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:49.350Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:59:49.366Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:59:49.366Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc8.","timestamp":"2025-04-17T05:59:49.370Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc8 status to TRANSLATING.","timestamp":"2025-04-17T05:59:49.371Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:59:49.392Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:59:49.400Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:59:49.401Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:59:49.403Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:59:49.404Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T05:59:49.404Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:59:49.404Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:59:49.408Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:59:49.408Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:59:49.410Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:59:49.410Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:59:49.412Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:59:49.413Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:59:49.414Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:59:49.416Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:59:49.416Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:59:49.417Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T05:59:49.418Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:59:49.418Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:59:49.419Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:59:49.419Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:53.889Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10555ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:53.890Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:53.896Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T05:59:53.897Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:53.915Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T05:59:53.916Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T05:59:53.917Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 35% (15/43)","timestamp":"2025-04-17T05:59:53.917Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 35%","timestamp":"2025-04-17T05:59:53.919Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:53.919Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T05:59:53.920Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:53.921Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cc8 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T05:59:53.925Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cc8. Status: translating","timestamp":"2025-04-17T05:59:53.926Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc8 not queued for review (Status: translating).","timestamp":"2025-04-17T05:59:53.926Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 37% (16/43)","timestamp":"2025-04-17T05:59:53.927Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 37%","timestamp":"2025-04-17T05:59:53.928Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cc9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T05:59:53.928Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:59:53.928Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T05:59:53.928Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:59:53.942Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T05:59:53.945Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc9.","timestamp":"2025-04-17T05:59:53.949Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc9 status to TRANSLATING.","timestamp":"2025-04-17T05:59:53.950Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T05:59:53.968Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T05:59:53.973Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T05:59:53.973Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T05:59:53.973Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T05:59:53.973Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T05:59:53.974Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T05:59:53.974Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T05:59:53.978Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T05:59:53.978Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T05:59:53.978Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T05:59:53.979Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T05:59:53.979Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T05:59:53.980Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T05:59:53.980Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T05:59:53.981Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T05:59:53.981Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T05:59:53.995Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T05:59:53.996Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T05:59:53.997Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T05:59:53.999Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T05:59:54.000Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:59.994Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10575ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T05:59:59.997Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:00.001Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:00.004Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:00.032Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:00.033Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:00.033Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 40% (17/43)","timestamp":"2025-04-17T06:00:00.034Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 40%","timestamp":"2025-04-17T06:00:00.035Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:00.036Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T06:00:00.037Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:00.037Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cc9 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:00.041Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cc9. Status: translating","timestamp":"2025-04-17T06:00:00.045Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc9 not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:00.046Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 42% (18/43)","timestamp":"2025-04-17T06:00:00.046Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 42%","timestamp":"2025-04-17T06:00:00.048Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cca in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:00.048Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T06:00:00.048Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cca, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:00.049Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T06:00:00.061Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:00.062Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cca.","timestamp":"2025-04-17T06:00:00.065Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cca status to TRANSLATING.","timestamp":"2025-04-17T06:00:00.066Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:00.074Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:00.080Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:00.081Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:00.081Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:00.082Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 211","timestamp":"2025-04-17T06:00:00.082Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:00.082Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:00.086Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:00.086Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:00.086Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:00.086Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:00.087Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:00.095Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:00.095Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:00.095Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:00.095Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T06:00:00.096Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":211,"timestamp":"2025-04-17T06:00:00.096Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:00.096Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:00.096Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:00.097Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:04.587Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10588ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:04.590Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:04.594Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:04.594Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:04.616Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:04.620Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cc9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:04.621Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 40% (17/43)","timestamp":"2025-04-17T06:00:04.622Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 40%","timestamp":"2025-04-17T06:00:04.623Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cca in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:04.623Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T06:00:04.623Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cca, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:04.623Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cca already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:04.628Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cca. Status: translating","timestamp":"2025-04-17T06:00:04.629Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cca not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:04.629Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 42% (18/43)","timestamp":"2025-04-17T06:00:04.629Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 42%","timestamp":"2025-04-17T06:00:04.631Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:04.632Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T06:00:04.633Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:04.633Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T06:00:04.645Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:04.654Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccb.","timestamp":"2025-04-17T06:00:04.658Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccb status to TRANSLATING.","timestamp":"2025-04-17T06:00:04.658Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:04.676Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:04.684Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:04.684Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:04.685Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:04.685Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 173","timestamp":"2025-04-17T06:00:04.686Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:04.686Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:04.689Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:04.689Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:04.702Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:04.703Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:04.703Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:04.704Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:04.704Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:04.705Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:04.705Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T06:00:04.705Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":173,"timestamp":"2025-04-17T06:00:04.706Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:04.706Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:04.706Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:04.707Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:10.697Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10601ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:10.703Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cca: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:10.712Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cca as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:10.713Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:10.728Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:10.736Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cca not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:10.737Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 44% (19/43)","timestamp":"2025-04-17T06:00:10.738Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 44%","timestamp":"2025-04-17T06:00:10.739Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:10.741Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T06:00:10.742Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:10.743Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6ccb already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:10.754Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6ccb. Status: translating","timestamp":"2025-04-17T06:00:10.758Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccb not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:10.773Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 47% (20/43)","timestamp":"2025-04-17T06:00:10.773Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 47%","timestamp":"2025-04-17T06:00:10.776Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:10.777Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T06:00:10.778Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:10.780Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T06:00:10.798Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:10.799Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccc.","timestamp":"2025-04-17T06:00:10.803Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccc status to TRANSLATING.","timestamp":"2025-04-17T06:00:10.803Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:10.811Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:10.823Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:10.825Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:10.826Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:10.826Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 124","timestamp":"2025-04-17T06:00:10.828Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:10.829Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:10.835Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:10.836Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:10.845Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:10.847Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:10.848Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:10.849Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:10.852Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:10.853Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:10.855Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T06:00:10.856Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":124,"timestamp":"2025-04-17T06:00:10.857Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:10.858Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:10.859Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:10.859Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:15.278Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10571ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:15.279Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:15.289Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:15.291Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:15.313Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:15.317Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:15.318Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 44% (19/43)","timestamp":"2025-04-17T06:00:15.318Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 44%","timestamp":"2025-04-17T06:00:15.320Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:15.321Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T06:00:15.321Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:15.324Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6ccc already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:15.331Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6ccc. Status: translating","timestamp":"2025-04-17T06:00:15.332Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccc not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:15.332Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 47% (20/43)","timestamp":"2025-04-17T06:00:15.333Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 47%","timestamp":"2025-04-17T06:00:15.334Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:15.334Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T06:00:15.334Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:15.335Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T06:00:15.351Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:15.351Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccd.","timestamp":"2025-04-17T06:00:15.355Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccd status to TRANSLATING.","timestamp":"2025-04-17T06:00:15.355Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:15.360Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:15.363Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:15.363Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:15.364Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:15.364Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 149","timestamp":"2025-04-17T06:00:15.364Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:15.365Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:15.368Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:15.369Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:15.380Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:15.381Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:15.381Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:15.381Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:15.382Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:15.382Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:15.382Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T06:00:15.382Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":149,"timestamp":"2025-04-17T06:00:15.383Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:15.383Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:15.383Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:15.384Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:21.394Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10536ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:21.399Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:21.402Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:21.402Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:21.417Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:21.420Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:21.429Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 49% (21/43)","timestamp":"2025-04-17T06:00:21.430Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 49%","timestamp":"2025-04-17T06:00:21.431Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:21.431Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T06:00:21.431Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:21.431Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6ccd already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:21.439Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6ccd. Status: translating","timestamp":"2025-04-17T06:00:21.441Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccd not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:21.441Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 51% (22/43)","timestamp":"2025-04-17T06:00:21.441Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 51%","timestamp":"2025-04-17T06:00:21.443Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cce in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:21.443Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T06:00:21.444Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cce, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:21.445Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T06:00:21.461Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:21.466Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cce.","timestamp":"2025-04-17T06:00:21.470Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cce status to TRANSLATING.","timestamp":"2025-04-17T06:00:21.470Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:21.488Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:21.497Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:21.498Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:21.501Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:21.503Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T06:00:21.505Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:21.505Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:21.509Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:21.510Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:21.511Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:21.511Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:21.513Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:21.513Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:21.513Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:21.513Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:21.514Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T06:00:21.520Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T06:00:21.526Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:21.527Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:21.527Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:21.527Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:25.945Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10561ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:25.950Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:25.951Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:25.951Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:25.967Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:25.968Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:25.968Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 49% (21/43)","timestamp":"2025-04-17T06:00:25.968Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 49%","timestamp":"2025-04-17T06:00:25.969Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cce in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:25.969Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T06:00:25.970Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cce, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:25.970Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cce already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:25.972Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cce. Status: translating","timestamp":"2025-04-17T06:00:25.973Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cce not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:25.973Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 51% (22/43)","timestamp":"2025-04-17T06:00:25.984Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 51%","timestamp":"2025-04-17T06:00:25.986Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6ccf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:25.987Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T06:00:25.987Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:25.989Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T06:00:26.004Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:26.011Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccf.","timestamp":"2025-04-17T06:00:26.014Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccf status to TRANSLATING.","timestamp":"2025-04-17T06:00:26.014Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:26.019Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:26.023Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:26.024Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:26.024Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:26.025Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 105","timestamp":"2025-04-17T06:00:26.025Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:26.025Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:26.028Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:26.028Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:26.029Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:26.029Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:26.029Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:26.029Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:26.030Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:26.030Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:26.030Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T06:00:26.030Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":105,"timestamp":"2025-04-17T06:00:26.030Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:26.031Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:26.031Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:26.031Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:32.012Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10485ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:32.016Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cce: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:32.020Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cce as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:32.020Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:32.035Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:32.036Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cce not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:32.036Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 53% (23/43)","timestamp":"2025-04-17T06:00:32.036Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 53%","timestamp":"2025-04-17T06:00:32.038Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:32.038Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T06:00:32.039Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:32.039Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6ccf already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:32.042Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6ccf. Status: translating","timestamp":"2025-04-17T06:00:32.043Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccf not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:32.056Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 56% (24/43)","timestamp":"2025-04-17T06:00:32.056Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 56%","timestamp":"2025-04-17T06:00:32.057Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:32.058Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T06:00:32.058Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:32.059Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T06:00:32.073Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:32.074Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd0.","timestamp":"2025-04-17T06:00:32.081Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd0 status to TRANSLATING.","timestamp":"2025-04-17T06:00:32.082Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:32.092Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:32.102Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:32.102Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:32.102Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:32.103Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 255","timestamp":"2025-04-17T06:00:32.103Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:32.103Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:32.107Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:32.107Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:32.108Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:32.109Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:32.109Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:32.109Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:32.109Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:32.110Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:32.110Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T06:00:32.110Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":255,"timestamp":"2025-04-17T06:00:32.111Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:32.111Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:32.111Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:32.111Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:36.572Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10542ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:36.575Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:36.578Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:36.579Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:36.592Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:36.600Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6ccf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:36.600Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 53% (23/43)","timestamp":"2025-04-17T06:00:36.603Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 53%","timestamp":"2025-04-17T06:00:36.605Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:36.608Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T06:00:36.608Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:36.608Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd0 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:36.613Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cd0. Status: translating","timestamp":"2025-04-17T06:00:36.614Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd0 not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:36.615Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 56% (24/43)","timestamp":"2025-04-17T06:00:36.616Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 56%","timestamp":"2025-04-17T06:00:36.618Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd2 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:36.619Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T06:00:36.628Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd2, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:36.628Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T06:00:36.644Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:36.645Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd2.","timestamp":"2025-04-17T06:00:36.649Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd2 status to TRANSLATING.","timestamp":"2025-04-17T06:00:36.649Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:36.669Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:36.680Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:36.680Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:36.681Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:36.681Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T06:00:36.681Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:36.681Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:36.684Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:36.685Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:36.685Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:36.686Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:36.686Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:36.686Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:36.686Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:36.687Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:36.687Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T06:00:36.687Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T06:00:36.687Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:36.687Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:36.688Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:36.688Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:42.641Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10529ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:42.651Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd0: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:42.657Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:42.660Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:42.670Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:42.675Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:42.676Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 58% (25/43)","timestamp":"2025-04-17T06:00:42.676Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 58%","timestamp":"2025-04-17T06:00:42.677Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd2 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:42.677Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T06:00:42.677Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd2, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:42.677Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd2 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:42.688Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cd2. Status: translating","timestamp":"2025-04-17T06:00:42.692Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd2 not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:42.693Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 60% (26/43)","timestamp":"2025-04-17T06:00:42.693Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 60%","timestamp":"2025-04-17T06:00:42.694Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:42.694Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T06:00:42.694Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:42.694Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T06:00:42.706Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:42.707Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd3.","timestamp":"2025-04-17T06:00:42.710Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd3 status to TRANSLATING.","timestamp":"2025-04-17T06:00:42.710Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:42.717Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:42.723Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:42.723Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:42.724Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:42.724Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T06:00:42.724Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:42.725Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:42.728Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:42.729Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:42.730Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:42.732Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:42.734Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:42.735Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:42.736Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:42.736Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:42.736Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T06:00:42.736Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T06:00:42.736Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:42.737Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:42.737Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:42.739Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:47.201Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10514ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:47.204Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd2: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:47.211Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd2 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:47.212Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:47.228Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:47.238Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd2 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:47.238Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 58% (25/43)","timestamp":"2025-04-17T06:00:47.238Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 58%","timestamp":"2025-04-17T06:00:47.239Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:47.240Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T06:00:47.240Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:47.242Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd3 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:47.247Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cd3. Status: translating","timestamp":"2025-04-17T06:00:47.248Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd3 not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:47.250Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 60% (26/43)","timestamp":"2025-04-17T06:00:47.252Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 60%","timestamp":"2025-04-17T06:00:47.254Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd4 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:47.256Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T06:00:47.257Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd4, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:47.258Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T06:00:47.273Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}sc{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:47.274Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd4.","timestamp":"2025-04-17T06:00:47.277Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd4 status to TRANSLATING.","timestamp":"2025-04-17T06:00:47.277Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:47.292Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:47.300Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:47.301Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:47.301Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:47.302Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 6","timestamp":"2025-04-17T06:00:47.302Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:47.303Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:47.308Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:47.314Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:47.315Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:47.316Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:47.317Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:47.317Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:47.317Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:47.318Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:47.318Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T06:00:47.319Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":6,"timestamp":"2025-04-17T06:00:47.319Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:47.319Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:47.319Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:47.319Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:53.297Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10561ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:53.300Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd3: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:53.305Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:53.306Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:53.320Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:53.320Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:53.321Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 63% (27/43)","timestamp":"2025-04-17T06:00:53.322Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 63%","timestamp":"2025-04-17T06:00:53.323Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd4 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:53.323Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T06:00:53.324Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd4, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:53.324Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd4 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:53.329Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cd4. Status: translating","timestamp":"2025-04-17T06:00:53.340Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd4 not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:53.340Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 65% (28/43)","timestamp":"2025-04-17T06:00:53.340Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 65%","timestamp":"2025-04-17T06:00:53.342Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:53.343Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T06:00:53.343Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:53.344Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T06:00:53.359Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:53.360Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd7.","timestamp":"2025-04-17T06:00:53.376Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd7 status to TRANSLATING.","timestamp":"2025-04-17T06:00:53.377Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:53.383Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:53.386Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:53.387Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:53.387Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:53.387Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 60","timestamp":"2025-04-17T06:00:53.387Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:53.388Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:53.391Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:53.403Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:53.403Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:53.403Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:53.403Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:53.404Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:53.404Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:53.404Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:53.404Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T06:00:53.405Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":60,"timestamp":"2025-04-17T06:00:53.405Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:53.406Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:53.408Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:53.409Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:57.835Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10515ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:00:57.837Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd4: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:57.847Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd4 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:00:57.849Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:57.872Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:00:57.873Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd4 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:00:57.874Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 63% (27/43)","timestamp":"2025-04-17T06:00:57.875Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 63%","timestamp":"2025-04-17T06:00:57.875Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:57.876Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T06:00:57.876Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:57.876Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd7 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:00:57.880Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cd7. Status: translating","timestamp":"2025-04-17T06:00:57.881Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd7 not queued for review (Status: translating).","timestamp":"2025-04-17T06:00:57.881Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 65% (28/43)","timestamp":"2025-04-17T06:00:57.881Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 65%","timestamp":"2025-04-17T06:00:57.882Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:00:57.882Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T06:00:57.883Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:00:57.883Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T06:00:57.897Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:00:57.904Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd8.","timestamp":"2025-04-17T06:00:57.907Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd8 status to TRANSLATING.","timestamp":"2025-04-17T06:00:57.908Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:00:57.927Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:00:57.932Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:00:57.933Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:00:57.933Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:00:57.933Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T06:00:57.933Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:00:57.934Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:00:57.937Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:00:57.937Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:00:57.938Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:00:57.938Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:00:57.939Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:00:57.939Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:00:57.940Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:00:57.940Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:00:57.940Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T06:00:57.949Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T06:00:57.950Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:00:57.950Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:00:57.950Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:00:57.951Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:03.892Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10487ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:03.892Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:03.897Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:01:03.898Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:03.909Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:03.915Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:01:03.916Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 67% (29/43)","timestamp":"2025-04-17T06:01:03.917Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 67%","timestamp":"2025-04-17T06:01:03.918Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:03.918Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T06:01:03.918Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:03.918Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd8 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:01:03.921Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cd8. Status: translating","timestamp":"2025-04-17T06:01:03.922Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd8 not queued for review (Status: translating).","timestamp":"2025-04-17T06:01:03.922Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 70% (30/43)","timestamp":"2025-04-17T06:01:03.923Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 70%","timestamp":"2025-04-17T06:01:03.924Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:03.924Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T06:01:03.925Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:03.925Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T06:01:03.936Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:01:03.937Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd9.","timestamp":"2025-04-17T06:01:03.951Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd9 status to TRANSLATING.","timestamp":"2025-04-17T06:01:03.951Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:01:03.972Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:01:03.978Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:01:03.979Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:01:03.980Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:01:03.980Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T06:01:03.980Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:01:03.981Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:01:03.989Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:01:03.991Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:01:03.992Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:01:03.992Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:01:03.993Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:01:03.993Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:01:03.993Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:01:03.993Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:01:03.993Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T06:01:03.993Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T06:01:03.993Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:01:03.994Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:01:03.994Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:01:03.994Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:08.475Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10525ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:08.477Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:08.486Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:01:08.487Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:08.496Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:08.497Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:01:08.497Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 67% (29/43)","timestamp":"2025-04-17T06:01:08.497Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 67%","timestamp":"2025-04-17T06:01:08.499Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cd9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:08.499Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T06:01:08.500Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:08.500Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cd9 already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:01:08.502Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cd9. Status: translating","timestamp":"2025-04-17T06:01:08.502Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cd9 not queued for review (Status: translating).","timestamp":"2025-04-17T06:01:08.503Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 70% (30/43)","timestamp":"2025-04-17T06:01:08.503Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 70%","timestamp":"2025-04-17T06:01:08.503Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cda in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:08.503Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T06:01:08.503Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cda, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:08.504Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T06:01:08.520Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"式中:\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:01:08.521Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cda.","timestamp":"2025-04-17T06:01:08.523Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cda status to TRANSLATING.","timestamp":"2025-04-17T06:01:08.524Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:01:08.537Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:01:08.549Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:01:08.550Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:01:08.551Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:01:08.551Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 3","timestamp":"2025-04-17T06:01:08.551Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:01:08.552Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:01:08.555Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:01:08.555Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:01:08.555Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:01:08.555Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:01:08.555Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:01:08.556Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:01:08.556Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:01:08.556Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:01:08.556Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T06:01:08.557Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":3,"timestamp":"2025-04-17T06:01:08.557Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:01:08.557Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n式中:\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n式中:\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:01:08.557Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:01:08.558Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:14.560Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10566ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:14.563Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:14.566Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:01:14.567Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:14.584Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:14.585Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:01:14.585Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 72% (31/43)","timestamp":"2025-04-17T06:01:14.585Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 72%","timestamp":"2025-04-17T06:01:14.588Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cda in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:14.589Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T06:01:14.590Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cda, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:14.600Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cda already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:01:14.608Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cda. Status: translating","timestamp":"2025-04-17T06:01:14.610Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cda not queued for review (Status: translating).","timestamp":"2025-04-17T06:01:14.612Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 74% (32/43)","timestamp":"2025-04-17T06:01:14.612Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 74%","timestamp":"2025-04-17T06:01:14.614Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:14.614Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T06:01:14.617Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:14.617Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T06:01:14.648Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:01:14.650Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdb.","timestamp":"2025-04-17T06:01:14.656Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdb status to TRANSLATING.","timestamp":"2025-04-17T06:01:14.663Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:01:14.690Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:01:14.696Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:01:14.698Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:01:14.699Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:01:14.702Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 53","timestamp":"2025-04-17T06:01:14.703Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:01:14.705Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:01:14.709Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:01:14.710Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:01:14.710Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:01:14.711Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:01:14.711Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:01:14.712Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:01:14.712Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:01:14.712Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:01:14.716Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T06:01:14.727Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":53,"timestamp":"2025-04-17T06:01:14.730Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:01:14.736Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:01:14.738Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:01:14.739Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:19.143Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10586ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:19.148Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cda: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:19.152Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cda as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:01:19.152Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:19.179Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:19.187Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cda not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:01:19.188Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 72% (31/43)","timestamp":"2025-04-17T06:01:19.188Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 72%","timestamp":"2025-04-17T06:01:19.191Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cdb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:19.193Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T06:01:19.193Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:19.194Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cdb already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:01:19.198Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cdb. Status: translating","timestamp":"2025-04-17T06:01:19.199Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cdb not queued for review (Status: translating).","timestamp":"2025-04-17T06:01:19.199Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 74% (32/43)","timestamp":"2025-04-17T06:01:19.200Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 74%","timestamp":"2025-04-17T06:01:19.201Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cdc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:19.201Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T06:01:19.201Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:19.201Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T06:01:19.214Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:01:19.214Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdc.","timestamp":"2025-04-17T06:01:19.217Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdc status to TRANSLATING.","timestamp":"2025-04-17T06:01:19.218Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:01:19.237Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:01:19.247Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:01:19.247Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:01:19.248Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:01:19.249Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 68","timestamp":"2025-04-17T06:01:19.249Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:01:19.249Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:01:19.252Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:01:19.253Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:01:19.253Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:01:19.253Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:01:19.253Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:01:19.253Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:01:19.253Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:01:19.254Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:01:19.254Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T06:01:19.254Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":68,"timestamp":"2025-04-17T06:01:19.254Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:01:19.254Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:01:19.255Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:01:19.255Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:25.284Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10554ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:25.286Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:25.292Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:01:25.294Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:25.324Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:25.325Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:01:25.325Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 77% (33/43)","timestamp":"2025-04-17T06:01:25.326Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 77%","timestamp":"2025-04-17T06:01:25.327Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:25.327Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T06:01:25.328Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:25.328Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cdc already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:01:25.337Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cdc. Status: translating","timestamp":"2025-04-17T06:01:25.343Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdc not queued for review (Status: translating).","timestamp":"2025-04-17T06:01:25.343Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 79% (34/43)","timestamp":"2025-04-17T06:01:25.343Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 79%","timestamp":"2025-04-17T06:01:25.345Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:25.347Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T06:01:25.347Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:25.349Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T06:01:25.364Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:01:25.365Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdd.","timestamp":"2025-04-17T06:01:25.370Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdd status to TRANSLATING.","timestamp":"2025-04-17T06:01:25.371Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:01:25.380Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:01:25.389Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:01:25.390Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:01:25.391Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:01:25.391Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 64","timestamp":"2025-04-17T06:01:25.392Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:01:25.392Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:01:25.395Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:01:25.395Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:01:25.395Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:01:25.396Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:01:25.396Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:01:25.397Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:01:25.398Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:01:25.398Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:01:25.398Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T06:01:25.399Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":64,"timestamp":"2025-04-17T06:01:25.400Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:01:25.400Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:01:25.401Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:01:25.401Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:29.889Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10634ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:29.894Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:29.897Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:01:29.901Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:29.909Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:29.911Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cdc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:01:29.913Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 77% (33/43)","timestamp":"2025-04-17T06:01:29.914Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 77%","timestamp":"2025-04-17T06:01:29.916Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cdd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:29.917Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T06:01:29.918Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:29.929Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cdd already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:01:29.934Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cdd. Status: translating","timestamp":"2025-04-17T06:01:29.935Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cdd not queued for review (Status: translating).","timestamp":"2025-04-17T06:01:29.937Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 79% (34/43)","timestamp":"2025-04-17T06:01:29.938Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 79%","timestamp":"2025-04-17T06:01:29.941Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cde in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:29.941Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T06:01:29.943Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cde, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:29.944Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T06:01:29.962Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:01:29.963Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cde.","timestamp":"2025-04-17T06:01:29.967Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cde status to TRANSLATING.","timestamp":"2025-04-17T06:01:29.968Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:01:29.978Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:01:29.980Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:01:29.986Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:01:29.987Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:01:29.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 167","timestamp":"2025-04-17T06:01:29.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:01:29.988Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:01:29.991Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:01:29.993Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:01:29.993Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:01:29.995Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:01:30.002Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:01:30.003Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:01:30.003Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:01:30.003Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:01:30.003Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T06:01:30.003Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":167,"timestamp":"2025-04-17T06:01:30.003Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:01:30.004Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:01:30.004Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:01:30.004Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:35.989Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10589ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:35.993Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:35.996Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:01:35.996Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:36.009Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:36.011Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:01:36.011Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 81% (35/43)","timestamp":"2025-04-17T06:01:36.012Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 81%","timestamp":"2025-04-17T06:01:36.013Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cde in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:36.014Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T06:01:36.014Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cde, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:36.017Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cde already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:01:36.023Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Successfully processed segment 68008f27082e41fa7e9c6cde. Status: translating","timestamp":"2025-04-17T06:01:36.023Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cde not queued for review (Status: translating).","timestamp":"2025-04-17T06:01:36.024Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 84% (36/43)","timestamp":"2025-04-17T06:01:36.024Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 84%","timestamp":"2025-04-17T06:01:36.025Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:36.025Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T06:01:36.025Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:36.026Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T06:01:36.038Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:01:36.043Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdf.","timestamp":"2025-04-17T06:01:36.046Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdf status to TRANSLATING.","timestamp":"2025-04-17T06:01:36.047Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:01:36.067Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:01:36.073Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:01:36.074Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:01:36.074Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:01:36.075Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 213","timestamp":"2025-04-17T06:01:36.075Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:01:36.075Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:01:36.078Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:01:36.078Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:01:36.079Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:01:36.079Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:01:36.079Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:01:36.080Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:01:36.080Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:01:36.081Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:01:36.081Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T06:01:36.088Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":213,"timestamp":"2025-04-17T06:01:36.089Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:01:36.089Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:01:36.089Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:01:36.090Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:40.519Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10516ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:40.521Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cde: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:40.532Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cde as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:01:40.534Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:40.551Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Error processing segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:40.556Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cde not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:01:40.557Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 81% (35/43)","timestamp":"2025-04-17T06:01:40.557Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 81%","timestamp":"2025-04-17T06:01:40.568Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Processing segment 68008f27082e41fa7e9c6cdf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:40.578Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T06:01:40.578Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:40.579Z"}
{"level":"warn","message":"Segment 68008f27082e41fa7e9c6cdf already processed or in progress (status: translating). Skipping translation.","timestamp":"2025-04-17T06:01:40.597Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Successfully processed segment 68008f27082e41fa7e9c6cdf. Status: translating","timestamp":"2025-04-17T06:01:40.603Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091: Segment 68008f27082e41fa7e9c6cdf not queued for review (Status: translating).","timestamp":"2025-04-17T06:01:40.605Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Updating progress: 84% (36/43)","timestamp":"2025-04-17T06:01:40.605Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 progress: 84%","timestamp":"2025-04-17T06:01:40.611Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] FINISHED Segment Loop. Processed: 18, Errors: 18, Total Segments in Job: 43","timestamp":"2025-04-17T06:01:40.612Z"}
{"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] Failing job due to segment errors: 18 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:40.613Z"}
{"error":{},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868196091] FAILED Catastrophically: 18 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:40.625Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-68008f27082e41fa7e9c6cb2-1744868196091","level":"error","message":"Job file-68008f27082e41fa7e9c6cb2-1744868196091 failed. Error: 18 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:40.631Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:46.589Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10500ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:01:46.590Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:46.595Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:01:46.596Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:46.639Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:46.640Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:01:46.645Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 86% (37/43)","timestamp":"2025-04-17T06:01:46.645Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 86%","timestamp":"2025-04-17T06:01:46.646Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] FINISHED Segment Loop. Processed: 18, Errors: 19, Total Segments in Job: 43","timestamp":"2025-04-17T06:01:46.647Z"}
{"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Failing job due to segment errors: 19 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:46.647Z"}
{"error":{},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] FAILED Catastrophically: 19 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:46.648Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-68008f27082e41fa7e9c6cb2-1744868752818","level":"error","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 failed. Error: 19 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:01:46.652Z"}
{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] START Processing job. Raw Data:","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"timestamp":"2025-04-17T06:01:56.761Z","type":"file","userId":"67fcb942de30090a16d422b0"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Extracted - promptTemplateId: 67fe34abde39936502045d6c, aiConfigId: 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:01:56.763Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing Details - Type: file, Project: 6800625db601745b33861ae0, File: 68008f27082e41fa7e9c6cb2, AI Config: 67fe227be8f10dbf81036e7e, Prompt: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:01:56.769Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Determining segments to translate... Type: file","timestamp":"2025-04-17T06:01:56.769Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Fetching project 6800625db601745b33861ae0 for language info...","timestamp":"2025-04-17T06:01:56.773Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Project languages: zh-CN -> en-US","timestamp":"2025-04-17T06:01:56.778Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] File Job: Determined 37 segments to translate.","timestamp":"2025-04-17T06:01:56.789Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Determined Languages: zh-CN -> en-US","timestamp":"2025-04-17T06:01:56.789Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Starting segment processing loop for 37 segments.","timestamp":"2025-04-17T06:01:56.791Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:01:56.798Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T06:01:56.798Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:01:56.805Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T06:01:56.819Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"样品的稀释\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:01:56.821Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb5.","timestamp":"2025-04-17T06:01:56.833Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb5 status to TRANSLATING.","timestamp":"2025-04-17T06:01:56.835Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:01:56.846Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:01:56.849Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:01:56.850Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:01:56.850Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:01:56.851Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 5","timestamp":"2025-04-17T06:01:56.851Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:01:56.851Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:01:56.856Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:01:56.861Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:01:56.863Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:01:56.865Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:01:56.865Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:01:56.867Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:01:56.868Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:01:56.870Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:01:56.871Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb5...","timestamp":"2025-04-17T06:01:56.872Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":5,"timestamp":"2025-04-17T06:01:56.873Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:01:56.874Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n样品的稀释\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n样品的稀释\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:01:56.875Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:01:56.876Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:02:07.487Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10612ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:02:07.489Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb5: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:07.498Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:02:07.498Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:07.517Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:07.519Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:02:07.520Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 2% (1/43)","timestamp":"2025-04-17T06:02:07.520Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 2%","timestamp":"2025-04-17T06:02:07.521Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:02:07.521Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T06:02:07.521Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:02:07.521Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T06:02:07.535Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:02:07.535Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb6.","timestamp":"2025-04-17T06:02:07.538Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb6 status to TRANSLATING.","timestamp":"2025-04-17T06:02:07.538Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:02:07.549Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:02:07.555Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:02:07.555Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:02:07.555Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:02:07.556Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 100","timestamp":"2025-04-17T06:02:07.556Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:02:07.556Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:02:07.558Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:02:07.558Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:02:07.558Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:02:07.559Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:02:07.559Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:02:07.559Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:02:07.559Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:02:07.559Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:02:07.559Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb6...","timestamp":"2025-04-17T06:02:07.560Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":100,"timestamp":"2025-04-17T06:02:07.561Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:02:07.561Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"1\">.</rpr id=\"1\" transform=\"close\">1固体和半固体样品<rpr id=\"1\">：</rpr id=\"1\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:02:07.562Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:02:07.562Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:02:18.148Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10587ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:02:18.153Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb6: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:18.162Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:02:18.163Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:18.185Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:18.186Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:02:18.187Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 5% (2/43)","timestamp":"2025-04-17T06:02:18.187Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 5%","timestamp":"2025-04-17T06:02:18.188Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:02:18.189Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T06:02:18.189Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:02:18.189Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T06:02:18.200Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:02:18.200Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb7.","timestamp":"2025-04-17T06:02:18.204Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb7 status to TRANSLATING.","timestamp":"2025-04-17T06:02:18.204Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:02:18.223Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:02:18.225Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:02:18.225Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:02:18.226Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:02:18.226Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 900","timestamp":"2025-04-17T06:02:18.226Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:02:18.227Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:02:18.229Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:02:18.230Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:02:18.230Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:02:18.230Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:02:18.230Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:02:18.231Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:02:18.231Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:02:18.231Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:02:18.231Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb7...","timestamp":"2025-04-17T06:02:18.231Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":900,"timestamp":"2025-04-17T06:02:18.232Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:02:18.232Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">8</rpr id=\"2\" transform=\"close\"> 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">10 000 <rpr id=\"2\">r/min</rpr id=\"2\" transform=\"close\">均质1 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\">2 <rpr id=\"2\">min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:02:18.232Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:02:18.233Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:02:28.907Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10674ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:02:28.908Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:28.914Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:02:28.915Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:28.936Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:28.939Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:02:28.940Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 7% (3/43)","timestamp":"2025-04-17T06:02:28.940Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 7%","timestamp":"2025-04-17T06:02:28.941Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:02:28.942Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T06:02:28.942Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:02:28.942Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T06:02:28.953Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:02:28.956Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb8.","timestamp":"2025-04-17T06:02:28.960Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb8 status to TRANSLATING.","timestamp":"2025-04-17T06:02:28.960Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:02:28.969Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:02:28.976Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:02:28.977Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:02:28.977Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:02:28.977Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T06:02:28.978Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:02:28.978Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:02:28.980Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:02:28.981Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:02:28.981Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:02:28.982Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:02:28.982Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:02:28.982Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:02:28.983Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:02:28.983Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:02:28.983Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb8...","timestamp":"2025-04-17T06:02:28.983Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":51,"timestamp":"2025-04-17T06:02:28.984Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:02:28.984Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:02:28.984Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:02:28.985Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:02:39.602Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10618ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:02:39.605Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:39.608Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:02:39.609Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:39.623Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:39.625Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:02:39.626Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 9% (4/43)","timestamp":"2025-04-17T06:02:39.626Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 9%","timestamp":"2025-04-17T06:02:39.627Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cb9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:02:39.628Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T06:02:39.628Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cb9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:02:39.628Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T06:02:39.643Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.2液体样品：\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:02:39.644Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cb9.","timestamp":"2025-04-17T06:02:39.646Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cb9 status to TRANSLATING.","timestamp":"2025-04-17T06:02:39.647Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:02:39.653Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:02:39.661Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:02:39.662Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:02:39.662Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:02:39.662Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 10","timestamp":"2025-04-17T06:02:39.662Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:02:39.663Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:02:39.665Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:02:39.665Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:02:39.665Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:02:39.665Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:02:39.666Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:02:39.666Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:02:39.666Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:02:39.666Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:02:39.666Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cb9...","timestamp":"2025-04-17T06:02:39.666Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":10,"timestamp":"2025-04-17T06:02:39.667Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:02:39.667Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:02:39.667Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:02:39.668Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:02:50.307Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10639ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:02:50.308Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cb9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:50.319Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cb9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:02:50.320Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:50.334Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:02:50.336Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cb9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:02:50.337Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 12% (5/43)","timestamp":"2025-04-17T06:02:50.351Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 12%","timestamp":"2025-04-17T06:02:50.353Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cba in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:02:50.354Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T06:02:50.354Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cba, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:02:50.355Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T06:02:50.380Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:02:50.382Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cba.","timestamp":"2025-04-17T06:02:50.386Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cba status to TRANSLATING.","timestamp":"2025-04-17T06:02:50.392Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:02:50.402Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:02:50.407Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:02:50.408Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:02:50.409Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:02:50.410Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 503","timestamp":"2025-04-17T06:02:50.411Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:02:50.411Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:02:50.415Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:02:50.425Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:02:50.426Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:02:50.427Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:02:50.428Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:02:50.429Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:02:50.431Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:02:50.432Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:02:50.433Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cba...","timestamp":"2025-04-17T06:02:50.433Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":503,"timestamp":"2025-04-17T06:02:50.434Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:02:50.435Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n以无菌吸管吸取25<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">样品置于盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">用拍击式均质器拍打<rpr id=\"2\">lmin</rpr id=\"2\" transform=\"close\"><rpr id=\"4\">〜</rpr id=\"4\" transform=\"close\"><rpr id=\"2\">2min</rpr id=\"2\" transform=\"close\"><rpr id=\"3\">，</rpr id=\"3\" transform=\"close\">制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:02:50.436Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:02:50.436Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:01.039Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10604ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:01.042Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cba: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:01.051Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cba as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:03:01.052Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:01.081Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:01.086Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cba not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:03:01.086Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 14% (6/43)","timestamp":"2025-04-17T06:03:01.087Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 14%","timestamp":"2025-04-17T06:03:01.090Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:03:01.091Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T06:03:01.092Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:03:01.093Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T06:03:01.129Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:03:01.130Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbb.","timestamp":"2025-04-17T06:03:01.138Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbb status to TRANSLATING.","timestamp":"2025-04-17T06:03:01.142Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:03:01.166Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:03:01.175Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:03:01.176Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:03:01.176Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:03:01.177Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T06:03:01.177Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:03:01.178Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:03:01.197Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:03:01.198Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:03:01.199Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:03:01.200Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:03:01.201Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:03:01.202Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:03:01.203Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:03:01.204Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:03:01.204Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbb...","timestamp":"2025-04-17T06:03:01.205Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":51,"timestamp":"2025-04-17T06:03:01.206Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:03:01.206Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">的样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:03:01.208Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:03:01.208Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:11.857Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10652ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:11.859Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:11.866Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:03:11.866Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:11.881Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:11.882Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:03:11.883Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 16% (7/43)","timestamp":"2025-04-17T06:03:11.883Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 16%","timestamp":"2025-04-17T06:03:11.885Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:03:11.885Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T06:03:11.885Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:03:11.886Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T06:03:11.901Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:03:11.901Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbc.","timestamp":"2025-04-17T06:03:11.906Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbc status to TRANSLATING.","timestamp":"2025-04-17T06:03:11.906Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:03:11.920Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:03:11.926Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:03:11.926Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:03:11.926Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:03:11.926Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 199","timestamp":"2025-04-17T06:03:11.927Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:03:11.927Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:03:11.929Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:03:11.930Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:03:11.930Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:03:11.930Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:03:11.930Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:03:11.930Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:03:11.931Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:03:11.931Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:03:11.931Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbc...","timestamp":"2025-04-17T06:03:11.931Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":199,"timestamp":"2025-04-17T06:03:11.931Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:03:11.932Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n当结果要求为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:03:11.932Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:03:11.933Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:22.562Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10631ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:22.563Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:22.570Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:03:22.570Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:22.581Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:22.585Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:03:22.585Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 19% (8/43)","timestamp":"2025-04-17T06:03:22.586Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 19%","timestamp":"2025-04-17T06:03:22.587Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:03:22.588Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T06:03:22.588Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:03:22.588Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T06:03:22.607Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:03:22.607Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbd.","timestamp":"2025-04-17T06:03:22.614Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbd status to TRANSLATING.","timestamp":"2025-04-17T06:03:22.616Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:03:22.622Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:03:22.625Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:03:22.633Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:03:22.634Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:03:22.634Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 314","timestamp":"2025-04-17T06:03:22.636Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:03:22.637Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:03:22.643Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:03:22.644Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:03:22.644Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:03:22.645Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:03:22.646Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:03:22.647Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:03:22.647Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:03:22.647Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:03:22.648Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbd...","timestamp":"2025-04-17T06:03:22.649Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":314,"timestamp":"2025-04-17T06:03:22.651Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:03:22.652Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.3用<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或微量移液器吸取1:10样品匀液<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">,沿管壁缓慢注于盛有9<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">稀释液 的无菌试管中（注意吸管或吸头尖端不要触及稀释液面），在振荡器上振荡混匀，制成<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">:<rpr id=\"2\">100</rpr id=\"2\" transform=\"close\">的样品 匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:03:22.653Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:03:22.654Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:33.297Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10645ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:33.298Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:33.307Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:03:33.308Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:33.320Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:33.321Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:03:33.322Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 21% (9/43)","timestamp":"2025-04-17T06:03:33.322Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 21%","timestamp":"2025-04-17T06:03:33.324Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbe in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:03:33.324Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T06:03:33.325Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbe, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:03:33.336Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T06:03:33.349Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:03:33.350Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbe.","timestamp":"2025-04-17T06:03:33.352Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbe status to TRANSLATING.","timestamp":"2025-04-17T06:03:33.353Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:03:33.359Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:03:33.371Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:03:33.372Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:03:33.372Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:03:33.372Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 71","timestamp":"2025-04-17T06:03:33.373Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:03:33.373Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:03:33.376Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:03:33.377Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:03:33.378Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:03:33.379Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:03:33.379Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:03:33.379Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:03:33.379Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:03:33.380Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:03:33.380Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbe...","timestamp":"2025-04-17T06:03:33.381Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":71,"timestamp":"2025-04-17T06:03:33.381Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:03:33.381Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.4按6.1.3操作，制备<rpr id=\"2\">10</rpr id=\"2\" transform=\"close\">倍系列稀释样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:03:33.382Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:03:33.382Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:43.985Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10604ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:43.986Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbe: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:43.991Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbe as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:03:43.991Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:44.003Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:44.009Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbe not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:03:44.010Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 23% (10/43)","timestamp":"2025-04-17T06:03:44.010Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 23%","timestamp":"2025-04-17T06:03:44.011Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cbf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:03:44.011Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T06:03:44.012Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cbf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:03:44.012Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T06:03:44.026Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:03:44.027Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cbf.","timestamp":"2025-04-17T06:03:44.031Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cbf status to TRANSLATING.","timestamp":"2025-04-17T06:03:44.041Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:03:44.048Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:03:44.050Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:03:44.051Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:03:44.051Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:03:44.052Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 110","timestamp":"2025-04-17T06:03:44.052Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:03:44.052Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:03:44.055Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:03:44.055Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:03:44.055Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:03:44.055Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:03:44.055Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:03:44.056Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:03:44.056Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:03:44.056Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:03:44.056Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cbf...","timestamp":"2025-04-17T06:03:44.057Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":110,"timestamp":"2025-04-17T06:03:44.057Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:03:44.058Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n每递增稀释一次，换用<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">次<rpr id=\"2\">lmL</rpr id=\"2\" transform=\"close\">无菌吸管或 吸头。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:03:44.058Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:03:44.059Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"Registered processor for file type: docx","timestamp":"2025-04-17T06:03:46.954Z"}
{"level":"info","message":"Registered processor for file type: txt","timestamp":"2025-04-17T06:03:46.957Z"}
{"level":"info","message":"Registered processor for file type: xliff","timestamp":"2025-04-17T06:03:46.959Z"}
{"level":"info","message":"Registered processor for file type: mqxliff","timestamp":"2025-04-17T06:03:46.959Z"}
{"level":"info","message":"Translation queue service initialized. Connected to Redis: 127.0.0.1:6379","timestamp":"2025-04-17T06:03:47.094Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T06:03:47.820Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T06:03:47.820Z"}
{"level":"info","message":"Review routes updated to use namespace import for controller","timestamp":"2025-04-17T06:03:47.879Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T06:03:48.183Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:54.681Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10623ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:03:54.681Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cbf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:54.690Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cbf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:03:54.690Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:54.698Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:03:54.699Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cbf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:03:54.699Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 26% (11/43)","timestamp":"2025-04-17T06:03:54.699Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 26%","timestamp":"2025-04-17T06:03:54.700Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:03:54.700Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T06:03:54.700Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:03:54.701Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T06:03:54.718Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:03:54.720Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc0.","timestamp":"2025-04-17T06:03:54.729Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc0 status to TRANSLATING.","timestamp":"2025-04-17T06:03:54.731Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:03:54.736Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:03:54.745Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:03:54.751Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:03:54.752Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:03:54.753Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 163","timestamp":"2025-04-17T06:03:54.754Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:03:54.755Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:03:54.761Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:03:54.762Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:03:54.762Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:03:54.763Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:03:54.763Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:03:54.765Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:03:54.766Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:03:54.766Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:03:54.766Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc0...","timestamp":"2025-04-17T06:03:54.766Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":163,"timestamp":"2025-04-17T06:03:54.766Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:03:54.767Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.5根据对样品污染状况的估计，选择1个<rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">3个适宜稀释度的样品匀液（液体样品可包括原液），吸 取<rpr id=\"2\">1mL</rpr id=\"2\" transform=\"close\">样品匀液于无菌培养皿内，每个稀释度做两个培养皿。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:03:54.768Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:03:54.769Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:05.424Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10658ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:05.428Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc0: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:05.434Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:04:05.435Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:05.448Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:05.449Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:04:05.449Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 28% (12/43)","timestamp":"2025-04-17T06:04:05.449Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 28%","timestamp":"2025-04-17T06:04:05.452Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:04:05.460Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T06:04:05.462Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:04:05.463Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T06:04:05.481Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:04:05.482Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc3.","timestamp":"2025-04-17T06:04:05.489Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc3 status to TRANSLATING.","timestamp":"2025-04-17T06:04:05.489Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:04:05.494Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:04:05.498Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:04:05.505Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:04:05.507Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:04:05.508Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 177","timestamp":"2025-04-17T06:04:05.509Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:04:05.510Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:04:05.514Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:04:05.519Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:04:05.520Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:04:05.520Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:04:05.520Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:04:05.520Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:04:05.521Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:04:05.521Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:04:05.521Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc3...","timestamp":"2025-04-17T06:04:05.521Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":177,"timestamp":"2025-04-17T06:04:05.522Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:04:05.524Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\"><rpr id=\"6\">.</rpr id=\"6\" transform=\"close\"><rpr id=\"2\">2</rpr id=\"2\" transform=\"close\"><rpr id=\"0\">培养</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:04:05.524Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:04:05.526Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T06:04:11.354Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:04:11.357Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:04:11.358Z"}
{"level":"warn","message":"No Bearer token found in Authorization header.","timestamp":"2025-04-17T06:04:11.358Z"}
{"errorMessage":"未提供身份验证令牌","errorName":"UnauthorizedError","level":"error","message":"JWT Authentication failed:","timestamp":"2025-04-17T06:04:11.359Z"}
{"level":"error","message":"[Auth Middleware] Passing error to next(): UnauthorizedError - 未提供身份验证令牌","timestamp":"2025-04-17T06:04:11.360Z"}
{"level":"error","message":"errorHandler received error: 未提供身份验证令牌","name":"UnauthorizedError","stack":"UnauthorizedError: 未提供身份验证令牌\n    at authenticateJwt (D:\\project\\translation-platform\\src\\middleware\\auth.middleware.ts:31:13)\n    at Layer.handle [as handle_request] (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\project\\translation-platform\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\project\\translation-platform\\node_modules\\express\\lib\\router\\index.js:328:13)","statusCode":401,"timestamp":"2025-04-17T06:04:11.363Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:16.200Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10678ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:16.203Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc3: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:16.215Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:04:16.216Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:16.231Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:16.236Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:04:16.237Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 30% (13/43)","timestamp":"2025-04-17T06:04:16.237Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 30%","timestamp":"2025-04-17T06:04:16.238Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc5 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:04:16.239Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T06:04:16.239Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc5, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:04:16.239Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T06:04:16.255Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:04:16.256Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc5.","timestamp":"2025-04-17T06:04:16.258Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc5 status to TRANSLATING.","timestamp":"2025-04-17T06:04:16.259Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:04:16.267Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:04:16.280Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:04:16.284Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:04:16.285Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:04:16.285Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 193","timestamp":"2025-04-17T06:04:16.286Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:04:16.287Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:04:16.297Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:04:16.302Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:04:16.302Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:04:16.302Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:04:16.303Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:04:16.304Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:04:16.306Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:04:16.308Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:04:16.308Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc5...","timestamp":"2025-04-17T06:04:16.310Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":193,"timestamp":"2025-04-17T06:04:16.313Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:04:16.314Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n水产品30 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">±1 <rpr id=\"2\">C</rpr id=\"2\" transform=\"close\">培养 72<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">±3<rpr id=\"2\">h</rpr id=\"2\" transform=\"close\">。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:04:16.315Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:04:16.318Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:26.975Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10662ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:26.980Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc5: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:26.981Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc5 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:04:26.981Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:26.998Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:27.000Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc5 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:04:27.000Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 33% (14/43)","timestamp":"2025-04-17T06:04:27.003Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 33%","timestamp":"2025-04-17T06:04:27.006Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc6 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:04:27.007Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T06:04:27.008Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc6, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:04:27.008Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T06:04:27.020Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:04:27.021Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc6.","timestamp":"2025-04-17T06:04:27.024Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc6 status to TRANSLATING.","timestamp":"2025-04-17T06:04:27.031Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:04:27.037Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:04:27.040Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:04:27.040Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:04:27.041Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:04:27.041Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 116","timestamp":"2025-04-17T06:04:27.041Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:04:27.041Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:04:27.043Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:04:27.043Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:04:27.044Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:04:27.044Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:04:27.044Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:04:27.044Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:04:27.044Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:04:27.045Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:04:27.045Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc6...","timestamp":"2025-04-17T06:04:27.045Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":116,"timestamp":"2025-04-17T06:04:27.046Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:04:27.047Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n如果样品中可能含有在琼脂培养基表面蔓延生长的菌落，可在凝固后的琼脂培养基表面覆 盖一薄层平板计数琼脂培养基（约4<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)，凝固后翻转平板，进行培养。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:04:27.047Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:04:27.049Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:37.704Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10658ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:37.705Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc6: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:37.710Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc6 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:04:37.711Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:37.723Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:37.735Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc6 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:04:37.738Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 35% (15/43)","timestamp":"2025-04-17T06:04:37.745Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 35%","timestamp":"2025-04-17T06:04:37.747Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:04:37.748Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T06:04:37.749Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:04:37.749Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T06:04:37.765Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:04:37.766Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc7.","timestamp":"2025-04-17T06:04:37.771Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc7 status to TRANSLATING.","timestamp":"2025-04-17T06:04:37.772Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:04:37.779Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:04:37.783Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:04:37.789Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:04:37.790Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:04:37.790Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 164","timestamp":"2025-04-17T06:04:37.790Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:04:37.790Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:04:37.793Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:04:37.793Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:04:37.794Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:04:37.794Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:04:37.794Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:04:37.794Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:04:37.794Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:04:37.795Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:04:37.795Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc7...","timestamp":"2025-04-17T06:04:37.795Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":164,"timestamp":"2025-04-17T06:04:37.795Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:04:37.796Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">6</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">.<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">如使用菌落总数测试片，应按照测试片所提供的相关技术规程操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:04:37.796Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:04:37.796Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:48.420Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10625ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:48.426Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:48.430Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:04:48.433Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:48.442Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:48.443Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:04:48.444Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 37% (16/43)","timestamp":"2025-04-17T06:04:48.445Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 37%","timestamp":"2025-04-17T06:04:48.447Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:04:48.448Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T06:04:48.449Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:04:48.449Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T06:04:48.474Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:04:48.475Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc8.","timestamp":"2025-04-17T06:04:48.478Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc8 status to TRANSLATING.","timestamp":"2025-04-17T06:04:48.478Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:04:48.498Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:04:48.501Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:04:48.503Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:04:48.504Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:04:48.504Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T06:04:48.504Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:04:48.504Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:04:48.508Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:04:48.508Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:04:48.509Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:04:48.509Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:04:48.509Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:04:48.509Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:04:48.510Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:04:48.510Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:04:48.510Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc8...","timestamp":"2025-04-17T06:04:48.510Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T06:04:48.510Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:04:48.511Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"6\">63</rpr id=\"6\" transform=\"close\"><rpr id=\"0\">菌落计数</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:04:48.511Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:04:48.511Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:59.130Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10620ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:04:59.130Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:59.133Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:04:59.133Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:59.137Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:04:59.137Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:04:59.137Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 40% (17/43)","timestamp":"2025-04-17T06:04:59.137Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 40%","timestamp":"2025-04-17T06:04:59.138Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cc9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:04:59.138Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T06:04:59.138Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cc9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:04:59.138Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T06:04:59.147Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:04:59.154Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cc9.","timestamp":"2025-04-17T06:04:59.156Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cc9 status to TRANSLATING.","timestamp":"2025-04-17T06:04:59.157Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:04:59.164Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:04:59.167Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:04:59.168Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:04:59.169Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:04:59.169Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T06:04:59.170Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:04:59.171Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:04:59.173Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:04:59.173Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:04:59.174Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:04:59.174Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:04:59.174Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:04:59.174Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:04:59.175Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:04:59.175Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:04:59.175Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cc9...","timestamp":"2025-04-17T06:04:59.175Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T06:04:59.176Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:04:59.176Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.1可用肉眼观察，必要时用放大镜或菌落计数器，记录稀释倍数和相应的菌落数量。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:04:59.176Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:04:59.176Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:05:09.789Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10614ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:05:09.804Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cc9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:09.805Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cc9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:05:09.806Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:09.812Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:09.813Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cc9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:05:09.813Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 42% (18/43)","timestamp":"2025-04-17T06:05:09.813Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 42%","timestamp":"2025-04-17T06:05:09.814Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cca in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:05:09.814Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T06:05:09.814Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cca, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:05:09.814Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T06:05:09.831Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:05:09.831Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cca.","timestamp":"2025-04-17T06:05:09.833Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cca status to TRANSLATING.","timestamp":"2025-04-17T06:05:09.834Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:05:09.850Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:05:09.858Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:05:09.858Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:05:09.859Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:05:09.861Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 211","timestamp":"2025-04-17T06:05:09.862Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:05:09.863Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:05:09.866Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:05:09.867Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:05:09.867Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:05:09.868Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:05:09.868Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:05:09.868Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:05:09.868Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:05:09.868Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:05:09.868Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cca...","timestamp":"2025-04-17T06:05:09.868Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":211,"timestamp":"2025-04-17T06:05:09.869Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:05:09.869Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n菌落计数以 菌落形成单位<rpr id=\"3\">（</rpr id=\"3\" transform=\"close\"><rpr id=\"2\">colony</rpr id=\"2\" transform=\"close\"> <rpr id=\"2\">formingunit</rpr id=\"2\" transform=\"close\">，<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">)表示。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:05:09.869Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:05:09.869Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:05:20.488Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10619ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:05:20.489Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cca: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:20.497Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cca as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:05:20.498Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:20.512Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:20.513Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cca not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:05:20.513Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 44% (19/43)","timestamp":"2025-04-17T06:05:20.513Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 44%","timestamp":"2025-04-17T06:05:20.514Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:05:20.514Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T06:05:20.515Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:05:20.515Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T06:05:20.533Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:05:20.533Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccb.","timestamp":"2025-04-17T06:05:20.536Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccb status to TRANSLATING.","timestamp":"2025-04-17T06:05:20.537Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:05:20.551Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:05:20.562Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:05:20.562Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:05:20.563Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:05:20.563Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 173","timestamp":"2025-04-17T06:05:20.563Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:05:20.564Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:05:20.569Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:05:20.576Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:05:20.576Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:05:20.576Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:05:20.577Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:05:20.577Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:05:20.577Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:05:20.578Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:05:20.578Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccb...","timestamp":"2025-04-17T06:05:20.578Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":173,"timestamp":"2025-04-17T06:05:20.578Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:05:20.579Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.2选取菌落数在30<rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\"><rpr id=\"5\">〜</rpr id=\"5\" transform=\"close\">300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">之间、无蔓延菌落生长的平板计数菌落总数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:05:20.579Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:05:20.579Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/auth/login","timestamp":"2025-04-17T06:05:30.539Z"}
{"level":"info","message":"[ENTRY] Received request: POST /api/auth/login","timestamp":"2025-04-17T06:05:30.541Z"}
{"level":"info","message":"AuthController.login - Attempting login for: admin@example.com","timestamp":"2025-04-17T06:05:30.555Z"}
{"level":"debug","message":"[loginUser] Attempting to find user with email: admin@example.com","timestamp":"2025-04-17T06:05:30.556Z"}
{"level":"debug","message":"[loginUser] User found. ID: 67fcb942de30090a16d422b0. Checking password field...","timestamp":"2025-04-17T06:05:30.569Z"}
{"level":"debug","message":"[loginUser] Comparing Provided Password: [password] (Length: 8)","timestamp":"2025-04-17T06:05:30.569Z"}
{"level":"debug","message":"[loginUser] With Stored Hash: [$2a$10$l4jgbUS1OpsmSyG2e9WRQeIAMARPd3iKV/3UQXNsp1.xClZLKDcIi] (Length: 60)","timestamp":"2025-04-17T06:05:30.570Z"}
{"level":"debug","message":"[loginUser] Password comparison result (isPasswordValid): true","timestamp":"2025-04-17T06:05:30.655Z"}
{"level":"info","message":"User logged in: 67fcb942de30090a16d422b0","timestamp":"2025-04-17T06:05:30.659Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/users/stats","timestamp":"2025-04-17T06:05:30.797Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/recent","timestamp":"2025-04-17T06:05:30.799Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/users/stats","timestamp":"2025-04-17T06:05:30.802Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:30.804Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:30.805Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:30.806Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:30.809Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T06:05:30.815Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/users/stats","timestamp":"2025-04-17T06:05:30.816Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/recent","timestamp":"2025-04-17T06:05:30.818Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:30.819Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:30.823Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:30.824Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:30.826Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:30.830Z"}
{"level":"info","message":"Request received to get stats for user: 67fcb942de30090a16d422b0","timestamp":"2025-04-17T06:05:30.831Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T06:05:30.834Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:30.836Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:30.836Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:30.836Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:30.838Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/recent","timestamp":"2025-04-17T06:05:30.841Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T06:05:30.842Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/users/stats","timestamp":"2025-04-17T06:05:30.844Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:30.846Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:30.847Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:30.848Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:30.849Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:30.854Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:30.869Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/recent","timestamp":"2025-04-17T06:05:30.873Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:30.874Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:30.875Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:30.875Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:30.876Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T06:05:30.881Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:30.882Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:30.887Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:30.888Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:30.890Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:30.894Z"}
{"level":"info","message":"Request received to get stats for user: 67fcb942de30090a16d422b0","timestamp":"2025-04-17T06:05:30.895Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:30.946Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:30.951Z"}
{"level":"info","message":"Stats retrieved for user 67fcb942de30090a16d422b0: {\"totalProjects\":15,\"pendingReviews\":0,\"completedFiles\":0,\"overallProgress\":50}","timestamp":"2025-04-17T06:05:30.957Z"}
{"level":"info","message":"Stats retrieved for user 67fcb942de30090a16d422b0: {\"totalProjects\":15,\"pendingReviews\":0,\"completedFiles\":0,\"overallProgress\":50}","timestamp":"2025-04-17T06:05:30.981Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:05:31.146Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10568ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:05:31.147Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:31.151Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:05:31.151Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:31.157Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:31.158Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:05:31.158Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 47% (20/43)","timestamp":"2025-04-17T06:05:31.158Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 47%","timestamp":"2025-04-17T06:05:31.159Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:05:31.159Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T06:05:31.160Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:05:31.160Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T06:05:31.170Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:05:31.170Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccc.","timestamp":"2025-04-17T06:05:31.173Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccc status to TRANSLATING.","timestamp":"2025-04-17T06:05:31.173Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:05:31.179Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:05:31.183Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:05:31.184Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:05:31.184Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:05:31.184Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 124","timestamp":"2025-04-17T06:05:31.184Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:05:31.184Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:05:31.186Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:05:31.186Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:05:31.186Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:05:31.187Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:05:31.187Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:05:31.187Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:05:31.187Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:05:31.188Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:05:31.188Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccc...","timestamp":"2025-04-17T06:05:31.188Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":124,"timestamp":"2025-04-17T06:05:31.188Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:05:31.188Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n低于30<rpr id=\"2\">CFU </rpr id=\"2\" transform=\"close\">的平板记录具体菌落数，大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">的可记录为多不可计。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:05:31.189Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:05:31.189Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/prompts","timestamp":"2025-04-17T06:05:32.676Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/prompts","timestamp":"2025-04-17T06:05:32.677Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/prompts","timestamp":"2025-04-17T06:05:32.678Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:32.679Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:32.679Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:32.680Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:32.681Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: GET /api/prompts","timestamp":"2025-04-17T06:05:32.682Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:32.683Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:32.683Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:32.683Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:32.684Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:32.685Z"}
{"level":"info","message":"Entering PromptTemplateController.getAllTemplates","timestamp":"2025-04-17T06:05:32.686Z"}
{"level":"debug","message":"PromptTemplateService.getAllPromptTemplates called","timestamp":"2025-04-17T06:05:32.686Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:32.688Z"}
{"level":"info","message":"Entering PromptTemplateController.getAllTemplates","timestamp":"2025-04-17T06:05:32.688Z"}
{"level":"debug","message":"PromptTemplateService.getAllPromptTemplates called","timestamp":"2025-04-17T06:05:32.688Z"}
{"level":"info","message":"Found 4 prompt templates.","timestamp":"2025-04-17T06:05:32.698Z"}
{"level":"info","message":"Found 4 prompt templates.","timestamp":"2025-04-17T06:05:32.700Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects?limit=100","timestamp":"2025-04-17T06:05:33.523Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects?limit=100","timestamp":"2025-04-17T06:05:33.524Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects?limit=100","timestamp":"2025-04-17T06:05:33.526Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:33.527Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:33.527Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:33.527Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:33.528Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects?limit=100","timestamp":"2025-04-17T06:05:33.530Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:33.531Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:33.532Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:33.532Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:33.533Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:33.534Z"}
{"level":"info","message":"[ProjectController.getProjects] Entered function for user ID (from auth): 67fcb942de30090a16d422b0","timestamp":"2025-04-17T06:05:33.535Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:33.536Z"}
{"level":"info","message":"[ProjectController.getProjects] Entered function for user ID (from auth): 67fcb942de30090a16d422b0","timestamp":"2025-04-17T06:05:33.537Z"}
{"level":"info","message":"[ProjectController.getProjects] Service returned result for user 67fcb942de30090a16d422b0:","pagination":{"limit":100,"page":1,"total":15,"totalPages":1},"projects":[{"__v":0,"_id":"6800625db601745b33861ae0","createdAt":"2025-04-17T02:07:25.548Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"ttt","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-17T02:07:25.548Z"},{"__v":0,"_id":"67ff99f4faf101ce1590b9bb","createdAt":"2025-04-16T11:52:20.438Z","deadline":"2025-04-17T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"啪啪啪","domain":"Legal","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"啪啪啪","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-16T11:52:20.438Z"},{"__v":0,"_id":"67fe03eacb309c902c850eb8","createdAt":"2025-04-15T06:59:54.293Z","deadline":"2025-04-19T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"大苏打","domain":"Regulatory","files":[],"industry":"Insurance","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test2","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:59:54.293Z"},{"__v":0,"_id":"67fe0005cb309c902c850db4","createdAt":"2025-04-15T06:43:17.704Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:43:17.704Z"},{"__v":0,"_id":"67fdff98cb309c902c850dab","createdAt":"2025-04-15T06:41:28.139Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:41:28.139Z"},{"__v":0,"_id":"67fdcfab3034155a167dee53","createdAt":"2025-04-15T03:16:59.289Z","deadline":"2025-04-25T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"languagePairs":[{"source":"es-ES","target":"ja"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"时代的","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-15T03:16:59.289Z"},{"__v":0,"_id":"67fdcb1a3b5c61926af422a3","createdAt":"2025-04-15T02:57:30.435Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Legal","files":[],"languagePairs":[{"source":"es-ES","target":"en-GB"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"对的","owner":"67fcb942de30090a16d422b0","reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:57:30.435Z"},{"__v":0,"_id":"67fdc7595cd4632c3a64e06c","createdAt":"2025-04-15T02:41:29.100Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Technical","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"en-US","target":"es-ES"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"是","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:41:29.100Z"},{"__v":0,"_id":"67fdc5535cd4632c3a64e019","createdAt":"2025-04-15T02:32:51.795Z","deadline":"2025-04-27T00:00:00.000Z","files":[],"languagePairs":[{"source":"zh-CN","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"设施","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-15T02:32:51.795Z"},{"__v":0,"_id":"67fcfe157c51da91b704e51e","createdAt":"2025-04-14T12:22:45.978Z","deadline":"2025-04-04T00:00:00.000Z","domain":"Education","files":[],"languagePairs":[{"source":"it","target":"ar"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T12:22:45.978Z"},{"__v":0,"_id":"67fcfc2102aa2a1f99f37d37","createdAt":"2025-04-14T12:14:25.708Z","deadline":"2025-04-12T00:00:00.000Z","domain":"Finance","files":[],"industry":"Construction & Civil Engineering","languagePairs":[{"source":"de","target":"it"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"003","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-14T12:14:25.708Z"},{"__v":0,"_id":"67fcecf20e1b74f905d75904","createdAt":"2025-04-14T11:09:38.351Z","deadline":"2025-04-24T00:00:00.000Z","description":"111","domain":"Medical","files":[],"industry":"Insurance","languagePairs":[{"source":"de","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"111","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:09:38.351Z"},{"__v":0,"_id":"67fcec3e0e1b74f905d758bd","createdAt":"2025-04-14T11:06:38.798Z","deadline":"2025-04-19T00:00:00.000Z","description":"是","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"en-GB","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:06:38.798Z"},{"__v":0,"_id":"67fcebfb0e1b74f905d758ac","createdAt":"2025-04-14T11:05:31.666Z","deadline":"2025-04-18T00:00:00.000Z","domain":"Finance","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"zh-TW","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:05:31.666Z"},{"__v":0,"_id":"67fce378e8e77e8888f5a6d8","createdAt":"2025-04-14T10:29:12.586Z","deadline":"2025-04-22T00:00:00.000Z","description":"设施","domain":"Gaming","files":[],"industry":"Software Development","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T10:29:12.586Z"}],"timestamp":"2025-04-17T06:05:33.551Z"}
{"level":"info","message":"[ProjectController.getProjects] Found 15 projects.","timestamp":"2025-04-17T06:05:33.556Z"}
{"level":"info","message":"[ProjectController.getProjects] Service returned result for user 67fcb942de30090a16d422b0:","pagination":{"limit":100,"page":1,"total":15,"totalPages":1},"projects":[{"__v":0,"_id":"6800625db601745b33861ae0","createdAt":"2025-04-17T02:07:25.548Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"ttt","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-17T02:07:25.548Z"},{"__v":0,"_id":"67ff99f4faf101ce1590b9bb","createdAt":"2025-04-16T11:52:20.438Z","deadline":"2025-04-17T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"啪啪啪","domain":"Legal","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"啪啪啪","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-16T11:52:20.438Z"},{"__v":0,"_id":"67fe03eacb309c902c850eb8","createdAt":"2025-04-15T06:59:54.293Z","deadline":"2025-04-19T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"大苏打","domain":"Regulatory","files":[],"industry":"Insurance","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test2","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:59:54.293Z"},{"__v":0,"_id":"67fe0005cb309c902c850db4","createdAt":"2025-04-15T06:43:17.704Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:43:17.704Z"},{"__v":0,"_id":"67fdff98cb309c902c850dab","createdAt":"2025-04-15T06:41:28.139Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:41:28.139Z"},{"__v":0,"_id":"67fdcfab3034155a167dee53","createdAt":"2025-04-15T03:16:59.289Z","deadline":"2025-04-25T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"languagePairs":[{"source":"es-ES","target":"ja"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"时代的","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-15T03:16:59.289Z"},{"__v":0,"_id":"67fdcb1a3b5c61926af422a3","createdAt":"2025-04-15T02:57:30.435Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Legal","files":[],"languagePairs":[{"source":"es-ES","target":"en-GB"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"对的","owner":"67fcb942de30090a16d422b0","reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:57:30.435Z"},{"__v":0,"_id":"67fdc7595cd4632c3a64e06c","createdAt":"2025-04-15T02:41:29.100Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Technical","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"en-US","target":"es-ES"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"是","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:41:29.100Z"},{"__v":0,"_id":"67fdc5535cd4632c3a64e019","createdAt":"2025-04-15T02:32:51.795Z","deadline":"2025-04-27T00:00:00.000Z","files":[],"languagePairs":[{"source":"zh-CN","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"设施","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-15T02:32:51.795Z"},{"__v":0,"_id":"67fcfe157c51da91b704e51e","createdAt":"2025-04-14T12:22:45.978Z","deadline":"2025-04-04T00:00:00.000Z","domain":"Education","files":[],"languagePairs":[{"source":"it","target":"ar"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T12:22:45.978Z"},{"__v":0,"_id":"67fcfc2102aa2a1f99f37d37","createdAt":"2025-04-14T12:14:25.708Z","deadline":"2025-04-12T00:00:00.000Z","domain":"Finance","files":[],"industry":"Construction & Civil Engineering","languagePairs":[{"source":"de","target":"it"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"003","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-14T12:14:25.708Z"},{"__v":0,"_id":"67fcecf20e1b74f905d75904","createdAt":"2025-04-14T11:09:38.351Z","deadline":"2025-04-24T00:00:00.000Z","description":"111","domain":"Medical","files":[],"industry":"Insurance","languagePairs":[{"source":"de","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"111","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:09:38.351Z"},{"__v":0,"_id":"67fcec3e0e1b74f905d758bd","createdAt":"2025-04-14T11:06:38.798Z","deadline":"2025-04-19T00:00:00.000Z","description":"是","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"en-GB","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:06:38.798Z"},{"__v":0,"_id":"67fcebfb0e1b74f905d758ac","createdAt":"2025-04-14T11:05:31.666Z","deadline":"2025-04-18T00:00:00.000Z","domain":"Finance","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"zh-TW","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:05:31.666Z"},{"__v":0,"_id":"67fce378e8e77e8888f5a6d8","createdAt":"2025-04-14T10:29:12.586Z","deadline":"2025-04-22T00:00:00.000Z","description":"设施","domain":"Gaming","files":[],"industry":"Software Development","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T10:29:12.586Z"}],"timestamp":"2025-04-17T06:05:33.564Z"}
{"level":"info","message":"[ProjectController.getProjects] Found 15 projects.","timestamp":"2025-04-17T06:05:33.568Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/prompts","timestamp":"2025-04-17T06:05:34.448Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:34.449Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:34.451Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:34.452Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:34.453Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: GET /api/prompts","timestamp":"2025-04-17T06:05:34.454Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:05:34.455Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:05:34.455Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:05:34.455Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:05:34.457Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:34.458Z"}
{"level":"info","message":"Entering PromptTemplateController.getAllTemplates","timestamp":"2025-04-17T06:05:34.459Z"}
{"level":"debug","message":"PromptTemplateService.getAllPromptTemplates called","timestamp":"2025-04-17T06:05:34.459Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:05:34.460Z"}
{"level":"info","message":"Entering PromptTemplateController.getAllTemplates","timestamp":"2025-04-17T06:05:34.461Z"}
{"level":"debug","message":"PromptTemplateService.getAllPromptTemplates called","timestamp":"2025-04-17T06:05:34.461Z"}
{"level":"info","message":"Found 4 prompt templates.","timestamp":"2025-04-17T06:05:34.466Z"}
{"level":"info","message":"Found 4 prompt templates.","timestamp":"2025-04-17T06:05:34.469Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:05:41.803Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10615ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:05:41.809Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:41.811Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:05:41.811Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:41.830Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:41.834Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:05:41.835Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 49% (21/43)","timestamp":"2025-04-17T06:05:41.835Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 49%","timestamp":"2025-04-17T06:05:41.836Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:05:41.838Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T06:05:41.841Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:05:41.846Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T06:05:41.867Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:05:41.867Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccd.","timestamp":"2025-04-17T06:05:41.870Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccd status to TRANSLATING.","timestamp":"2025-04-17T06:05:41.871Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:05:41.877Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:05:41.887Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:05:41.888Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:05:41.888Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:05:41.888Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 149","timestamp":"2025-04-17T06:05:41.889Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:05:41.889Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:05:41.893Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:05:41.894Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:05:41.894Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:05:41.895Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:05:41.895Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:05:41.896Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:05:41.896Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:05:41.898Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:05:41.899Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccd...","timestamp":"2025-04-17T06:05:41.899Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":149,"timestamp":"2025-04-17T06:05:41.900Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:05:41.901Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.3其中一个平板有较大片状菌落生长时，则不宜采用，而应以无较大片状菌落生长的平板作为该 稀释度的菌落数;若片状菌落不到平板的一半，而其余一半中菌落分布又很均匀，可计算半个平板后乘 以<rpr id=\"2\">2</rpr id=\"2\" transform=\"close\">,代表一个平板菌落数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:05:41.901Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:05:41.902Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:05:52.501Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10600ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:05:52.506Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:52.506Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:05:52.506Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:52.519Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:05:52.519Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:05:52.520Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 51% (22/43)","timestamp":"2025-04-17T06:05:52.520Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 51%","timestamp":"2025-04-17T06:05:52.521Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cce in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:05:52.521Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T06:05:52.521Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cce, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:05:52.521Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T06:05:52.534Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:05:52.535Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cce.","timestamp":"2025-04-17T06:05:52.537Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cce status to TRANSLATING.","timestamp":"2025-04-17T06:05:52.538Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:05:52.546Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:05:52.548Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:05:52.549Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:05:52.549Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:05:52.549Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 41","timestamp":"2025-04-17T06:05:52.549Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:05:52.549Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:05:52.551Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:05:52.551Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:05:52.551Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:05:52.552Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:05:52.552Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:05:52.552Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:05:52.552Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:05:52.552Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:05:52.552Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cce...","timestamp":"2025-04-17T06:05:52.552Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":41,"timestamp":"2025-04-17T06:05:52.552Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:05:52.552Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.3.4当平板上出现菌落间无明显界线的链状生长时，则将每条单链作为一个菌落计数。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:05:52.553Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:05:52.553Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:03.163Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10611ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:03.166Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cce: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:03.172Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cce as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:06:03.172Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:03.181Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:03.182Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cce not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:06:03.182Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 53% (23/43)","timestamp":"2025-04-17T06:06:03.183Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 53%","timestamp":"2025-04-17T06:06:03.184Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6ccf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:06:03.184Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T06:06:03.185Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6ccf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:06:03.185Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T06:06:03.195Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:06:03.200Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6ccf.","timestamp":"2025-04-17T06:06:03.203Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6ccf status to TRANSLATING.","timestamp":"2025-04-17T06:06:03.203Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:06:03.211Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:06:03.218Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:06:03.219Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:06:03.219Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:06:03.219Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 105","timestamp":"2025-04-17T06:06:03.219Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:06:03.219Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:06:03.222Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:06:03.222Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:06:03.222Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:06:03.223Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:06:03.223Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:06:03.223Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:06:03.223Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:06:03.223Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:06:03.223Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6ccf...","timestamp":"2025-04-17T06:06:03.224Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":105,"timestamp":"2025-04-17T06:06:03.224Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:06:03.224Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"7\">7结果与报告 </rpr id=\"7\" transform=\"close\"><rpr id=\"0\">7.1菌落总数的计算方法</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:06:03.224Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:06:03.225Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:13.864Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10639ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:13.864Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6ccf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:13.870Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6ccf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:06:13.870Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:13.892Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:13.894Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6ccf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:06:13.894Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 56% (24/43)","timestamp":"2025-04-17T06:06:13.894Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 56%","timestamp":"2025-04-17T06:06:13.895Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd0 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:06:13.895Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T06:06:13.895Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd0, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:06:13.896Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T06:06:13.907Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:06:13.911Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd0.","timestamp":"2025-04-17T06:06:13.914Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd0 status to TRANSLATING.","timestamp":"2025-04-17T06:06:13.915Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:06:13.923Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:06:13.929Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:06:13.929Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:06:13.930Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:06:13.930Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 255","timestamp":"2025-04-17T06:06:13.930Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:06:13.930Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:06:13.933Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:06:13.934Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:06:13.934Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:06:13.934Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:06:13.935Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:06:13.935Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:06:13.935Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:06:13.935Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:06:13.935Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd0...","timestamp":"2025-04-17T06:06:13.936Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":255,"timestamp":"2025-04-17T06:06:13.936Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:06:13.943Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.1</rpr id=\"8\" transform=\"close\">若只有一个稀释度平板上的菌落数在适宜计数范围内，计算两个平板菌落数的平均值，再将平 均值乘以相应稀释倍数，作为每<rpr id=\"2\">g</rpr id=\"2\" transform=\"close\">(<rpr id=\"2\">mL</rpr id=\"2\" transform=\"close\">)样品中菌落总数结果，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.1。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:06:13.943Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:06:13.943Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects?limit=100","timestamp":"2025-04-17T06:06:18.533Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects?limit=100","timestamp":"2025-04-17T06:06:18.534Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects?limit=100","timestamp":"2025-04-17T06:06:18.537Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:18.538Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:18.538Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:18.539Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:18.543Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects?limit=100","timestamp":"2025-04-17T06:06:18.545Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:18.546Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:18.546Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:18.546Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:18.547Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:18.550Z"}
{"level":"info","message":"[ProjectController.getProjects] Entered function for user ID (from auth): 67fcb942de30090a16d422b0","timestamp":"2025-04-17T06:06:18.550Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:18.553Z"}
{"level":"info","message":"[ProjectController.getProjects] Entered function for user ID (from auth): 67fcb942de30090a16d422b0","timestamp":"2025-04-17T06:06:18.554Z"}
{"level":"info","message":"[ProjectController.getProjects] Service returned result for user 67fcb942de30090a16d422b0:","pagination":{"limit":100,"page":1,"total":15,"totalPages":1},"projects":[{"__v":0,"_id":"6800625db601745b33861ae0","createdAt":"2025-04-17T02:07:25.548Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"ttt","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-17T02:07:25.548Z"},{"__v":0,"_id":"67ff99f4faf101ce1590b9bb","createdAt":"2025-04-16T11:52:20.438Z","deadline":"2025-04-17T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"啪啪啪","domain":"Legal","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"啪啪啪","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-16T11:52:20.438Z"},{"__v":0,"_id":"67fe03eacb309c902c850eb8","createdAt":"2025-04-15T06:59:54.293Z","deadline":"2025-04-19T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"大苏打","domain":"Regulatory","files":[],"industry":"Insurance","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test2","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:59:54.293Z"},{"__v":0,"_id":"67fe0005cb309c902c850db4","createdAt":"2025-04-15T06:43:17.704Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:43:17.704Z"},{"__v":0,"_id":"67fdff98cb309c902c850dab","createdAt":"2025-04-15T06:41:28.139Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:41:28.139Z"},{"__v":0,"_id":"67fdcfab3034155a167dee53","createdAt":"2025-04-15T03:16:59.289Z","deadline":"2025-04-25T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"languagePairs":[{"source":"es-ES","target":"ja"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"时代的","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-15T03:16:59.289Z"},{"__v":0,"_id":"67fdcb1a3b5c61926af422a3","createdAt":"2025-04-15T02:57:30.435Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Legal","files":[],"languagePairs":[{"source":"es-ES","target":"en-GB"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"对的","owner":"67fcb942de30090a16d422b0","reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:57:30.435Z"},{"__v":0,"_id":"67fdc7595cd4632c3a64e06c","createdAt":"2025-04-15T02:41:29.100Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Technical","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"en-US","target":"es-ES"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"是","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:41:29.100Z"},{"__v":0,"_id":"67fdc5535cd4632c3a64e019","createdAt":"2025-04-15T02:32:51.795Z","deadline":"2025-04-27T00:00:00.000Z","files":[],"languagePairs":[{"source":"zh-CN","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"设施","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-15T02:32:51.795Z"},{"__v":0,"_id":"67fcfe157c51da91b704e51e","createdAt":"2025-04-14T12:22:45.978Z","deadline":"2025-04-04T00:00:00.000Z","domain":"Education","files":[],"languagePairs":[{"source":"it","target":"ar"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T12:22:45.978Z"},{"__v":0,"_id":"67fcfc2102aa2a1f99f37d37","createdAt":"2025-04-14T12:14:25.708Z","deadline":"2025-04-12T00:00:00.000Z","domain":"Finance","files":[],"industry":"Construction & Civil Engineering","languagePairs":[{"source":"de","target":"it"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"003","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-14T12:14:25.708Z"},{"__v":0,"_id":"67fcecf20e1b74f905d75904","createdAt":"2025-04-14T11:09:38.351Z","deadline":"2025-04-24T00:00:00.000Z","description":"111","domain":"Medical","files":[],"industry":"Insurance","languagePairs":[{"source":"de","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"111","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:09:38.351Z"},{"__v":0,"_id":"67fcec3e0e1b74f905d758bd","createdAt":"2025-04-14T11:06:38.798Z","deadline":"2025-04-19T00:00:00.000Z","description":"是","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"en-GB","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:06:38.798Z"},{"__v":0,"_id":"67fcebfb0e1b74f905d758ac","createdAt":"2025-04-14T11:05:31.666Z","deadline":"2025-04-18T00:00:00.000Z","domain":"Finance","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"zh-TW","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:05:31.666Z"},{"__v":0,"_id":"67fce378e8e77e8888f5a6d8","createdAt":"2025-04-14T10:29:12.586Z","deadline":"2025-04-22T00:00:00.000Z","description":"设施","domain":"Gaming","files":[],"industry":"Software Development","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T10:29:12.586Z"}],"timestamp":"2025-04-17T06:06:18.575Z"}
{"level":"info","message":"[ProjectController.getProjects] Found 15 projects.","timestamp":"2025-04-17T06:06:18.579Z"}
{"level":"info","message":"[ProjectController.getProjects] Service returned result for user 67fcb942de30090a16d422b0:","pagination":{"limit":100,"page":1,"total":15,"totalPages":1},"projects":[{"__v":0,"_id":"6800625db601745b33861ae0","createdAt":"2025-04-17T02:07:25.548Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"ttt","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-17T02:07:25.548Z"},{"__v":0,"_id":"67ff99f4faf101ce1590b9bb","createdAt":"2025-04-16T11:52:20.438Z","deadline":"2025-04-17T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"啪啪啪","domain":"Legal","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"啪啪啪","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-16T11:52:20.438Z"},{"__v":0,"_id":"67fe03eacb309c902c850eb8","createdAt":"2025-04-15T06:59:54.293Z","deadline":"2025-04-19T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"大苏打","domain":"Regulatory","files":[],"industry":"Insurance","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test2","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:59:54.293Z"},{"__v":0,"_id":"67fe0005cb309c902c850db4","createdAt":"2025-04-15T06:43:17.704Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:43:17.704Z"},{"__v":0,"_id":"67fdff98cb309c902c850dab","createdAt":"2025-04-15T06:41:28.139Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","description":"专利翻译","domain":"Regulatory","files":[],"industry":"Legal Services","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T06:41:28.139Z"},{"__v":0,"_id":"67fdcfab3034155a167dee53","createdAt":"2025-04-15T03:16:59.289Z","deadline":"2025-04-25T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Finance","files":[],"languagePairs":[{"source":"es-ES","target":"ja"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"时代的","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-15T03:16:59.289Z"},{"__v":0,"_id":"67fdcb1a3b5c61926af422a3","createdAt":"2025-04-15T02:57:30.435Z","deadline":"2025-04-20T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Legal","files":[],"languagePairs":[{"source":"es-ES","target":"en-GB"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"对的","owner":"67fcb942de30090a16d422b0","reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:57:30.435Z"},{"__v":0,"_id":"67fdc7595cd4632c3a64e06c","createdAt":"2025-04-15T02:41:29.100Z","deadline":"2025-04-18T00:00:00.000Z","defaultReviewPromptTemplate":"67fcfba302aa2a1f99f37d28","defaultTranslationPromptTemplate":"67fcfb8802aa2a1f99f37d25","domain":"Technical","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"en-US","target":"es-ES"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"是","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcf9457524ff39c374aab7"],"status":"active","updatedAt":"2025-04-15T02:41:29.100Z"},{"__v":0,"_id":"67fdc5535cd4632c3a64e019","createdAt":"2025-04-15T02:32:51.795Z","deadline":"2025-04-27T00:00:00.000Z","files":[],"languagePairs":[{"source":"zh-CN","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"设施","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-15T02:32:51.795Z"},{"__v":0,"_id":"67fcfe157c51da91b704e51e","createdAt":"2025-04-14T12:22:45.978Z","deadline":"2025-04-04T00:00:00.000Z","domain":"Education","files":[],"languagePairs":[{"source":"it","target":"ar"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T12:22:45.978Z"},{"__v":0,"_id":"67fcfc2102aa2a1f99f37d37","createdAt":"2025-04-14T12:14:25.708Z","deadline":"2025-04-12T00:00:00.000Z","domain":"Finance","files":[],"industry":"Construction & Civil Engineering","languagePairs":[{"source":"de","target":"it"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"003","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":["67fcfa077524ff39c374aabc"],"status":"active","updatedAt":"2025-04-14T12:14:25.708Z"},{"__v":0,"_id":"67fcecf20e1b74f905d75904","createdAt":"2025-04-14T11:09:38.351Z","deadline":"2025-04-24T00:00:00.000Z","description":"111","domain":"Medical","files":[],"industry":"Insurance","languagePairs":[{"source":"de","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"111","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:09:38.351Z"},{"__v":0,"_id":"67fcec3e0e1b74f905d758bd","createdAt":"2025-04-14T11:06:38.798Z","deadline":"2025-04-19T00:00:00.000Z","description":"是","domain":"Finance","files":[],"industry":"Legal Services","languagePairs":[{"source":"en-GB","target":"zh-TW"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:06:38.798Z"},{"__v":0,"_id":"67fcebfb0e1b74f905d758ac","createdAt":"2025-04-14T11:05:31.666Z","deadline":"2025-04-18T00:00:00.000Z","domain":"Finance","files":[],"industry":"Banking & Financial Services","languagePairs":[{"source":"zh-TW","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"test","owner":"67fcb942de30090a16d422b0","priority":2,"reviewers":[],"status":"active","updatedAt":"2025-04-14T11:05:31.666Z"},{"__v":0,"_id":"67fce378e8e77e8888f5a6d8","createdAt":"2025-04-14T10:29:12.586Z","deadline":"2025-04-22T00:00:00.000Z","description":"设施","domain":"Gaming","files":[],"industry":"Software Development","languagePairs":[{"source":"zh-CN","target":"en-US"}],"manager":{"_id":"67fcb942de30090a16d422b0","email":"admin@example.com","username":"admin"},"members":[],"name":"所所说","owner":"67fcb942de30090a16d422b0","priority":3,"reviewers":[],"status":"active","updatedAt":"2025-04-14T10:29:12.586Z"}],"timestamp":"2025-04-17T06:06:18.581Z"}
{"level":"info","message":"[ProjectController.getProjects] Found 15 projects.","timestamp":"2025-04-17T06:06:18.584Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/6800625db601745b33861ae0","timestamp":"2025-04-17T06:06:21.735Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T06:06:21.736Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/prompts","timestamp":"2025-04-17T06:06:21.737Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/6800625db601745b33861ae0","timestamp":"2025-04-17T06:06:21.738Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:21.738Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:21.738Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:21.738Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:21.739Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/ai-configs","timestamp":"2025-04-17T06:06:21.742Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T06:06:21.743Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:21.743Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:21.743Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:21.744Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:21.744Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:21.746Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/prompts","timestamp":"2025-04-17T06:06:21.748Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:21.748Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:21.749Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:21.749Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:21.749Z","username":"admin"}
{"level":"info","message":"[ENTRY] Received request: GET /api/ai-configs","timestamp":"2025-04-17T06:06:21.751Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:21.752Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:21.752Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:21.752Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:21.753Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:21.754Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:21.754Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:21.754Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:21.760Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:21.761Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:21.765Z"}
{"level":"info","message":"Entering PromptTemplateController.getAllTemplates","timestamp":"2025-04-17T06:06:21.765Z"}
{"level":"debug","message":"PromptTemplateService.getAllPromptTemplates called","timestamp":"2025-04-17T06:06:21.765Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:21.768Z"}
{"level":"info","message":"Entering AIConfigController.getAllConfigs","timestamp":"2025-04-17T06:06:21.768Z"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:21.770Z"}
{"level":"info","message":"AIConfigService.getAllConfigs: Retrieved 1 total AI configs","timestamp":"2025-04-17T06:06:21.780Z"}
{"level":"info","message":"Found 4 prompt templates.","timestamp":"2025-04-17T06:06:21.787Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:24.562Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10625ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:24.565Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd0: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:24.569Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd0 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:06:24.570Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:24.584Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:24.585Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd0 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:06:24.585Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 58% (25/43)","timestamp":"2025-04-17T06:06:24.586Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 58%","timestamp":"2025-04-17T06:06:24.587Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd2 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:06:24.587Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T06:06:24.587Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd2, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:06:24.588Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T06:06:24.602Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:06:24.603Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd2.","timestamp":"2025-04-17T06:06:24.605Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd2 status to TRANSLATING.","timestamp":"2025-04-17T06:06:24.606Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:06:24.625Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:06:24.627Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:06:24.628Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:06:24.628Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:06:24.629Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T06:06:24.629Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:06:24.629Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:06:24.631Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:06:24.632Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:06:24.632Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:06:24.632Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:06:24.632Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:06:24.633Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:06:24.633Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:06:24.633Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:06:24.633Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd2...","timestamp":"2025-04-17T06:06:24.634Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T06:06:24.634Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:06:24.634Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:06:24.634Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:06:24.634Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T06:06:30.788Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T06:06:30.794Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:30.794Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:30.795Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:30.800Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:30.801Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:30.804Z"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/6800625db601745b33861ae0/files/6800973a55fa4eee124c497c/translate","timestamp":"2025-04-17T06:06:32.632Z"}
{"level":"info","message":"[ENTRY] Received request: POST /api/projects/6800625db601745b33861ae0/files/6800973a55fa4eee124c497c/translate","timestamp":"2025-04-17T06:06:32.635Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:32.637Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:32.637Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:32.637Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:32.638Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:32.642Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:32.643Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:32.643Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:32.644Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:32.645Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:32.647Z"}
{"level":"info","message":"User 67fcb942de30090a16d422b0 queuing translation for file 6800973a55fa4eee124c497c in project 6800625db601745b33861ae0 using AI Config 67fe227be8f10dbf81036e7e and Prompt 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:06:32.653Z"}
{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"6800973a55fa4eee124c497c","level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] START Processing job. Raw Data:","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"timestamp":"2025-04-17T06:06:32.661Z","type":"file","userId":"67fcb942de30090a16d422b0"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T06:06:32.670Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Extracted - promptTemplateId: 67fe34abde39936502045d6c, aiConfigId: 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:06:32.662Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing Details - Type: file, Project: 6800625db601745b33861ae0, File: 6800973a55fa4eee124c497c, AI Config: 67fe227be8f10dbf81036e7e, Prompt: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:06:32.672Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Determining segments to translate... Type: file","timestamp":"2025-04-17T06:06:32.673Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/projects/6800625db601745b33861ae0/files","timestamp":"2025-04-17T06:06:32.676Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Fetching project 6800625db601745b33861ae0 for language info...","timestamp":"2025-04-17T06:06:32.676Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Project languages: zh-CN -> en-US","timestamp":"2025-04-17T06:06:32.679Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:32.677Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:32.677Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:32.678Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:32.679Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:32.681Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] File Job: Determined 7 segments to translate.","timestamp":"2025-04-17T06:06:32.684Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:06:32.682Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:06:32.682Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:06:32.682Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:06:32.683Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:06:32.685Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Determined Languages: zh-CN -> en-US","timestamp":"2025-04-17T06:06:32.684Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Starting segment processing loop for 7 segments.","timestamp":"2025-04-17T06:06:32.684Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing segment 6800973a55fa4eee124c497f in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T06:06:32.685Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Calling translationService.translateSegment for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T06:06:32.685Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c497f, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:06:32.685Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T06:06:32.698Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1<rpr id=\"0\">.</rpr id=\"0\" transform=\"close\">1固体和半固体样品<rpr id=\"0\">：</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:06:32.699Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c497f.","timestamp":"2025-04-17T06:06:32.701Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c497f status to TRANSLATING.","timestamp":"2025-04-17T06:06:32.702Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:06:32.720Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:06:32.723Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:06:32.723Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:06:32.724Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:06:32.724Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 100","timestamp":"2025-04-17T06:06:32.724Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:06:32.724Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:06:32.728Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:06:32.728Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:06:32.728Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:06:32.728Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:06:32.729Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:06:32.729Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:06:32.729Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:06:32.729Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:06:32.729Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T06:06:32.729Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":100,"timestamp":"2025-04-17T06:06:32.730Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:06:32.730Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"0\">.</rpr id=\"0\" transform=\"close\">1固体和半固体样品<rpr id=\"0\">：</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"0\">.</rpr id=\"0\" transform=\"close\">1固体和半固体样品<rpr id=\"0\">：</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:06:32.730Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:06:32.730Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:35.278Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10643ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:35.279Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd2: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:35.286Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd2 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:06:35.286Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:35.316Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:35.316Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd2 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:06:35.316Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 60% (26/43)","timestamp":"2025-04-17T06:06:35.316Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 60%","timestamp":"2025-04-17T06:06:35.317Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd3 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:06:35.317Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T06:06:35.318Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd3, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:06:35.318Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T06:06:35.330Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}N —{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:06:35.330Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd3.","timestamp":"2025-04-17T06:06:35.333Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd3 status to TRANSLATING.","timestamp":"2025-04-17T06:06:35.333Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:06:35.340Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:06:35.345Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:06:35.345Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:06:35.345Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:06:35.345Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 7","timestamp":"2025-04-17T06:06:35.346Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:06:35.346Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:06:35.348Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:06:35.348Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:06:35.348Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:06:35.348Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:06:35.349Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:06:35.349Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:06:35.349Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:06:35.349Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:06:35.349Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd3...","timestamp":"2025-04-17T06:06:35.349Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":7,"timestamp":"2025-04-17T06:06:35.350Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:06:35.350Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}N —{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:06:35.350Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:06:35.350Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"SIGINT received, shutting down worker gracefully...","timestamp":"2025-04-17T06:06:39.057Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:42.848Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10118ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:42.851Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c497f: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:42.861Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c497f as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:06:42.861Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:42.882Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Error processing segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:42.883Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869992656: Segment 6800973a55fa4eee124c497f not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:06:42.883Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Updating progress: 14% (1/7)","timestamp":"2025-04-17T06:06:42.883Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869992656 progress: 14%","timestamp":"2025-04-17T06:06:42.885Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing segment 6800973a55fa4eee124c4980 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T06:06:42.885Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T06:06:42.885Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4980, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:06:42.885Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T06:06:42.905Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"称取25<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\"><rpr id=\"1\">8</rpr id=\"1\" transform=\"close\"> 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">10 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\">均质1 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">2 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:06:42.907Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4980.","timestamp":"2025-04-17T06:06:42.918Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4980 status to TRANSLATING.","timestamp":"2025-04-17T06:06:42.920Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:06:42.939Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:06:42.942Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:06:42.943Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:06:42.943Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:06:42.943Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 900","timestamp":"2025-04-17T06:06:42.943Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:06:42.943Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:06:42.945Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:06:42.946Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:06:42.946Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:06:42.946Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:06:42.946Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:06:42.947Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:06:42.947Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:06:42.948Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:06:42.948Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T06:06:42.948Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":900,"timestamp":"2025-04-17T06:06:42.949Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:06:42.949Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\"><rpr id=\"1\">8</rpr id=\"1\" transform=\"close\"> 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">10 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\">均质1 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">2 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\"><rpr id=\"1\">8</rpr id=\"1\" transform=\"close\"> 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">10 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\">均质1 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">2 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:06:42.950Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:06:42.950Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:45.886Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10537ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:45.888Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd3: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:45.892Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd3 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:06:45.893Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:45.908Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:45.909Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd3 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:06:45.909Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 63% (27/43)","timestamp":"2025-04-17T06:06:45.909Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 63%","timestamp":"2025-04-17T06:06:45.912Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd4 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:06:45.912Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T06:06:45.913Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd4, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:06:45.913Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T06:06:45.924Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"{}sc{}\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:06:45.924Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd4.","timestamp":"2025-04-17T06:06:45.928Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd4 status to TRANSLATING.","timestamp":"2025-04-17T06:06:45.929Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:06:45.949Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:06:45.952Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:06:45.953Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:06:45.953Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:06:45.954Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 6","timestamp":"2025-04-17T06:06:45.954Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:06:45.955Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:06:45.958Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:06:45.958Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:06:45.959Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:06:45.959Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:06:45.959Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:06:45.959Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:06:45.960Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:06:45.960Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:06:45.960Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd4...","timestamp":"2025-04-17T06:06:45.961Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":6,"timestamp":"2025-04-17T06:06:45.961Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:06:45.961Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n{}sc{}\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:06:45.961Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:06:45.962Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:53.451Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10503ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:53.452Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4980: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:53.454Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4980 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:06:53.454Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:53.474Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Error processing segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:53.474Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869992656: Segment 6800973a55fa4eee124c4980 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:06:53.474Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Updating progress: 29% (2/7)","timestamp":"2025-04-17T06:06:53.474Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869992656 progress: 29%","timestamp":"2025-04-17T06:06:53.475Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing segment 6800973a55fa4eee124c4981 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T06:06:53.475Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T06:06:53.475Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4981, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:06:53.475Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T06:06:53.482Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品勻液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:06:53.483Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4981.","timestamp":"2025-04-17T06:06:53.484Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4981 status to TRANSLATING.","timestamp":"2025-04-17T06:06:53.486Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:06:53.500Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:06:53.502Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:06:53.502Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:06:53.502Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:06:53.502Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T06:06:53.502Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:06:53.503Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:06:53.504Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:06:53.504Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:06:53.504Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:06:53.505Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:06:53.505Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:06:53.505Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:06:53.505Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:06:53.505Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:06:53.505Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T06:06:53.505Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":51,"timestamp":"2025-04-17T06:06:53.505Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:06:53.505Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:06:53.505Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:06:53.505Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"Translation queue service initialized. Connected to Redis: 127.0.0.1:6379","timestamp":"2025-04-17T06:06:53.632Z"}
{"level":"info","message":"[TranslationMemoryService] Initialized XML Parser.","timestamp":"2025-04-17T06:06:53.905Z"}
{"level":"warn","message":"Review queue service initialized WITHOUT Redis connection (temporary).","timestamp":"2025-04-17T06:06:53.928Z"}
{"level":"info","message":"MongoDB connected successfully for worker.","timestamp":"2025-04-17T06:06:53.959Z"}
{"level":"info","message":"Translation worker started...","timestamp":"2025-04-17T06:06:53.960Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:56.483Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10522ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:06:56.484Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd4: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:56.489Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd4 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:06:56.490Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:56.502Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:06:56.503Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd4 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:06:56.503Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 65% (28/43)","timestamp":"2025-04-17T06:06:56.503Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 65%","timestamp":"2025-04-17T06:06:56.504Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd7 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:06:56.504Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T06:06:56.504Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd7, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:06:56.504Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T06:06:56.513Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:06:56.516Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd7.","timestamp":"2025-04-17T06:06:56.518Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd7 status to TRANSLATING.","timestamp":"2025-04-17T06:06:56.519Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:06:56.529Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:06:56.533Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:06:56.534Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:06:56.534Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:06:56.534Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 60","timestamp":"2025-04-17T06:06:56.534Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:06:56.534Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:06:56.535Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:06:56.536Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:06:56.536Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:06:56.536Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:06:56.536Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:06:56.536Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:06:56.536Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:06:56.536Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:06:56.536Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd7...","timestamp":"2025-04-17T06:06:56.536Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":60,"timestamp":"2025-04-17T06:06:56.537Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:06:56.537Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n(狀1 + 0<rpr id=\"10\">.1??</rpr id=\"10\" transform=\"close\">2 )犱\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:06:56.537Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:06:56.537Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:04.055Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10550ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:04.057Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4981: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:04.062Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4981 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:07:04.062Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:04.074Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Error processing segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:04.075Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869992656: Segment 6800973a55fa4eee124c4981 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:07:04.075Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Updating progress: 43% (3/7)","timestamp":"2025-04-17T06:07:04.075Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869992656 progress: 43%","timestamp":"2025-04-17T06:07:04.077Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing segment 6800973a55fa4eee124c4982 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T06:07:04.077Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T06:07:04.077Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4982, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:07:04.077Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T06:07:04.086Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.2液体样品：\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:07:04.089Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4982.","timestamp":"2025-04-17T06:07:04.092Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4982 status to TRANSLATING.","timestamp":"2025-04-17T06:07:04.092Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:07:04.102Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:07:04.105Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:07:04.105Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:07:04.106Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:07:04.106Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 10","timestamp":"2025-04-17T06:07:04.106Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:07:04.106Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:07:04.107Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:07:04.107Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:07:04.107Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:07:04.108Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:07:04.108Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:07:04.108Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:07:04.108Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:07:04.108Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:07:04.108Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T06:07:04.108Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":10,"timestamp":"2025-04-17T06:07:04.108Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:07:04.108Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:07:04.108Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:07:04.108Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:07.105Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10567ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:07.106Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd7: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:07.111Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd7 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:07:07.111Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:07.130Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:07.131Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd7 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:07:07.131Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 67% (29/43)","timestamp":"2025-04-17T06:07:07.131Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 67%","timestamp":"2025-04-17T06:07:07.132Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd8 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:07:07.132Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T06:07:07.133Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd8, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:07:07.133Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T06:07:07.142Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:07:07.143Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd8.","timestamp":"2025-04-17T06:07:07.146Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd8 status to TRANSLATING.","timestamp":"2025-04-17T06:07:07.146Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:07:07.152Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:07:07.155Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:07:07.155Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:07:07.155Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:07:07.155Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T06:07:07.155Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:07:07.155Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:07:07.157Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:07:07.157Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:07:07.157Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:07:07.157Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:07:07.157Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:07:07.157Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:07:07.157Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:07:07.157Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:07:07.157Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd8...","timestamp":"2025-04-17T06:07:07.157Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T06:07:07.157Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:07:07.158Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:07:07.158Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:07:07.158Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:14.710Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10601ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:14.711Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4982: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:14.716Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4982 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:07:14.716Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:14.733Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Error processing segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:14.734Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869992656: Segment 6800973a55fa4eee124c4982 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:07:14.734Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Updating progress: 57% (4/7)","timestamp":"2025-04-17T06:07:14.735Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869992656 progress: 57%","timestamp":"2025-04-17T06:07:14.736Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing segment 6800973a55fa4eee124c4983 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T06:07:14.736Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4983...","timestamp":"2025-04-17T06:07:14.736Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4983, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:07:14.736Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4983...","timestamp":"2025-04-17T06:07:14.747Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"以无菌吸管吸取25<rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:07:14.749Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4983.","timestamp":"2025-04-17T06:07:14.752Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4983 status to TRANSLATING.","timestamp":"2025-04-17T06:07:14.752Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:07:14.760Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:07:14.764Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:07:14.764Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:07:14.764Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:07:14.764Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 503","timestamp":"2025-04-17T06:07:14.764Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:07:14.764Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:07:14.766Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:07:14.766Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:07:14.766Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:07:14.766Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:07:14.766Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:07:14.767Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:07:14.767Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:07:14.767Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:07:14.767Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 6800973a55fa4eee124c4983...","timestamp":"2025-04-17T06:07:14.767Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":503,"timestamp":"2025-04-17T06:07:14.767Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:07:14.767Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n以无菌吸管吸取25<rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n以无菌吸管吸取25<rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的 无菌锥形瓶(瓶内可预置适当数量的无菌玻璃珠）中，充分混匀，或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质 袋中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:07:14.767Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:07:14.767Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:17.742Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10585ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:17.743Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd8: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:17.744Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd8 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:07:17.745Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:17.749Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:17.749Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd8 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:07:17.749Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 70% (30/43)","timestamp":"2025-04-17T06:07:17.749Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 70%","timestamp":"2025-04-17T06:07:17.750Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cd9 in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:07:17.750Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T06:07:17.750Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cd9, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:07:17.750Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T06:07:17.758Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:07:17.763Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cd9.","timestamp":"2025-04-17T06:07:17.766Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cd9 status to TRANSLATING.","timestamp":"2025-04-17T06:07:17.766Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:07:17.770Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:07:17.772Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:07:17.772Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:07:17.772Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:07:17.772Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 92","timestamp":"2025-04-17T06:07:17.772Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:07:17.772Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:07:17.774Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:07:17.776Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:07:17.776Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:07:17.776Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:07:17.776Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:07:17.777Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:07:17.777Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:07:17.777Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:07:17.777Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cd9...","timestamp":"2025-04-17T06:07:17.777Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":92,"timestamp":"2025-04-17T06:07:17.777Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:07:17.777Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">(1</rpr id=\"2\" transform=\"close\"><rpr id=\"11\"> )</rpr id=\"11\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:07:17.778Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:07:17.778Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:25.313Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10545ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:25.313Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4983: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:25.317Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4983 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:07:25.317Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:25.336Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Error processing segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:25.337Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869992656: Segment 6800973a55fa4eee124c4983 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:07:25.337Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Updating progress: 71% (5/7)","timestamp":"2025-04-17T06:07:25.338Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869992656 progress: 71%","timestamp":"2025-04-17T06:07:25.339Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing segment 6800973a55fa4eee124c4984 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T06:07:25.339Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4984...","timestamp":"2025-04-17T06:07:25.339Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4984, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:07:25.339Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4984...","timestamp":"2025-04-17T06:07:25.349Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品匀液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:07:25.350Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4984.","timestamp":"2025-04-17T06:07:25.352Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4984 status to TRANSLATING.","timestamp":"2025-04-17T06:07:25.352Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:07:25.361Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:07:25.364Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:07:25.365Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:07:25.365Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:07:25.365Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T06:07:25.365Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:07:25.365Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:07:25.367Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:07:25.367Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:07:25.367Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:07:25.367Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:07:25.367Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:07:25.367Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:07:25.368Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:07:25.368Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:07:25.368Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 6800973a55fa4eee124c4984...","timestamp":"2025-04-17T06:07:25.368Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":51,"timestamp":"2025-04-17T06:07:25.368Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:07:25.368Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品匀液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:07:25.368Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:07:25.368Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:28.329Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10551ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:28.329Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cd9: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:28.331Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cd9 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:07:28.331Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:28.335Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:28.335Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cd9 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:07:28.335Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 72% (31/43)","timestamp":"2025-04-17T06:07:28.335Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 72%","timestamp":"2025-04-17T06:07:28.336Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cda in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:07:28.336Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T06:07:28.336Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cda, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:07:28.336Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T06:07:28.350Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"式中:\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:07:28.350Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cda.","timestamp":"2025-04-17T06:07:28.352Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cda status to TRANSLATING.","timestamp":"2025-04-17T06:07:28.352Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:07:28.362Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:07:28.364Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:07:28.365Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:07:28.365Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:07:28.365Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 3","timestamp":"2025-04-17T06:07:28.365Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:07:28.365Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:07:28.367Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:07:28.367Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:07:28.368Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:07:28.368Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:07:28.368Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:07:28.368Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:07:28.368Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:07:28.368Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:07:28.368Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cda...","timestamp":"2025-04-17T06:07:28.369Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":3,"timestamp":"2025-04-17T06:07:28.369Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:07:28.369Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n式中:\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n式中:\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:07:28.369Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:07:28.369Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T06:07:30.847Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T06:07:30.853Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:07:30.853Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:07:30.854Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:07:30.855Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:07:30.857Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:07:30.859Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:35.921Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10553ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:35.922Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4984: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:35.924Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4984 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:07:35.925Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:35.944Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Error processing segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:35.945Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869992656: Segment 6800973a55fa4eee124c4984 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:07:35.945Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Updating progress: 86% (6/7)","timestamp":"2025-04-17T06:07:35.945Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869992656 progress: 86%","timestamp":"2025-04-17T06:07:35.946Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing segment 6800973a55fa4eee124c4985 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T06:07:35.946Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4985...","timestamp":"2025-04-17T06:07:35.946Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4985, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:07:35.946Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4985...","timestamp":"2025-04-17T06:07:35.953Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"当结果要求为每<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"1\">6</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">操作。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:07:35.954Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4985.","timestamp":"2025-04-17T06:07:35.956Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4985 status to TRANSLATING.","timestamp":"2025-04-17T06:07:35.956Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:07:35.969Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:07:35.971Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:07:35.971Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:07:35.971Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:07:35.972Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 199","timestamp":"2025-04-17T06:07:35.972Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:07:35.972Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:07:35.974Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:07:35.974Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:07:35.974Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:07:35.974Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:07:35.974Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:07:35.974Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:07:35.974Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:07:35.975Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:07:35.975Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 6800973a55fa4eee124c4985...","timestamp":"2025-04-17T06:07:35.975Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":199,"timestamp":"2025-04-17T06:07:35.975Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:07:35.975Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n当结果要求为每<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"1\">6</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">操作。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n当结果要求为每<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品中菌落总数 时，按<rpr id=\"1\">6</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">.<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\">操作。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:07:35.975Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:07:35.975Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:38.933Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10563ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:38.933Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cda: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:38.935Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cda as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:07:38.935Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:38.955Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:38.955Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cda not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:07:38.955Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 74% (32/43)","timestamp":"2025-04-17T06:07:38.956Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 74%","timestamp":"2025-04-17T06:07:38.956Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdb in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:07:38.956Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T06:07:38.956Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdb, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:07:38.956Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T06:07:38.962Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:07:38.962Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdb.","timestamp":"2025-04-17T06:07:38.967Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdb status to TRANSLATING.","timestamp":"2025-04-17T06:07:38.967Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:07:38.980Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:07:38.984Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:07:38.984Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:07:38.984Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:07:38.985Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 53","timestamp":"2025-04-17T06:07:38.985Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:07:38.985Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:07:38.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:07:38.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:07:38.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:07:38.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:07:38.987Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:07:38.987Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:07:38.988Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:07:38.988Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:07:38.988Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdb...","timestamp":"2025-04-17T06:07:38.988Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":53,"timestamp":"2025-04-17T06:07:38.988Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:07:38.988Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">N</rpr id=\"2\" transform=\"close\">——样品中菌落数；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:07:38.988Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:07:38.989Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:46.510Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10535ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:46.512Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4985: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:46.516Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4985 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:07:46.517Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:46.525Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Error processing segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:46.527Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869992656: Segment 6800973a55fa4eee124c4985 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:07:46.527Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Updating progress: 100% (7/7)","timestamp":"2025-04-17T06:07:46.528Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869992656 progress: 100%","timestamp":"2025-04-17T06:07:46.529Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] FINISHED Segment Loop. Processed: 0, Errors: 7, Total Segments in Job: 7","timestamp":"2025-04-17T06:07:46.529Z"}
{"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Failing job due to segment errors: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:46.529Z"}
{"error":{},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] FAILED Catastrophically: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:46.530Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"6800973a55fa4eee124c497c","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-6800973a55fa4eee124c497c-1744869992656","level":"error","message":"Job file-6800973a55fa4eee124c497c-1744869992656 failed. Error: 7 segment(s) failed to translate. Errors: Segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4982: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4983: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4984: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 6800973a55fa4eee124c4985: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:46.532Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:49.527Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10539ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:07:49.529Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdb: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:49.531Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdb as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:07:49.531Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:49.545Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:07:49.545Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdb not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:07:49.545Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 77% (33/43)","timestamp":"2025-04-17T06:07:49.545Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 77%","timestamp":"2025-04-17T06:07:49.546Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdc in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:07:49.546Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T06:07:49.546Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdc, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:07:49.546Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T06:07:49.552Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:07:49.552Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdc.","timestamp":"2025-04-17T06:07:49.554Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdc status to TRANSLATING.","timestamp":"2025-04-17T06:07:49.554Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:07:49.560Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:07:49.563Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:07:49.563Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:07:49.563Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:07:49.563Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 68","timestamp":"2025-04-17T06:07:49.564Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:07:49.564Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:07:49.565Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:07:49.565Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:07:49.565Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:07:49.565Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:07:49.565Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:07:49.565Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:07:49.565Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:07:49.565Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:07:49.565Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdc...","timestamp":"2025-04-17T06:07:49.565Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":68,"timestamp":"2025-04-17T06:07:49.565Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:07:49.565Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"2\">SC</rpr id=\"2\" transform=\"close\">——平板(含适宜范围菌落数的平板）菌落数之和；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:07:49.565Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:07:49.565Z","url":"https://api.x.ai/v1/chat/completions"}
{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"6800973a55fa4eee124c497c","level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] START Processing job. Raw Data:","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"timestamp":"2025-04-17T06:07:51.615Z","type":"file","userId":"67fcb942de30090a16d422b0"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Extracted - promptTemplateId: 67fe34abde39936502045d6c, aiConfigId: 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:07:51.616Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing Details - Type: file, Project: 6800625db601745b33861ae0, File: 6800973a55fa4eee124c497c, AI Config: 67fe227be8f10dbf81036e7e, Prompt: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:07:51.619Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Determining segments to translate... Type: file","timestamp":"2025-04-17T06:07:51.619Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Fetching project 6800625db601745b33861ae0 for language info...","timestamp":"2025-04-17T06:07:51.647Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Project languages: zh-CN -> en-US","timestamp":"2025-04-17T06:07:51.651Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] File Job: Determined 7 segments to translate.","timestamp":"2025-04-17T06:07:51.657Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Determined Languages: zh-CN -> en-US","timestamp":"2025-04-17T06:07:51.658Z"}
{"level":"info","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Starting segment processing loop for 7 segments.","timestamp":"2025-04-17T06:07:51.658Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing segment 6800973a55fa4eee124c497f in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T06:07:51.658Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Calling translationService.translateSegment for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T06:07:51.658Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c497f, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:07:51.659Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T06:07:51.677Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1<rpr id=\"0\">.</rpr id=\"0\" transform=\"close\">1固体和半固体样品<rpr id=\"0\">：</rpr id=\"0\" transform=\"close\">\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:07:51.677Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c497f.","timestamp":"2025-04-17T06:07:51.680Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c497f status to TRANSLATING.","timestamp":"2025-04-17T06:07:51.681Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:07:51.704Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:07:51.708Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:07:51.708Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:07:51.709Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:07:51.709Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 100","timestamp":"2025-04-17T06:07:51.709Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:07:51.709Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:07:51.713Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:07:51.714Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:07:51.714Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:07:51.714Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:07:51.715Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:07:51.715Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:07:51.715Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:07:51.715Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:07:51.715Z"}
{"level":"info","message":"Creating singleton adapter instance for grok.","timestamp":"2025-04-17T06:07:51.715Z"}
{"level":"warn","message":"[AIServiceFactory] loadDefaultConfigForProvider called for grok. Using potentially insecure defaults or environment variables.","timestamp":"2025-04-17T06:07:51.715Z"}
{"level":"info","message":"[GrokAdapter] Initialized with API Key (masked): ****jdOO","timestamp":"2025-04-17T06:07:51.716Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 6800973a55fa4eee124c497f...","timestamp":"2025-04-17T06:07:51.716Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":100,"timestamp":"2025-04-17T06:07:51.716Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:07:51.716Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"0\">.</rpr id=\"0\" transform=\"close\">1固体和半固体样品<rpr id=\"0\">：</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1<rpr id=\"0\">.</rpr id=\"0\" transform=\"close\">1固体和半固体样品<rpr id=\"0\">：</rpr id=\"0\" transform=\"close\">\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:07:51.717Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:07:51.717Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:00.158Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10593ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:00.159Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdc: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:00.161Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdc as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:08:00.162Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:00.175Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:00.179Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdc not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:08:00.180Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 79% (34/43)","timestamp":"2025-04-17T06:08:00.180Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 79%","timestamp":"2025-04-17T06:08:00.181Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdd in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:08:00.181Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T06:08:00.181Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdd, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:08:00.181Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T06:08:00.231Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:08:00.231Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdd.","timestamp":"2025-04-17T06:08:00.240Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdd status to TRANSLATING.","timestamp":"2025-04-17T06:08:00.240Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:08:00.254Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:08:00.256Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:08:00.257Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:08:00.258Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:08:00.258Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 64","timestamp":"2025-04-17T06:08:00.258Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:08:00.258Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:08:00.270Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:08:00.271Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:08:00.271Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:08:00.271Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:08:00.271Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:08:00.271Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:08:00.271Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:08:00.271Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:08:00.271Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdd...","timestamp":"2025-04-17T06:08:00.271Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":64,"timestamp":"2025-04-17T06:08:00.271Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:08:00.272Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">1</rpr id=\"2\" transform=\"close\">——第一稀释度(低稀释倍数)平板个数；\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:08:00.272Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:08:00.272Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:02.360Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10642ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:02.361Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c497f: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:02.363Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c497f as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:08:02.364Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:02.388Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Error processing segment 6800973a55fa4eee124c497f: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:02.390Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869992656: Segment 6800973a55fa4eee124c497f not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:08:02.390Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Updating progress: 14% (1/7)","timestamp":"2025-04-17T06:08:02.390Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869992656 progress: 14%","timestamp":"2025-04-17T06:08:02.392Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing segment 6800973a55fa4eee124c4980 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T06:08:02.393Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T06:08:02.393Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4980, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:08:02.393Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T06:08:02.407Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"称取25<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\"><rpr id=\"1\">8</rpr id=\"1\" transform=\"close\"> 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">10 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\">均质1 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">2 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:08:02.408Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4980.","timestamp":"2025-04-17T06:08:02.410Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4980 status to TRANSLATING.","timestamp":"2025-04-17T06:08:02.411Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:08:02.414Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:08:02.416Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:08:02.416Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:08:02.416Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:08:02.416Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 900","timestamp":"2025-04-17T06:08:02.416Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:08:02.416Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:08:02.417Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:08:02.418Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:08:02.418Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:08:02.418Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:08:02.418Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:08:02.418Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:08:02.418Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:08:02.418Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:08:02.418Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 6800973a55fa4eee124c4980...","timestamp":"2025-04-17T06:08:02.418Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":900,"timestamp":"2025-04-17T06:08:02.419Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:08:02.419Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\"><rpr id=\"1\">8</rpr id=\"1\" transform=\"close\"> 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">10 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\">均质1 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">2 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n称取25<rpr id=\"1\">g</rpr id=\"1\" transform=\"close\">样品置于盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">无菌磷酸盐缓冲液或无菌生理盐水的无菌 均质杯内<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\"><rpr id=\"1\">8</rpr id=\"1\" transform=\"close\"> 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">10 000 <rpr id=\"1\">r/min</rpr id=\"1\" transform=\"close\">均质1 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\">2 <rpr id=\"1\">min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">或放入盛有225 <rpr id=\"1\">mL</rpr id=\"1\" transform=\"close\">稀释液的无菌均质袋 中<rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">用拍击式均质器拍打<rpr id=\"1\">lmin</rpr id=\"1\" transform=\"close\"><rpr id=\"3\">〜</rpr id=\"3\" transform=\"close\"><rpr id=\"1\">2min</rpr id=\"1\" transform=\"close\"><rpr id=\"2\">，</rpr id=\"2\" transform=\"close\">制成<rpr id=\"1\">1</rpr id=\"1\" transform=\"close\"> :\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:08:02.419Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:08:02.419Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:10.895Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10624ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:10.896Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdd: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:10.899Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdd as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:08:10.899Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:10.918Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:10.919Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdd not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:08:10.919Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 81% (35/43)","timestamp":"2025-04-17T06:08:10.919Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 81%","timestamp":"2025-04-17T06:08:10.921Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cde in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:08:10.921Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T06:08:10.921Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cde, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:08:10.921Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T06:08:10.933Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:08:10.934Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cde.","timestamp":"2025-04-17T06:08:10.937Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cde status to TRANSLATING.","timestamp":"2025-04-17T06:08:10.938Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:08:10.944Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:08:10.946Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:08:10.947Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:08:10.948Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:08:10.948Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 167","timestamp":"2025-04-17T06:08:10.948Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:08:10.949Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:08:10.951Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:08:10.951Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:08:10.951Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:08:10.952Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:08:10.952Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:08:10.952Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:08:10.952Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:08:10.952Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:08:10.952Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cde...","timestamp":"2025-04-17T06:08:10.952Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":167,"timestamp":"2025-04-17T06:08:10.952Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:08:10.952Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n狀<rpr id=\"2\">2——</rpr id=\"2\" transform=\"close\">第二稀释度<rpr id=\"2\">(</rpr id=\"2\" transform=\"close\">高稀释倍数)平板个数； <rpr id=\"2\">d</rpr id=\"2\" transform=\"close\"> ——稀释因子（第一稀释度）。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:08:10.953Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:08:10.953Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:13.023Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10604ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:13.024Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4980: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:13.027Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4980 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:08:13.027Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:13.041Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Error processing segment 6800973a55fa4eee124c4980: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:13.042Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869992656: Segment 6800973a55fa4eee124c4980 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:08:13.043Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Updating progress: 29% (2/7)","timestamp":"2025-04-17T06:08:13.044Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869992656 progress: 29%","timestamp":"2025-04-17T06:08:13.045Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing segment 6800973a55fa4eee124c4981 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T06:08:13.046Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T06:08:13.047Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4981, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:08:13.047Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T06:08:13.064Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品勻液。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:08:13.064Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4981.","timestamp":"2025-04-17T06:08:13.067Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4981 status to TRANSLATING.","timestamp":"2025-04-17T06:08:13.070Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:08:13.087Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:08:13.091Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:08:13.091Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:08:13.092Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:08:13.092Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 51","timestamp":"2025-04-17T06:08:13.092Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:08:13.092Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:08:13.095Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:08:13.096Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:08:13.096Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:08:13.096Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:08:13.097Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:08:13.097Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:08:13.097Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:08:13.097Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:08:13.097Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 6800973a55fa4eee124c4981...","timestamp":"2025-04-17T06:08:13.098Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":51,"timestamp":"2025-04-17T06:08:13.098Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:08:13.098Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"1\">10</rpr id=\"1\" transform=\"close\">的样品勻液。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:08:13.098Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:08:13.098Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:21.537Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10584ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:21.538Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cde: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:21.541Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cde as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:08:21.542Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:21.559Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:21.560Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cde not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:08:21.561Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 84% (36/43)","timestamp":"2025-04-17T06:08:21.561Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 84%","timestamp":"2025-04-17T06:08:21.562Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Processing segment 68008f27082e41fa7e9c6cdf in file 68008f27082e41fa7e9c6cb2...","timestamp":"2025-04-17T06:08:21.562Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Calling translationService.translateSegment for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T06:08:21.562Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 68008f27082e41fa7e9c6cdf, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:08:21.562Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T06:08:21.573Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:08:21.574Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 68008f27082e41fa7e9c6cdf.","timestamp":"2025-04-17T06:08:21.577Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 68008f27082e41fa7e9c6cdf status to TRANSLATING.","timestamp":"2025-04-17T06:08:21.577Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:08:21.585Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:08:21.587Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:08:21.587Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:08:21.588Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:08:21.588Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 213","timestamp":"2025-04-17T06:08:21.588Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:08:21.588Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:08:21.590Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:08:21.590Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:08:21.590Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:08:21.590Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:08:21.591Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:08:21.591Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:08:21.591Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:08:21.591Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:08:21.591Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 68008f27082e41fa7e9c6cdf...","timestamp":"2025-04-17T06:08:21.591Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":213,"timestamp":"2025-04-17T06:08:21.592Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:08:21.592Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n<rpr id=\"8\">7.1.3</rpr id=\"8\" transform=\"close\">若所有稀释度的平板上菌落数均大于300 <rpr id=\"2\">CFU</rpr id=\"2\" transform=\"close\">，则对稀释度最高的平板进行计数，其他平板可 记录为多不可计，结果按平均菌落数乘以最高稀释倍数计算，示例见<rpr id=\"2\">B</rpr id=\"2\" transform=\"close\">.3。\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:08:21.592Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:08:21.592Z","url":"https://api.x.ai/v1/chat/completions"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:23.736Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10637ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:23.737Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 6800973a55fa4eee124c4981: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:23.738Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 6800973a55fa4eee124c4981 as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:08:23.738Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:23.759Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Error processing segment 6800973a55fa4eee124c4981: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:23.760Z"}
{"level":"warn","message":"Job file-6800973a55fa4eee124c497c-1744869992656: Segment 6800973a55fa4eee124c4981 not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:08:23.760Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Updating progress: 43% (3/7)","timestamp":"2025-04-17T06:08:23.761Z"}
{"level":"debug","message":"Job file-6800973a55fa4eee124c497c-1744869992656 progress: 43%","timestamp":"2025-04-17T06:08:23.762Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Processing segment 6800973a55fa4eee124c4982 in file 6800973a55fa4eee124c497c...","timestamp":"2025-04-17T06:08:23.762Z"}
{"level":"debug","message":"[Worker Job file-6800973a55fa4eee124c497c-1744869992656] Calling translationService.translateSegment for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T06:08:23.762Z"}
{"level":"debug","message":"[TranslationService.translateSegment] ENTER - segmentId: 6800973a55fa4eee124c4982, userId: 67fcb942de30090a16d422b0, aiConfigId: 67fe227be8f10dbf81036e7e, promptTemplateId: 67fe34abde39936502045d6c","options":{"sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"timestamp":"2025-04-17T06:08:23.762Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Checking Translation Memory for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T06:08:23.769Z"}
{"level":"debug","message":"[TranslationMemoryService.findMatches] Searching TM for: \"6.1.2液体样品：\" (zh-CN->en-US), Project: 6800625db601745b33861ae0","timestamp":"2025-04-17T06:08:23.770Z"}
{"level":"debug","message":"[TranslationService.translateSegment] No 100% TM match found. Proceeding with AI for segment 6800973a55fa4eee124c4982.","timestamp":"2025-04-17T06:08:23.771Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Updating segment 6800973a55fa4eee124c4982 status to TRANSLATING.","timestamp":"2025-04-17T06:08:23.772Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetching AI Config 67fe227be8f10dbf81036e7e...","timestamp":"2025-04-17T06:08:23.782Z"}
{"level":"info","message":"AIConfigService.getConfigById: Retrieved AI Config 67fe227be8f10dbf81036e7e","timestamp":"2025-04-17T06:08:23.783Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Fetched AI Config: grok","timestamp":"2025-04-17T06:08:23.783Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Building translation prompt...","timestamp":"2025-04-17T06:08:23.784Z"}
{"domain":"Finance","level":"debug","message":"[PromptProcessor.buildTranslationPrompt] ENTER - context:","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","terms":[],"timestamp":"2025-04-17T06:08:23.784Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] sourceText length: 10","timestamp":"2025-04-17T06:08:23.784Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Finding template ID: 67fe34abde39936502045d6c","timestamp":"2025-04-17T06:08:23.784Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Found template. Content length: 116","timestamp":"2025-04-17T06:08:23.785Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using systemInstruction template (length undefined): undefined...","timestamp":"2025-04-17T06:08:23.785Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Using userPromptTemplate template (length 116): 请将以下内容从 {{sourceLang}} 翻译为 {{targetLang}}。\n主题领域是：{{domain}}。\n\n原文：\n{{sourceText}}\n\n请确保翻译的质量，并且参考术语表：{...","timestamp":"2025-04-17T06:08:23.785Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] Replacing placeholders in user prompt using fillPlaceholders...","timestamp":"2025-04-17T06:08:23.785Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] No system instruction template to process.","timestamp":"2025-04-17T06:08:23.785Z"}
{"level":"debug","message":"[PromptProcessor.buildTranslationPrompt] EXIT - Returning processed prompt.","timestamp":"2025-04-17T06:08:23.785Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Prompt built.","timestamp":"2025-04-17T06:08:23.785Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Determined AI Model to use: grok-3-latest","timestamp":"2025-04-17T06:08:23.786Z"}
{"level":"debug","message":"[TranslationService.translateSegment] Getting AI adapter for provider: grok","timestamp":"2025-04-17T06:08:23.786Z"}
{"adapterOptions":{"aiModel":"grok-3-latest","aiProvider":"grok","domain":"Finance","promptTemplateId":"67fe34abde39936502045d6c","sourceLanguage":"zh-CN","targetLanguage":"en-US","tbId":null,"tmId":null},"level":"debug","message":"[TranslationService.translateSegment] Calling adapter.translateText for segment 6800973a55fa4eee124c4982...","timestamp":"2025-04-17T06:08:23.786Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Starting translation with model grok-3-latest","sourceTextLength":10,"timestamp":"2025-04-17T06:08:23.786Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Prompt Data:","systemPrompt":null,"timestamp":"2025-04-17T06:08:23.786Z","userPrompt":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。"}
{"level":"debug","message":"[GrokAdapter.translateText] Request Body to Grok:","messages":[{"content":"请将以下内容从 zh-CN 翻译为 en-US。\n主题领域是：Finance。\n\n原文：\n6.1.2液体样品：\n\n请确保翻译的质量，并且参考术语表：None。","role":"user"}],"model":"grok-3-latest","stream":false,"temperature":0.3,"timestamp":"2025-04-17T06:08:23.786Z"}
{"level":"debug","message":"[GrokAdapter.translateText] Preparing to send request to Grok API with 30000ms timeout...","model":"grok-3-latest","timestamp":"2025-04-17T06:08:23.786Z","url":"https://api.x.ai/v1/chat/completions"}
{"level":"info","message":"[ENTRY] Received request: OPTIONS /api/notifications","timestamp":"2025-04-17T06:08:30.860Z"}
{"level":"info","message":"[ENTRY] Received request: GET /api/notifications","timestamp":"2025-04-17T06:08:30.864Z"}
{"level":"debug","message":"Attempting JWT authentication...","timestamp":"2025-04-17T06:08:30.865Z"}
{"level":"debug","message":"Authorization Header:","timestamp":"2025-04-17T06:08:30.866Z"}
{"level":"debug","message":"Extracted Token:","timestamp":"2025-04-17T06:08:30.866Z"}
{"email":"admin@example.com","exp":1744956330,"iat":1744869930,"id":"67fcb942de30090a16d422b0","level":"debug","message":"JWT Payload verified (new structure):","role":"admin","timestamp":"2025-04-17T06:08:30.867Z","username":"admin"}
{"level":"info","message":"Authenticated user: admin (ID: 67fcb942de30090a16d422b0, Role: admin)","timestamp":"2025-04-17T06:08:30.871Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"level":"error","message":"[GrokAdapter.translateText] RAW ERROR caught in catch block: fetch failed","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:32.237Z"}
{"cause":{"code":"UND_ERR_CONNECT_TIMEOUT","name":"ConnectTimeoutError"},"error":"fetch failed","level":"error","message":"[GrokAdapter.translateText] Error during Grok processing. Time: 10644ms","stack":"TypeError: fetch failed\n    at node:internal/deps/undici/undici:13502:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async GrokAdapter.translateText (D:\\project\\translation-platform\\src\\services\\translation\\ai-adapters\\grok.adapter.ts:70:18)\n    at async TranslationService.translateSegment (D:\\project\\translation-platform\\src\\services\\translation.service.ts:235:24)\n    at async Worker.processJob [as processFn] (D:\\project\\translation-platform\\src\\workers\\translation.worker.ts:190:30)\n    at async D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:909:26\n    at async Worker.retryIfFailed (D:\\project\\translation-platform\\node_modules\\bullmq\\src\\classes\\worker.ts:1173:16)","timestamp":"2025-04-17T06:08:32.239Z"}
{"error":{"code":"GROK_REQUEST_FAILED","details":{},"provider":"grok"},"level":"error","message":"[TranslationService.translateSegment] ERROR for segment 68008f27082e41fa7e9c6cdf: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:32.242Z"}
{"level":"warn","message":"[TranslationService.translateSegment] Attempting to mark segment 68008f27082e41fa7e9c6cdf as ERROR in DB due to previous failure.","timestamp":"2025-04-17T06:08:32.242Z"}
{"level":"error","message":"Error in TranslationService.translateSegment: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:32.257Z"}
{"error":{"name":"AppError","statusCode":500},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Error processing segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:32.259Z"}
{"level":"warn","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818: Segment 68008f27082e41fa7e9c6cdf not queued for review (Status: Update Failed).","timestamp":"2025-04-17T06:08:32.259Z"}
{"level":"debug","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Updating progress: 86% (37/43)","timestamp":"2025-04-17T06:08:32.259Z"}
{"level":"debug","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 progress: 86%","timestamp":"2025-04-17T06:08:32.261Z"}
{"level":"info","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] FINISHED Segment Loop. Processed: 0, Errors: 37, Total Segments in Job: 43","timestamp":"2025-04-17T06:08:32.261Z"}
{"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] Failing job due to segment errors: 37 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:32.262Z"}
{"error":{},"level":"error","message":"[Worker Job file-68008f27082e41fa7e9c6cb2-1744868752818] FAILED Catastrophically: 37 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:32.263Z"}
{"data":{"aiConfigId":"67fe227be8f10dbf81036e7e","fileId":"68008f27082e41fa7e9c6cb2","options":{"tbId":null,"tmId":null},"projectId":"6800625db601745b33861ae0","promptTemplateId":"67fe34abde39936502045d6c","requesterRoles":["admin"],"type":"file","userId":"67fcb942de30090a16d422b0"},"error":{},"jobId":"file-68008f27082e41fa7e9c6cb2-1744868752818","level":"error","message":"Job file-68008f27082e41fa7e9c6cb2-1744868752818 failed. Error: 37 segment(s) failed to translate. Errors: Segment 68008f27082e41fa7e9c6cb5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cb9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cba: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbe: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cbf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc5: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc6: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cc9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cca: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cce: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6ccf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd0: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd2: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd3: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd4: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd7: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd8: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cd9: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cda: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdb: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdc: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdd: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cde: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}; Segment 68008f27082e41fa7e9c6cdf: TranslationService.translateSegment 失败: Failed to translate using Grok: fetch failed Cause: {\"name\":\"ConnectTimeoutError\",\"code\":\"UND_ERR_CONNECT_TIMEOUT\"}","timestamp":"2025-04-17T06:08:32.267Z"}
{"level":"info","message":"Worker and DB connection closed.","timestamp":"2025-04-17T06:08:32.275Z"}
